Event.Replayable=Class.create();Event.Replayable.prototype={initialize:function(g,e,c,d,f,b,a){this.type=g;this.target=e;this.mouseX=c;this.mouseY=d;this.time=f;this.id=b?b:"";this.href=a?a:""}};Event.DelayedMoveObserver=Class.create();Event.DelayedMoveObserver.prototype={initialize:function(c,b,a){this.delay=b||0.5;this.element=$(c);this.callback=a;this.timer=null;this.event=null;this.mouseX=-1;this.mouseY=-1;this.Mousemove_Listener=this.delayedListener.bindAsEventListener(this);Event.observe(this.element,"mousemove",this.Mousemove_Listener)},Mousemove_Listener:null,delayedListener:function(a){if(this.timer){clearTimeout(this.timer)}this.mouseX=Event.pointerX(a);this.mouseY=Event.pointerY(a);this.target=a.target;this.timer=setTimeout(this.onTimerEvent.bind(this),this.delay*1000)},onTimerEvent:function(a){this.timer=null;this.callback(new Event.Replayable("mousemove",this.target,this.mouseX,this.mouseY,new Date().getTime()))},stopObserving:function(){Event.stopObserving(this.element,"mousemove",this.Mousemove_Listener)}};Event.Replay=Class.create();Event.Replay.prototype={initialize:function(){this.events=new Array();this.starttime=new Date().getTime();this.mouseObserver=null;this.clickObserver=null;this.isObserving=false},reset:function(){this.events=new Array();this.starttime=new Date().getTime()},addEvent:function(a){a.time=a.time-this.starttime;this.events[this.events.length]=a;if(a.target&&a.target.id){a.id=a.target.id}if(a.type=="click"&&a.target&&a.target.tagName=="A"){a.href=a.target.href}a.target=(a.target&&a.target.tagName)?a.target.tagName:(a.srcElement?a.srcElement.tagName:"?");if(a.type=="mousemove"){}if(a.type=="click"&&a.target=="A"){this.sendEvents()}return true},replayEvents:function(){Element.show("crosshair");for(i=0;i<this.events.length;i++){this.replayEvent(this.events[i])}},replayEvent:function(a){if(a.type=="click"){this.timer=setTimeout(this.replayClickEvent.bind(a),a.time)}else{if(a.type="mousemove"){this.timer=setTimeout(this.replayMousemoveEvent.bind(a),a.time)}}},replayMousemoveEvent:function(){new Effect.Move($("crosshair"),{duration:0.3,x:this.mouseX,y:this.mouseY,mode:"absolute"})},replayClickEvent:function(){if(this.href){document.location=this.href;return}if(this.id&&$(this.id)){if(document.all){$(this.id).fireEvent("onclick")}else{var c=document.createEvent("MouseEvents");c.initMouseEvent("click",true,true,window,0,0,0,0,0,false,false,false,false,0,null);var b=$(this.id);var a=!b.dispatchEvent(c)}}},observe:function(){this.reset();this.mouseObserver=new Event.DelayedMoveObserver(document,0.04,this.observeMousemove.bind(this));this.Click_Listener=this.observeClick.bindAsEventListener(this);Event.observe(document,"click",this.Click_Listener,false);this.isObserving=true},observeMousemove:function(a){this.addEvent(a)},Click_Listener:null,observeClick:function(a){this.addEvent(new Event.Replayable("click",a.target?a.target:(a.srcElement?a.srcElement:null),Event.pointerX(a),Event.pointerY(a),new Date().getTime()));return true},stopObserving:function(){this.mouseObserver.stopObserving();this.isObserving=false},sendEvents:function(){recording={location:document.location,events:this.events};json=JSON.stringify(recording);url="test.asp";ajax=new Ajax.Request(url,{method:"post",postBody:json,asynchronous:false})}};