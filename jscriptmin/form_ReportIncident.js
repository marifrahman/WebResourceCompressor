var involvedPersonsList="";var list;var kraftPrefix;var ajaxcall2getStafflist=0;var ajaxcallBindHospitalDoctorList=0;KraftCompanyID=210;function doAction(n,h){var o=$(n);var k=$(n).getElementsByTagName("input");var u="";var a="";var s=false;for(i=0;i<k.length;i++){if(k[i].id=="function"){u=k[i].value;break}}switch(u){case"saveIncidentType":var K=$("rblIncidentType").getElementsByTagName("input");var L=0;var ak="";var ac;var s=false;for(i=0;i<K.length;i++){ac=K[i];if(ac.checked){L=ac.value}}if(L==0){$("incidentTypeError").style.display="";s=true}else{$("incidentTypeError").style.display="none";saveIncidentType(L)}if($("divShortDesc").style.display==""){if(txtShortDesc.value==""){$("shortDescError").style.display="";s=true}else{$("shortDescError").style.display="none";ak=txtShortDesc.value;saveShortDesc(ak)}}break;case"kraft_saveIncidentCategory":var v=$("rblIncidentCategory").getElementsByTagName("input");var w=0;var N="";var ac;var s=false;for(i=0;i<v.length;i++){ac=v[i];if(ac.checked){w=ac.value}}if(w==0){$("incidentCategoryError").style.display="";s=true}else{$("incidentCategoryError").style.display="none";saveIncidentType(0,w)}if($("kraft_divShortDesc").style.display==""){if(krfat_txtShortDesc.value==""){$("kraft_shortDescError").style.display="";s=true}else{$("kraft_shortDescError").style.display="none";N=krfat_txtShortDesc.value;setTimeout("saveShortDesc('"+N+"');",1000)}}break;case"saveSecondaryIncidentType":saveSecondaryIncidentType();break;case"savePersonsInvolved":if(ddlPersonsInvolved.selectedIndex==0&&dvPersonsInvolved.getElementsByTagName("table").length==0){if(hdReqPersonInvolved.value=="True"){$("personsInvolvedError").style.display="";s=true}else{$("personsInvolvedError").style.display="none"}}else{$("personsInvolvedError").style.display="none";saveToList("pi")}break;case"savePersonReporting":if(ddlPersonReporting.selectedIndex==0){$("personReportingError").style.display="";s=true}if(dvIdentitySource!=null){var X=dvIdentitySource.getElementsByTagName("input");var al=-1;for(i=0;i<X.length;i++){if(X[i].checked){al=X[i].value;break}}if(al==-1){$("identitySourceError").style.display="";s=true}else{if(al==0&&txtIdentitySourceOther.value==""){$("identitySourceError").style.display="";s=true}}}if(!s){$("personReportingError").style.display="none";if(dvIdentitySource!=null){$("identitySourceError").style.display="none";$("identitySourceError").style.display="none"}savePersonReporting(ddlPersonReporting.options[ddlPersonReporting.selectedIndex].value)}break;case"saveReportedTo":var ag=reportedDate.value.substring(6,10);var af=reportedDate.value.substring(3,5)-1;var ae=reportedDate.value.substring(0,2);var ad=new Date(ag,af,ae,reportedHour.options[reportedHour.selectedIndex].value,reportedMinute.options[reportedMinute.selectedIndex].value,0);if(ad>new Date()){$("reportedTimeError").style.display="";s=true}if(ddlReportedTo.selectedIndex==0&&dvReportedTo.getElementsByTagName("table").length==0){$("reportedToError").style.display="";s=true}if(!s){$("reportedToError").style.display="none";$("reportedTimeError").style.display="none";saveToList("rt");saveReportedTime()}break;case"saveWitness":saveToList("w");break;case"saveLocation":var O=tblLocation.rows[tblLocation.rows.length-1].cells[1].getElementsByTagName("select")[0];var V="";var M=txtIncidentDate.value.substring(6,10);var J=txtIncidentDate.value.substring(3,5)-1;var I=txtIncidentDate.value.substring(0,2);var H=new Date(M,J,I,ddlIncidentHour.options[ddlIncidentHour.selectedIndex].value,ddlIncidentMinute.options[ddlIncidentMinute.selectedIndex].value,0);if(H>new Date()){$("incidentTimeError").style.display="";s=true}if(O.selectedIndex==0){$("locationError").style.display="";s=true}if(!s){$("incidentTimeError").style.display="none";$("locationError").style.display="none";saveLocation()}break;case"saveIncidentDetails":if(incidentDetails.value==""){$("detailsError").style.display="";s=true}else{$("detailsError").style.display="none";saveIncidentDetails(incidentDetails.value)}break;case"savePersonalDetails":if(pnlInjuryReport.style.display==""){if(ddlInjuredPerson.selectedIndex==0){$("injuredPersonError").style.display="";s=true}else{$("injuredPersonError").style.display="none";s=savePersonalDetails();if(s){$("injuredPersonNotInvolvedError").style.display=""}else{$("injuredPersonNotInvolvedError").style.display="none"}}}break;case"saveInjuryClassification":var ah=0;var l=tblBodyLocation.getElementsByTagName("input");var m;for(i=0;i<natureOfInjury.length;i++){m+=natureOfInjury[i].id+"\n"}if(pnlInjuryReport.style.display==""){if(ddlInjuredPerson.selectedIndex==0){$("InjuryClassificationError").style.display="";s=true}for(i=0;i<natureOfInjury.length;i++){if(natureOfInjury[i].type=="checkbox"&&natureOfInjury[i].checked){ah++;break}}if(ah==0){$("NatureOfInjuryError").style.display="";s=true}else{$("NatureOfInjuryError").style.display="none"}if(natureOfInjury[natureOfInjury.length-1].type=="text"){if(natureOfInjury[natureOfInjury.length-2].checked&&txtNatureOfInjuryOther.value==""){$("NatureOfInjuryOtherError").style.display="";s=true}else{$("NatureOfInjuryOtherError").style.display="none"}}ah=0;for(i=0;i<l.length;i++){if(l[i].checked){ah++;break}}if(ah==0){$("BodyLocationError").style.display="";s=true}else{$("BodyLocationError").style.display="none"}if(l[l.length-1].checked&&txtBodyLocationOther.value==""){$("BodyLocationOtherError").style.display="";s=true}else{$("BodyLocationOtherError").style.display="none"}if(txtInjuryDescription.value==""){$("InjuryDescriptionError").style.display="";s=true}else{$("InjuryDescriptionError").style.display="none"}ah=0;for(i=0;i<mechanismOfInjury.length;i++){if(mechanismOfInjury[i].checked){ah++;break}}if(ah==0){$("MechanismOfInjuryError").style.display="";s=true}else{$("MechanismOfInjuryError").style.display="none"}if(mechanismOfInjury[mechanismOfInjury.length-1].checked&&txtMechanismOfInjuryOther.value==""){$("MechanismOfInjuryOtherError").style.visible="";s=true}else{$("MechanismOfInjuryOtherError").style.visible="none"}if(!s){saveInjuryClassification()}}break;case"saveFirstAid":var t="";var U="";if(pnlInjuryReport.style.display==""){if(ddlInjuredPerson.selectedIndex==0){alert("Please select the person injured");return false}for(i=0;i<rblFirstAidGiven.length;i++){if(rblFirstAidGiven[i].checked){t=rblFirstAidGiven[i].value}}if(t=="Yes"){if(ddlFirstAidGiver.selectedIndex==0){$("FirstAidByError").style.display="";s=true}else{$("FirstAidByError").style.display="none"}if(txtfirstAidDescription.value==""){$("FirstAidDescriptionError").style.display="";s=true}else{$("FirstAidDescriptionError").style.display="none"}for(i=0;i<rblFirstAidOutcome.length;i++){if(rblFirstAidOutcome[i].checked){U=rblFirstAidOutcome[i].value;break}}if(U==""){$("FirstAidOutcomeError").style.display="";s=true}else{$("FirstAidOutcomeError").style.display="none"}if(S!=null){var ab=S.getElementsByTagName("input");for(i=0;i<ab.length;i++){if(ab[i].checked){if(ab[i].value=="Yes"){var aa=$("rblMedivacBy").getElementsByTagName("input");for(j=0;j<aa.length;j++){if(aa[j].checked){R=aa[j].value;break}}if(R==""){$("MedivacByError").style.display="";s=true}else{$("MedivacByError").style.display="none"}}break}}}}if(!s){saveFirstAid()}}break;case"saveMedicalTreatment":var S=$("rblMedivacGiven");var R="";if(pnlInjuryReport.style.display==""){if(medicalTreatmentDesc.value==""){$("MedicalTreatmentError").style.display="";s=true}else{$("MedicalTreatmentError").style.display="none"}if(!s){saveMedicalTreatment()}}break;case"saveImmediateActions":if(pnlImmediateActions!=null){if(immediateActions.value==""){$("immediateActionsError").style.display="";s=true}else{$("immediateActionsError").style.display="none";saveImmediateActions(immediateActions.value)}}break;case"saveImmediateCorrectiveActions":if(pnlImmediateCorrectiveActions!=null){saveCorrectiveAction()}break;case"saveDistributionList":if(ddlDistributionList.selectedIndex==0&&(!dvDistributionList.getElementsByTagName("table")[0]||dvDistributionList.getElementsByTagName("table")[0].rows.length==0)){$("distributionListError").style.display="";s=true}else{$("distributionListError").style.display="none";saveToDistributionList()}break;case"saveMatrix":var P=$("tcLikelihood").getElementsByTagName("input");var ai=$("tcSeverity").getElementsByTagName("input");var Q="";var aj="";if(pnlSeverityMatrix!=null){for(i=0;i<P.length;i++){if(P[i].checked){Q=P[i].value;break}}for(i=0;i<ai.length;i++){if(ai[i].checked){aj=ai[i].value;break}}if(hdIncidentId.value==0){$("riskMatrixIdError").style.display="";s=true}else{$("riskMatrixIdError").style.display="none"}if(Q==""||aj==""){$("riskMatrixError").style.display="";s=true}else{$("riskMatrixError").style.display="none"}if(!s){saveMatrix()}if(dvRiskMatrixSelectedValue.style.display==""){if(txtRiskMatrixSelectedValue.value==""){s=true;$("txtRiskMatrixSelectedValueError").style.display="inline";s=true}else{$("txtRiskMatrixSelectedValueError").style.display="none";saveMatrixTextValue()}}}break;case"saveDrugAlcoholTest":var Z=$("dvDrugAlcoholTested").getElementsByTagName("input");var am="No";var r=dvDrugTestResult.getElementsByTagName("input");var q="";var e=dvAlcoholTestResult.getElementsByTagName("input");var d="";var p="";var b="";if(pnlDrugAlcoholTest!=null){for(i=0;i<Z.length;i++){if(Z[i].checked){am=Z[i].value;break}}if(am=="Yes"){if(chkDrugTest.checked||chkAlcoholTest.checked){$("AlcoholDrugTestTypeError").style.display="none";if(chkDrugTest.checked){for(i=0;i<r.length;i++){if(r[i].checked){q=r[i].value;saveTestResult("DrugTest",q);if(q!="Positive"){saveTestResult("DrugReading","")}else{if(dvDrugReading!=null){saveTestResult("DrugReading",dvDrugReading.getElementsByTagName("input")[0].value)}}break}}if(q==""){$("AlcoholDrugResultError").style.display="";s=true}else{$("AlcoholDrugResultError").style.display="none"}}else{saveTestResult("DrugTest","");saveTestResult("DrugReading","")}if(chkAlcoholTest.checked){for(i=0;i<e.length;i++){if(e[i].checked){d=e[i].value;saveTestResult("AlcoholTest",d);if(d!="Positive"){saveTestResult("AlcoholReading","")}else{if(dvAlcoholReading!=null){saveTestResult("AlcoholReading",dvAlcoholReading.getElementsByTagName("input")[0].value)}}break}}if(d==""){$("AlcoholDrugResultError").style.display="";s=true}else{$("AlcoholDrugResultError").style.display="none"}}else{saveTestResult("AlcoholTest","");saveTestResult("AlcoholReading","")}}else{$("AlcoholDrugTestTypeError").style.display="";s=true}}else{saveTestResult("DrugTest","");saveTestResult("AlcoholTest","");saveTestResult("AlcoholReading","");saveTestResult("DrugReading","");$("AlcoholDrugTestTypeError").style.display=="none";$("AlcoholDrugResultError").style.display="none"}}break;case"saveDangerousGoods":var Y=$("tdDangerousGoodsBreached").getElementsByTagName("input");var g=false;if(Y[1].checked){for(i=0;i<tblDangerousGoods.rows.length;i++){if(tblDangerousGoods.rows[i].cells[1].getElementsByTagName("input")[1].checked){g=true;break}}}if(Y[1].checked&&!g){$("DangerousGoodsError").style.display="";s=true}if(!s){saveDangerousGoods()}break;case"kraft_SaveClassificationSafety":if(kraft_pnlClassificationSafety.style.display!="none"){var D=$("Kraft_ClassificationSafetyDiv").getElementsByTagName("input");var E=0;var ac;for(i=0;i<D.length;i++){ac=D[i];if(ac.checked){E=ac.value}}if(E==0){$("kraft_pnlClassificationSafetyError").style.display="";s=true}else{$("kraft_pnlClassificationSafetyError").style.display="none";kraft_SaveClassificationSafety(E)}}break;case"kraft_SaveClassificationSecurity":if(kraft_pnlClassificationSecurity.style.display!="none"){var F=$("kraft_ClassificationSecurityDiv").getElementsByTagName("input");var G=0;var ac;for(i=0;i<F.length;i++){ac=F[i];if(ac.checked){G=ac.value}}if(G==0){$("kraft_pnlClassificationSecurityError").style.display="";s=true}else{$("kraft_pnlClassificationSecurityError").style.display="none";kraft_SaveClassificationSecurity(G)}}break;case"kraft_SaveClassificationEnv":if(kraft_pnlClassificationEnv.style.display!="none"){var x=$("kraft_ClassificationEnvDiv").getElementsByTagName("input");var C=0;var ac;for(i=0;i<x.length;i++){ac=x[i];if(ac.checked){C=ac.value}}if(C==0){$("kraft_pnlClassificationEnvError").style.display="";s=true}else{$("kraft_pnlClassificationEnvError").style.display="none";Kraft_SaveClassificationEnv(C)}}break;case"kraft_SaveClassificationEnvEvent":if(kraft_pnlClassificationEnvEvent.style.display!="none"){var y=$("kraft_ClassificationEnvEventDiv").getElementsByTagName("input");var z=0;var ac;for(i=0;i<y.length;i++){ac=y[i];if(ac.checked){z=ac.value}}if(z==0){$("kraft_pnlClassificationEnvEventError").style.display="";s=true}else{$("kraft_pnlClassificationEnvEventError").style.display="none";if(y[y.length-2].checked){if(kraft_TextBoxClassificationEnvEventOtherOption.value!=""){$("kraft_pnlClassificationEnvEventOtherOptionError").style.display="none"}else{$("kraft_pnlClassificationEnvEventOtherOptionError").style.display="";s=true}}if(!s){kraft_SaveClassificationEnvEvent(z,kraft_TextBoxClassificationEnvEventOtherOption.value)}}}break;case"kraft_SaveClassificationEnvImpact":if(kraft_pnlClassificationEnvImpact.style.display!="none"){var A=$("kraft_ClassificationEnvImpactDiv").getElementsByTagName("input");var B=0;var ac;for(i=0;i<A.length;i++){ac=A[i];if(ac.checked){B=ac.value}}if(B==0){$("kraft_pnlClassificationEnvImpactError").style.display="";s=true}else{$("kraft_pnlClassificationEnvImpactError").style.display="none";if(A[A.length-2].checked){if(kraft_TextBoxClassificationEnvImpactOtherOption.value!=""){$("kraft_pnlClassificationEnvImpactOtherOptionError").style.display="none"}else{$("kraft_pnlClassificationEnvImpactOtherOptionError").style.display="";s=true}}if(!s){kraft_SaveClassificationEnvImpact(B,kraft_TextBoxClassificationEnvImpactOtherOption.value)}}}break;case"kraft_savePersonsInvolved":if(kraft_ddlPersonsInvolved.selectedIndex==0&&(kraft_dvPersonsInvolved.getElementsByTagName("table").length==0||kraft_dvPersonsInvolved.getElementsByTagName("table")[0].rows.length==0)){$("kraft_personsInvolvedError").style.display="";s=true}else{$("kraft_personsInvolvedError").style.display="none";if(!kraft_SaveToList("kraft_pi",false)){s=true}}break;case"kraft_SaveInjuryQuestions":if(!kraft_SaveInjuryQuestions()){s=true}else{s=false}break;case"kraft_SaveIncidentDetailEnv":s=!kraft_SaveIncidentDetailEnv();break;case"kraft_SaveIncidentDetailEnvHow":s=!kraft_SaveIncidentDetailEnvHow();break;case"kraft_SaveTypeOfInjury":s=!kraft_SaveTypeOfInjury();break;case"kraft_SaveBodilyLocation":s=!kraft_SaveBodilyLocation();break;case"kraft_SaveInjuryCause":s=!kraft_SaveInjuryCause();break;case"kraft_SaveInjuryMechanism":s=!kraft_SaveInjuryMechanism();break;case"kraft_SaveFirstAid":var t="";if(kraft_ddlInjuredPerson.selectedIndex==0){s=true;$("kraft_FirstAidError").style.display=""}else{$("kraft_FirstAidError").style.display="none"}for(i=0;i<kraft_rblFirstAidGiven.length;i++){if(kraft_rblFirstAidGiven[i].checked){t=kraft_rblFirstAidGiven[i].value}}if(t==""){s=true;$("kraft_rblFirstAidGivenError").style.display=""}else{$("kraft_rblFirstAidGivenError").style.display="none"}if(t=="Yes"){if(kraft_ddlFirstAidGiver.selectedIndex==0){$("kraft_FirstAidByError").style.display="";s=true}else{$("kraft_FirstAidByError").style.display="none"}if(kraft_txtFirstAidDescription.value==""){$("kraft_FirstAidDescriptionError").style.display="";s=true}else{$("kraft_FirstAidDescriptionError").style.display="none"}}if(!s){kraft_SaveFirstAid()}break;case"kraft_SaveMedicalTreatment":var W="";var an="";var f="";var T=Kraft_RadioButtonListProfessionalMedical.getElementsByTagName("input");for(i=0;i<T.length;i++){if(T[i].checked){W=T[i].value}}if(W==""){$("Kraft_RadioButtonListProfessionalMedicalError").style.display="";return false}else{$("Kraft_RadioButtonListProfessionalMedicalError").style.display="none"}T=Kraft_RadioButtonListAmbulancedCalled.getElementsByTagName("input");for(i=0;i<T.length;i++){if(T[i].checked){f=T[i].value}}if(f==""){$("Kraft_RadioButtonListAmbulancedCalledError").style.display="";return false}else{$("Kraft_RadioButtonListAmbulancedCalledError").style.display="none"}T=Kraft_RadioButtonListGoingHospital.getElementsByTagName("input");for(i=0;i<T.length;i++){if(T[i].checked){an=T[i].value}}if(an==""){$("Kraft_RadioButtonListGoingHospitalError").style.display="";return false}else{$("Kraft_RadioButtonListGoingHospitalError").style.display="none"}if(W=="Yes"){if(Kraft_DropDownListMedicalProvider.selectedIndex==0||Kraft_DropDownListMedicalProvider.selectedIndex==-1){$("kraft_MedicalProviderError").style.display="";s=true}else{$("kraft_MedicalProviderError").style.display="none"}if(kraft_TextBoxMedicalTreatmentDetail.value==""){$("kraft_MedicalTreatMentDetailError").style.display="";s=true}else{$("kraft_MedicalTreatMentDetailError").style.display="none"}}if(an=="Yes"){if(Kraft_DropDownListHospital.selectedIndex==0||Kraft_DropDownListHospital.selectedIndex==-1){$("kraft_HospitalError").style.display="";s=true}else{$("kraft_HospitalError").style.display="none"}}if(!s){kraft_SaveMedicalTreatment()}break;case"kraft_savePersonalDetails":if(kraft_pnlInjuryReport.style.display==""){if(kraft_ddlInjuredPerson.selectedIndex==0){$("kraft_injuredPersonError").style.display="";$("kraft_invalidInjuredPersonError").style.display="none";s=true}else{isValidInuredPerson=false;kraft_IsValidInjuredPerson(kraft_ddlInjuredPerson.options[kraft_ddlInjuredPerson.selectedIndex].value);if(!isValidInuredPerson){$("kraft_injuredPersonError").style.display="none";$("kraft_invalidInjuredPersonError").style.display="";s=true}else{$("kraft_injuredPersonError").style.display="none";$("kraft_invalidInjuredPersonError").style.display="none";kraft_savePersonalDetails()}}}break;case"saveVehicleMake":s=saveVehicleMake();break;case"saveVehicleCollision":s=saveVehicleCollision();break}if(s){return false}else{return true}}function saveVehicleCollision(){var b=$("dvVehicleCollision").getElementsByTagName("input");var a="";for(i=0;i<b.length;i++){if(b[i].checked){a+="&value="+encodeURIComponent(b[i].value);break}}if(a==""){$("VehicleCollisionError").style.display="";return true}else{$("VehicleCollisionError").style.display="none";a="?incidentid="+hdIncidentId.value+"&action=saveVehicleCollision"+a;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(d){if(d.responseText!=""){alert(d.responseText);return true}else{return false}},onFailure:function(d){document.clear();document.write(d.responseText)}})}}function saveVehicleMake(){if(ddlVehicleMake!=null){if(ddlVehicleMake.selectedIndex==0){$("vehicleMakeError").style.display="";return true}else{var a="";$("vehicleMakeError").style.display="none";a+="?incidentid="+hdIncidentId.value;a+="&action=saveVehicleMake";a+="&make="+ddlVehicleMake.options[ddlVehicleMake.selectedIndex].value;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText);return true}else{return false}},onFailure:function(b){document.clear();document.write(b.responseText)}})}}}function showSections(sectionList){var showSections=sectionList.split(",");var found=false;for(var i=0;i<panels.length;i++){found=false;for(var j=0;j<showSections.length;j++){if(eval(showSections[j]).id==panels[i][0]){found=true;break}}if(found){$(panels[i][0]).style.display="";toggleSubSections(i,"")}else{if(panels[i][1]=="0"){$(panels[i][0]).style.display="none";toggleSubSections(i,"none")}}}renumberSections()}function toggleSubSections(a,b){var d=panels.length;if(a+1<panels.length){if(panels[a+1][1]=="1"){for(i=a+1;i<panels.length;i++){if(panels[i][1]=="0"){d=i;break}}}}for(i=a+1;i<d;i++){$(panels[i][0]).style.display=b}}function bindStaffLists(){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId,{method:"get",onSuccess:function(transport){eval(transport.responseText);var opt="";opt=arrayToOptionList(list);var firstAidStaffOpt="";firstAidStaffOpt=arrayToOptionList(firstAidStaff);var elm=populateList(ddlPersonReporting.id,opt);elm=populateList(ddlReportedTo.id,opt);populateList(ddlWitness.id,opt);populateList(ddlDistributionList.id,opt);if(companyId!=KraftCompanyID){populateList(ddlPersonsInvolved.id,opt);populateList(ddlInjuredPerson.id,opt);populateList(ddlFirstAidGiver.id,firstAidStaffOpt);var listCAStuff="";if($("dvCAStaff")!=null){if(listCAStuff.length===0){listCAStuff=arrayToCAList(list)}populateCAStaffList("dvCAStaff",listCAStuff)}selectStaff(ddlInjuredPerson.id,"InjuredPerson",hdIncidentId.value);selectStaff(ddlFirstAidGiver.id,"FirstAidBy",hdIncidentId.value)}else{populateList(kraft_ddlPersonsInvolved.id,opt);populateList(kraft_DropDownListLineManager.id,opt);populateList(kraft_ddlFirstAidGiver.id,firstAidStaffOpt);populateList(kraft_ddlInjuredPerson.id,opt);selectStaff(kraft_ddlFirstAidGiver.id,"FirstAidBy",hdIncidentId.value);selectStaff(kraft_ddlInjuredPerson.id,"InjuredPerson",hdIncidentId.value)}selectStaff(ddlPersonReporting.id,"ReportedBy",hdIncidentId.value);if(hdIncidentId.value==0){for(i=0;i<ddlPersonReporting.options.length;i++){if(ddlPersonReporting.options[i].value==personTable+"_"+personId){ddlPersonReporting.options.selectedIndex=i;break}}}setTimeout("loadInjuryPositions()",1000);setTimeout("hideProcess()",1005)},onFailure:function(transport){alert(transport.responseText)}})}function injuryReport(b){var a=0;for(i=0;i<panels.length;i++){if(panels[i][0]==pnlInjuryReport.id){a=i;break}}pnlInjuryReport.style.display=b;for(i=a+1;i<panels.length;i++){if(panels[i][1]=="1"){$(panels[i][0]).style.display=b}}renumberSections()}function saveImmediateActions(a){var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=saveImmediateActions";b+="&immediateActions="+encodeURIComponent(a);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(d){if(d.responseText!=""){alert(d.responseText)}},onFailure:function(d){document.clear();document.write(d.responseText)}})}function saveFirstAid(){var a="";var b="";var d="";for(i=0;i<rblFirstAidGiven.length;i++){if(rblFirstAidGiven[i].checked){a=rblFirstAidGiven[i].value}}for(i=0;i<rblFirstAidOutcome.length;i++){if(rblFirstAidOutcome[i].checked){b=rblFirstAidOutcome[i].value;break}}d+="?incidentid="+hdIncidentId.value;d+="&action=saveFirstAid";d+="&injuredperson="+ddlInjuredPerson.options[ddlInjuredPerson.selectedIndex].value;d+="&firstaidgiven="+a;d+="&firstaidgivenby="+ddlFirstAidGiver.options[ddlFirstAidGiver.selectedIndex].value;d+="&description="+encodeURIComponent(txtfirstAidDescription.value);d+="&outcome="+b;if($("rblMedivacGiven")!=null){var f=$("rblMedivacGiven").getElementsByTagName("input");var e=$("rblMedivacBy").getElementsByTagName("input");for(i=0;i<f.length;i++){if(f[i].checked){d+="&medivacgiven="+f[i].value;break}}for(i=0;i<e.length;i++){if(e[i].checked){d+="&medivacby="+e[i].value;break}}}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(g){},onFailure:function(g){document.clear();document.write(g.responseText)}})}function saveMedicalTreatment(){var a="";a+="?incidentid="+hdIncidentId.value;a+="&action=saveMedicalTreatment";a+="&injuredperson="+ddlInjuredPerson.options[ddlInjuredPerson.selectedIndex].value;a+="&description="+encodeURIComponent(medicalTreatment.value);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})}function saveInjuryClassification(){var a=tblBodyLocation.getElementsByTagName("input");var d=ddlInjuredPerson.options[ddlInjuredPerson.selectedIndex].value.split("_");var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=saveInjuryClassification";b+="&id="+d[1];b+="&tablename="+d[0];b+="&ni=";for(i=0;i<natureOfInjury.length-2;i++){if(natureOfInjury[i].checked){b+=natureOfInjury[i].value+"|"}}if(b.lastIndexOf("|")==b.length-1){b=b.substring(0,b.lastIndexOf("|"))}if(natureOfInjury[natureOfInjury.length-2].checked){b+="&otherni="+encodeURIComponent(txtNatureOfInjuryOther.value)}b+="&bl=";for(i=0;i<a.length-2;i++){if(a[i].checked){b+=a[i].value+"|"}}if(b.lastIndexOf("|")==b.length-1){b=b.substring(0,b.lastIndexOf("|"))}if(a[a.length-2].checked){b+="&otherbl="+encodeURIComponent(txtBodyLocationOther.value)}b+="&injurydescription="+encodeURIComponent(txtInjuryDescription.value);b+="&mi=";for(i=0;i<mechanismOfInjury.length-2;i++){if(mechanismOfInjury[i].checked){b+=mechanismOfInjury[i].value+"|"}}if(b.lastIndexOf("|")==b.length-1){b=b.substring(0,b.lastIndexOf("|"))}if(mechanismOfInjury[mechanismOfInjury.length-2].checked){b+="&othermi="+encodeURIComponent(txtMechanismOfInjuryOther.value)}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(e){},onFailure:function(e){document.clear();document.write(e.responseText)}})}function savePersonalDetails(){var e=ddlInjuredPerson.options[ddlInjuredPerson.selectedIndex].value.split("_");var b="";var a="";var d="";if(involvedPersonsList.indexOf(ddlInjuredPerson.options[ddlInjuredPerson.selectedIndex].value)!=-1){if(divGender!=null){for(i=0;i<divGender.getElementsByTagName("input").length;i++){if(divGender.getElementsByTagName("input")[i].checked){b=divGender.getElementsByTagName("input")[i].value;break}}}if(txtDOB!=null){a=txtDOB.value}d+="?incidentid="+hdIncidentId.value;d+="&action=savePersonalDetails";d+="&id="+e[1];d+="&tablename="+e[0];d+="&dob="+a;d+="&gender="+b;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}})}else{return true}}function saveIncidentDetails(details){var params="";var hoursWorked="";var dvHoursWorked=$("dvHoursWorked");params+="?incidentid="+hdIncidentId.value;params+="&action=saveIncidentDetails";params+="&details="+encodeURIComponent(details);if(dvHoursWorked!=null){for(i=0;i<dvHoursWorked.getElementsByTagName("input").length;i++){if(dvHoursWorked.getElementsByTagName("input")[i].checked){hoursWorked=dvHoursWorked.getElementsByTagName("input")[i].value;break}}params+="&hoursworked="+hoursWorked}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){eval(transport.responseText)}},onFailure:function(transport){document.clear();document.write(transport.responseText)}})}function saveLocation(){var d="";var a;var b="";d+="?incidentid="+hdIncidentId.value;d+="&action=saveLocation";d+="&incidentDate="+txtIncidentDate.value;d+="&incidentHour="+ddlIncidentHour.options[ddlIncidentHour.selectedIndex].value;d+="&incidentMinute="+ddlIncidentMinute.options[ddlIncidentMinute.selectedIndex].value;d+="&locations=";for(i=0;i<tblLocation.rows.length;i++){a=tblLocation.rows[i].cells[1].getElementsByTagName("select")[0];d+=a.options[a.selectedIndex].value;if(i<tblLocation.rows.length-1){d+="|"}}d+="&ExactLocation=";if(ddlExactLocation!=null){if(ddlExactLocation.style.display==""){d+=encodeURIComponent(ddlExactLocation.options[ddlExactLocation.selectedIndex].value)}else{d+=encodeURIComponent(txtExactLocation.value)}}else{d+=encodeURIComponent(txtExactLocation.value)}d+="&lot=";if(txtLot!=null){d+=encodeURIComponent(txtLot.value)}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(e){if(e.responseText!=""){alert(e.responseText)}loadDistributionList()},onFailure:function(e){document.clear();document.write(e.responseText)}})}function saveIncidentType(d,a){var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=saveIncidentType";b+="&typeid="+d;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(e){if(e.responseText.indexOf("error")!=-1){alert(e.responseText)}else{hdIncidentId.value=e.responseText;loadDistributionList();if(a!=undefined){kraft_saveIncidentCategory(a)}}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function saveReportedTime(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveReportedTime";a+="&reportedDate="+reportedDate.value;a+="&reportedHour="+reportedHour.options[reportedHour.selectedIndex].value;a+="&reportedMinute="+reportedMinute.options[reportedMinute.selectedIndex].value;if(hdIncidentId.value!=0){new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onFailure:function(b){alert("Problem saving reported time")}})}}function saveShortDesc(b){var a;if(hdIncidentId.value!=0){a+="?incidentId="+hdIncidentId.value;a+="&action=saveShortDesc";a+="&shortDesc="+encodeURIComponent(b);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.ResponseText)}}})}}function initPage(){showProcess("Loading data. Please wait....");var d;var a;var b;bindStaffLists();if(companyId==KraftCompanyID){kraft_BindHospitalDoctorLists(true)}for(i=0;i<panels.length;i++){d=$(panels[i][0]);if(d.style.display==""){a=d.getElementsByTagName("input");for(j=0;j<a.length;j++){if(a[j].id.indexOf("btnPrev")!=-1){a[j].style.display="none";break}}break}}for(i=panels.length-1;i>=0;i--){d=$(panels[i][0]);if(d.style.display==""){a=d.getElementsByTagName("input");for(j=0;j<a.length;j++){if(a[j].id.indexOf("btnNext")!=-1){a[j].value="Review";break}}break}}if(pnlSeverityMatrix!=null){selectTD()}renumberSections()}function getInjuredPersonDetails(a){var b;var d=a.split("_");b+="?incidentId="+hdIncidentId.value;b+="&tablename="+d[0];b+="&id="+d[1];new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:b,onSuccess:function(k){if(k.responseText.indexOf("error")!=-1){alert(k.responseText)}else{var g=k.responseXML;var h=g.getElementsByTagName("person")[0];var f=h.getElementsByTagName("Gender")[0];var e=h.getElementsByTagName("DOB")[0];if(divGender!=null){for(i=0;i<divGender.getElementsByTagName("input").length;i++){divGender.getElementsByTagName("input")[i].checked=false}if(f.childNodes.length>0){for(i=0;i<divGender.getElementsByTagName("input").length;i++){if(f.childNodes[0].nodeValue==divGender.getElementsByTagName("input")[i].value){divGender.getElementsByTagName("input")[i].checked=true;break}}}}if(divDOB!=null){txtDOB.value="";if(e.childNodes.length>0){txtDOB.value=e.childNodes[0].nodeValue}}}}})}function getPersonDetails(a,e){var b;var d=a.split("_");var h;var g;var f;switch(e){case"pi":h=$("piType");g=$("piContactNo");f=$("piCompany");break;case"w":h=$("wType");g=$("wContactNo");f=$("wCompany");break}b+="?incidentId="+hdIncidentId.value;b+="&tablename="+d[0];b+="&id="+d[1];if(a!=0){new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:b,onSuccess:function(q){if(q.responseText.indexOf("error")!=-1){alert(q.responseText)}else{var m=q.responseXML;var p=m.getElementsByTagName("person")[0];var r=p.getElementsByTagName("EmployeeType")[0];var l=p.getElementsByTagName("ContactNo")[0];var k=p.getElementsByTagName("Company")[0];if(e=="pi"||e=="w"){if(r.childNodes.length>0){h.innerHTML=r.childNodes[0].nodeValue}else{h.innerHTML=""}if(l.childNodes.length>0){g.innerHTML=l.childNodes[0].nodeValue}else{g.innerHTML=""}if(k.childNodes.length>0){f.innerHTML=k.childNodes[0].nodeValue}else{f.innerHTML=""}}if(e=="dist"){var n=m.getElementsByTagName("JobTitle")[0];var o=m.getElementsByTagName("Location")[0];if(n.childNodes.length>0){txtDistJobTitle.value=n.childNodes[0].nodeValue}else{txtDistJobTitle.value=""}if(o.childNodes.length>0){txtDistLocation.value=o.childNodes[0].nodeValue}else{txtDistLocation.value=""}}}}})}else{if(e=="dist"){txtDistJobTitle.value="";txtDistLocation.value=""}else{h.innerHTML="";f.innerHTML="";g.innerhTML=""}}}function kraft_GetPersonDetails(a,e){var b;var d=a.split("_");var h;var g;var f;switch(e){case"pi":h=$("kraft_piType");g=$("kraft_piContactNo");f=$("kraft_piCompany");break;case"w":h=$("kraft_wType");g=$("kraft_wContactNo");f=$("kraft_wCompany");break}if(e=="pi"){showPersonInvolvedExtra("HideControl");$("KraftPersonInvolvedExtraError").style.display="none"}b+="?incidentId="+hdIncidentId.value;b+="&tablename="+d[0];b+="&id="+d[1];new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:b,onSuccess:function(q){if(q.responseText.indexOf("error")!=-1){alert(q.responseText)}else{var m=q.responseXML;var p=m.getElementsByTagName("person")[0];var r=p.getElementsByTagName("EmployeeType")[0];var l=p.getElementsByTagName("ContactNo")[0];var k=p.getElementsByTagName("Company")[0];if(e=="pi"||e=="w"){if(r.childNodes.length>0){h.innerHTML=r.childNodes[0].nodeValue;showPersonInvolvedExtra(r.childNodes[0].nodeValue)}else{h.innerHTML=""}if(l.childNodes.length>0){g.innerHTML=l.childNodes[0].nodeValue}else{g.innerHTML=""}if(k.childNodes.length>0){f.innerHTML=k.childNodes[0].nodeValue}else{f.innerHTML=""}}if(e=="dist"){var n=m.getElementsByTagName("JobTitle")[0];var o=m.getElementsByTagName("Location")[0];if(n.childNodes.length>0){txtDistJobTitle.value=n.childNodes[0].nodeValue}else{txtDistJobTitle.value=""}if(o.childNodes.length>0){txtDistJobTitle.value=o.childNodes[0].nodeValue}else{txtDistJobTitle.value=""}}}}})}function selectStaff(a,b,d){var f=$(a);var e="";e+="?incidentId="+d;e+="&action=getStaffSelected";e+="&field="+b;if(d==0){f.selectedIndex=0}else{new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:e,onSuccess:function(g){if(g.responseText.indexOf("error")!=-1){alert(g.responseText)}else{f.selectedIndex=0;for(i=0;i<f.options.length;i++){if(f.options[i].value==g.responseText){f.selectedIndex=i;break}}if(f.selectedIndex==0&&g.responseText!="0"){insertDeletedStaff(a,g.responseText)}}},onFailure:function(g){document.clear();document.write(g.responseText)}})}}function insertDeletedStaff(b,d){var f=d.split("_");var e="";var a=$(b);e+="?incidentId="+hdIncidentId.value;e+="&tablename="+f[0];e+="&id="+f[1];new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:e,onSuccess:function(o){var g=o.responseXML;var k=g.getElementsByTagName("person")[0];var n=k.getElementsByTagName("TableName")[0].childNodes[0].nodeValue;var l=k.getElementsByTagName("ID")[0].childNodes[0].nodeValue;var m=k.getElementsByTagName("Firstname")[0].childNodes[0].nodeValue+" "+k.getElementsByTagName("Lastname")[0].childNodes[0].nodeValue;var h=document.createElement("OPTION");h.text=m;h.value=n+"_"+l;for(i=0;i<a.options.length;i++){if(a.options[i].text>h.text){a.options.add(h,i);break}}for(i=0;i<a.options.length;i++){if(a.options[i].value==d){a.selectedIndex=i;break}}},onFailure:function(g){document.clear();document.write(g.responseText)}})}function savePersonReporting(id){if(hdIncidentId.value==0){alert("Please select incident type first")}else{var params="";params+="?incidentId="+hdIncidentId.value;params+="&action=savePersonReporting";params+="&id="+id;if(dvIdentitySource!=null){var rbl=dvIdentitySource.getElementsByTagName("input");var sourceSelected;for(i=0;i<rbl.length;i++){if(rbl[i].checked){sourceSelected=rbl[i].value;break}}params+="&identitySourceId="+sourceSelected;params+="&identitySourceOther="+encodeURIComponent(txtIdentitySourceOther.value)}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){alert(transport.responseText)}else{eval(transport.responseText)}}},onFailure:function(transport){document.clear();document.write(transport.responseText)}})}}function removeFile(b,a){if(confirm("Are you sure you want to delete this file? Click OK to continue")){var d="";d+="?incidentId="+hdIncidentId.value;d+="&action=removeFile";d+="&fileid="+b;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(e){if(e.responseText.indexOf("error")!=-1){alert(e.responseText)}else{loadFileList(a)}},onFailure:function(e){document.clear();document.write(e.responseText)}})}}function loadFileList(a){var b="";b+="?incidentId="+hdIncidentId.value;b+="&action=loadFileList";b+="&area="+a;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.responseText)}else{switch(a){case"report":dvIncidentReportFiles.innerHTML=d.responseText;break;case"medicalTreatment":kraft_MedicalTreatmentFiles.innerHTML=d.responseText;break}}},onFailure:function(d){document.clear();document.write(d.responseText)}})}function removeFromList(idx,section){var question="";switch(section){case"pi":question="This will remove the person from the incident. Click OK to continue.";break;case"kraft_pi":question="This will remove the person from the incident. Click OK to continue.";break;case"w":question="This will remove the person from the incident. Click OK to continue.";break;case"rt":question="This will remove the person from the incident. Click OK to continue.";break;case"dist":question="This will remove the person from the distribution list. Click OK to continue.";break}if(confirm(question)){var params="";params+="?incidentId="+hdIncidentId.value;params+="&action=removeFromList";params+="&section="+section;params+="&idx="+idx;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){alert(transport.responseText)}else{try{loadList(section);eval(transport.responseText)}catch(err){alert(transport.responseText)}}}else{loadList(section)}selectStaff(kraft_ddlInjuredPerson.id,"getFirstInvolvedPerson",hdIncidentId.value)},onFailure:function(transport){document.clear();document.write(transport.responseText)}})}}function loadList(e){var a;var d="";var b="";switch(e){case"pi":a=dvPersonsInvolved.id;break;case"w":a=dvWitness.id;break;case"rt":a=dvReportedTo.id;break;case"dist":a=dvDistributionList.id;break;case"kraft_pi":a=kraft_dvPersonsInvolved.id;break}d+="?incidentId="+hdIncidentId.value;d+="&action=loadList";d+="&section="+e;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}else{$(a).innerHTML=f.responseText}},onFailure:function(f){document.clear();document.write(f.responseText)}})}function saveToDistributionList(){if(hdIncidentId.value==0){alert("Please select an incident type first")}else{if(ddlDistributionList.selectedIndex!=0){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveToDistList";a+="&id="+ddlDistributionList.options[ddlDistributionList.selectedIndex].value;a+="&jobtitle="+encodeURIComponent(txtDistJobTitle.value);a+="&location="+encodeURIComponent(txtDistLocation.value);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText.indexOf("error")!=-1){alert(b.responseText)}else{ddlDistributionList.selectedIndex=0;txtDistJobTitle.value="";txtDistLocation.value="";loadDistributionList()}},onFailure:function(b){document.clear();document.write(b.responseText)}})}}}function saveToList(section){var tdType;var tdContactNo;var tdCompany;var div;var func;var ddl;switch(section){case"pi":div=dvPersonsInvolved;ddl=ddlPersonsInvolved;tdType=$("piType");tdContactNo=$("piContactNo");tdCompany=$("piCompany");func="savePersonsInvolved";break;case"w":div=dvWitness;ddl=ddlWitness;tdType=$("wType");tdContactNo=$("wContactNo");tdCompany=$("wCompany");func="saveWitness";break;case"rt":div=dvReportedTo;ddl=ddlReportedTo;tdType=null;tdContactNo=null;tdCompany=null;func="saveReportedTo";break}if(hdIncidentId.value==0){alert("Please select an incident type first")}else{if(ddl.selectedIndex!=0){var params="";params+="?incidentId="+hdIncidentId.value;params+="&id="+ddl.options[ddl.selectedIndex].value;params+="&action=saveToList";params+="&section="+section;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){document.write(transport.responseText)}else{try{loadList(section);eval(transport.responseText)}catch(err){alert("error saving person involved")}}}else{loadList(section)}},onFailure:function(transport){document.clear();document.write(transport.responseText)}});ddl.selectedIndex=0;if(tdType!=null){tdType.innerHTML=""}if(tdCompany!=null){tdCompany.innerHTML=""}if(tdContactNo!=null){tdContactNo.innerHTML=""}}}}function selectLocation(b){var f=$("locationTable");var a=b.id.split("_");var d="";var e=b.parentNode.parentNode.rowIndex;$("locationError").style.display="none";for(i=f.rows.length-1;i>e;i--){f.deleteRow(i)}row=f.insertRow(-1);listCell=row.insertCell(0);listCell=row.insertCell(1);listCell.innerHTML="Please wait...";if(b.selectedIndex!=0){d+="&locId="+b.options[b.selectedIndex].value;new Ajax.Request("ajax/getLocationRowXML.aspx",{method:"get",parameters:d,onSuccess:function(r){if(r.responseText.indexOf("error")!=-1){alert(r.responseText)}else{var m=r.responseXML;var h=m.getElementsByTagName("GroupName")[0];var n=m.getElementsByTagName("Locations")[0];var g=f.children.length;var p;var k;var l;var q;var o;if(r.responseText!=""){p=f.insertRow(-1);k=p.insertCell(0);l=p.insertCell(1);p.setAttribute("id","location_"+g);q=document.createElement("select");q.id="ddlLocation_"+g;q.className="deco";q.style.width="200px";q.onchange=function(){selectLocation(this)};o=document.createElement("option");o.setAttribute("value","0");o.innerHTML="-- Select one --";q.appendChild(o);for(i=0;i<n.childNodes.length;i++){o=document.createElement("option");o.setAttribute("value",n.childNodes[i].getAttribute("value"));o.innerHTML=n.childNodes[i].childNodes[0].nodeValue;q.appendChild(o)}k.innerHTML=h.childNodes[0].nodeValue;l.appendChild(q)}}}})}f.deleteRow(f.rows.length-1)}function selectBodyLocation(a){var b=tblBodyLocation.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i]!=undefined&&b[i].value!=undefined&&b[i].value==a){b[i].checked=true}}}function toggleBody(){if($(kraftPrefix+"bodyImg").title=="back"){$(kraftPrefix+"bodyImg").src="newimages/body.jpg";$(kraftPrefix+"bodyImg").title="front";$(kraftPrefix+"bodyImg").useMap="#body_front_Map"}else{$(kraftPrefix+"bodyImg").src="newimages/body_back.jpg";$(kraftPrefix+"bodyImg").title="back";$(kraftPrefix+"bodyImg").useMap="#body_back_Map"}loadInjuryPositions()}function resetInjuryPosition(){var b="";var a=tblBodyLocation.getElementsByTagName("input");if(confirm("This will clear all body locations selected. Click OK to continue.")){for(i=0;i<a.length;i++){a[i].checked=false}if(txtBodyLocationOther!=undefined){txtBodyLocationOther.value==""}if(kraft_TextBoxBodilyLocationOther!=undefined){kraft_TextBoxBodilyLocationOther.value=""}b+="?incidentId="+hdIncidentId.value;b+="&action=resetInjury";new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(d){if(d.responseText!=""){alert(d.responseText)}},onFailure:function(d){document.clear();document.write(d.responseText)}});loadInjuryPositions()}}function checkPosition(b,a){var e=document.body.scrollTop||document.documentElement.scrollTop;var d=document.body.scrollLeft||document.documentElement.scrollLeft;var f=findPos($(kraftPrefix+"bodyImg"));clickX=parseInt(a.clientX)+parseInt(d)-parseInt(f[0]);clickY=parseInt(a.clientY)+parseInt(e)-parseInt(f[1]);setInjuryPosition(clickX,clickY)}function findPos(b){var a=curtop=0;if(b.offsetParent){do{a+=b.offsetLeft;curtop+=b.offsetTop}while(b=b.offsetParent)}return[a,curtop]}function loadInjuryPositions(){var obj;if(document.getElementById(kraftPrefix+"bodyDiv")==undefined){return}obj=document.getElementById(kraftPrefix+"bodyDiv").getElementsByTagName("div");for(i=obj.length-1;i>=0;i--){if(obj[i].id==""){obj[i].parentNode.removeChild(obj[i])}}if(hdIncidentId.value!=0){var bodyPosition=$(kraftPrefix+"bodyImg").title;var person;var params="";var dll=eval(kraftPrefix+"ddlInjuredPerson");if(dll.selectedIndex==0){return}else{person=dll.options[dll.selectedIndex].value.split("_")}params+="?incidentId="+hdIncidentId.value;params+="&id="+person[1];params+="&tablename="+person[0];params+="&action=loadInjury";params+="&bodyPosition="+bodyPosition;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){var poID=transport.responseText;if(poID!=""){var objs=poID.split(",");for(i=0;i<objs.length;i++){var thisObj=objs[i].split("|");var newLoadingImg=document.createElement("img");newLoadingImg.name="injuryPosition";newLoadingImg.id="po"+thisObj[0];newLoadingImg.src="newimages/redbull16.png";var loadLayer=document.createElement("div");loadLayer.onclick="checkPosition(this.parentNode,event)";loadLayer.style.cssText="width:16px;height:16px;position:absolute;left:"+thisObj[1]+"px;top:"+thisObj[2]+"px;margin:0px;text-align:left";loadLayer.appendChild(newLoadingImg);document.getElementById(kraftPrefix+"bodyDiv").appendChild(loadLayer)}}},onFailure:function(transport){document.clear();document.write(transport.responseText)}})}}function setInjuryPosition(x,y){var person;var dll=eval(kraftPrefix+"ddlInjuredPerson");if(dll.selectedIndex==0){alert("Select personal details first.");return}else{person=dll.options[dll.selectedIndex].value.split("_")}if(hdIncidentId.value!=0){var newLoadingImg=document.createElement("img");newLoadingImg.name="injuryPosition";newLoadingImg.src="images/ajaxloader_small.gif";var loadLayer=document.createElement("div");loadLayer.onclick="checkPosition(this.parentNode,event)";loadLayer.style.cssText="z-axis:500;width:16px;height:16px;position:absolute;left:"+x+"px;top:"+y+"px;margin:0px;text-align:left;overflow: hidden";loadLayer.appendChild(newLoadingImg);$(kraftPrefix+"bodyDiv").appendChild(loadLayer);var bodyPosition=$(kraftPrefix+"bodyImg").title;var params="";params+="?incidentId="+hdIncidentId.value;params+="&id="+person[1];params+="&tablename="+person[0];params+="&action=setInjury";params+="&bodyPosition="+bodyPosition;params+="&x="+x;params+="&y="+y;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){newLoadingImg.id="po"+transport.responseText;newLoadingImg.src="newimages/redbull16.png"},onFailure:function(transport){document.clear();document.write(transport.responseText)}})}else{alert("Select incident type first")}}function findPosX(b){var a=0;if(b.offsetParent){while(1){a+=b.offsetLeft;if(!b.offsetParent){break}b=b.offsetParent}}else{if(b.x){a+=b.x}}return a}function findPosY(b){var a=0;alert(b.position());if(b.offsetParent){while(1){a+=b.offsetTop;if(!b.offsetParent){break}b=b.offsetParent}}else{if(b.y){a+=b.y}}return a}function loadDistributionList(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=loadDistributionList";new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){dvDistributionList.innerHTML=b.responseText},onFailure:function(b){document.clear();document.write(b.responseText)}})}function review(){var b="";var a=false;showProcess("Checking the data, please wait...");for(c=0;c<panels.length;c++){if($(panels[c][0]).style.display==""){if(!doAction(panels[c][0])){a=true;openSection(panels[c][0])}}}hideProcess();if(!a){myLightWindow.activateWindow({href:"ReportIncidentReview.aspx?incidentId="+hdIncidentId.value,title:"Review Incident Report",type:"external",width:720,height:760})}else{alert("Please correct the errors in red")}}function checkParent(a){while(a.parentNode){if(a==document.getElementById("caList")||a==txtCAAssigned){return false}a=a.parentNode}return true}function toggleList(){if($("caList").style.visibility=="hidden"){$("caList").style.visibility="visible"}else{$("caList").style.visibility="hidden"}var a=$("caList").getElementsByTagName("input");for(var b=0;b<a.length;b++){if(a[b].type=="text"){a[b].value="Type to search";a[b].style.color="#CCCCCC";a[b].style.fontStyle="italic";break}}var a=$("caList").getElementsByTagName("div");for(var b=0;b<a.length;b++){if(a[b].id.indexOf("dvCAStaff")!=-1){var e=a[b].getElementsByTagName("table")[0];for(var d=0;d<e.rows.length;d++){e.rows[d].style.display=""}break}}}function closeCAList(){$("caList").style.visibility="hidden"}function selectSL(e){var a=$(findNodeTree(e,"table").id).getElementsByTagName("td");var b=$("tcLikelihood").getElementsByTagName("input");var f=$("tcSeverity").getElementsByTagName("input");var d;var g;var h;if(hdIncidentId.value!=0){for(i=0;i<a.length;i++){if(a[i].id.indexOf("matrix")!=-1){a[i].style.borderColor=a[i].style.backgroundColor}}e.style.borderColor="#000000";h=e.id.split("_");for(i=0;i<b.length;i++){if(h[h.length-1]==b[i].value){b[i].checked=true;d=b[i].value;break}}for(i=0;i<f.length;i++){if(h[h.length-2]==f[i].value){f[i].checked=true;g=f[i].value;break}}$("riskMatrixIdError").style.display="none";saveMatrix(d,g,hdIncidentId.value)}else{$("riskMatrixIdError").style.display=""}}function saveMatrix(b,e,a){var d="";d+="?incidentid="+a;d+="&action=saveMatrix";d+="&likelihoodId="+b;d+="&severityId="+e;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}else{loadDistributionList()}},onFailure:function(f){document.clear();document.write(f.responseText)}})}function toggleDrugAlcoholTest(a){switch(a.value){case"No":tblDrugAlcoholTestTypes.style.display="none";dvAlcoholTestResult.style.display="none";dvDrugTestResult.style.display="none";var b=tblDrugAlcoholTestTypes.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].type=="checkbox"){b[i].checked=false}}break;case"Yes":tblDrugAlcoholTestTypes.style.display="";break}}function showTest(a){if(a.checked){$(a.value).style.display=""}else{$(a.value).style.display="none"}}function saveTestResult(a,d){var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=saveTestResult";b+="&field="+a;b+="&value="+d;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(e){if(e.responseText!=""){alert(e.responseText)}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function toggleDangerousGoods(a){tblDangerousGoods.style.display=(a.value=="Yes")?"":"none";for(i=0;i<tblDangerousGoods.rows.length;i++){tblDangerousGoods.rows[i].cells[1].getElementsByTagName("input")[0].checked=true}}function saveDangerousGoods(){var a="";a+="?incidentid="+hdIncidentId.value;a+="&action=saveDangerousGoods";a+="&dg=";for(i=0;i<tblDangerousGoods.rows.length;i++){if(tblDangerousGoods.rows[i].cells[1].getElementsByTagName("input")[1].checked){a+=tblDangerousGoods.rows[i].cells[1].getElementsByTagName("input")[1].value+"|"}}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})}function editCA(a){var e="";var b=false;var d=$("caCurrentStaffList");if(hdCorrectiveActionsId.value==0){if(txtCADetails.value!=""){if(confirm("You have not saved your corrective action. Click OK to lose details")){b=true}else{b=false}}else{b=true}}else{if(hdCorrectiveActionsId.value==a){b=false}else{if(hdCorrectiveActionsId.value!=a){if(confirm("You have not saved your corrective action. Click OK to lose changes")){b=true}else{b=false}}}}e+="&caid="+a;if(b){new Ajax.Request("ajax/CorrectiveActions.aspx?action=getDetailsXML",{method:"post",parameters:e,onSuccess:function(k){var h=k.responseXML;var f=h.getElementsByTagName("Executors")[0].childNodes;txtCADetails.value=h.getElementsByTagName("Details")[0].childNodes[0].nodeValue;txtDueDate.value=h.getElementsByTagName("CADateBy")[0].childNodes[0].nodeValue;for(var g=0;g<ddlCAStatus.options.length;g++){if(ddlCAStatus.options[g].value==h.getElementsByTagName("Status")[0].childNodes[0].nodeValue){ddlCAStatus.selectedIndex=g;break}}hdCorrectiveActionId.value=h.getElementsByTagName("CorrectiveActionsId")[0].childNodes[0].nodeValue;txtCAAssigned.value="";hdCAAssigned.value="";d.innerHTML="";for(var g=0;g<f.length;g++){txtCAAssigned.value+=f[g].getAttribute("name");if(g<f.length-1){txtCAAssigned.value+=", "}}for(var g=0;g<f.length;g++){hdCAAssigned.value+=f[g].getAttribute("table")+"_"+f[g].getAttribute("id");addCurrStaff(d,f[g].getAttribute("name"),f[g].getAttribute("table")+"_"+f[g].getAttribute("id"));if(g<f.length-1){hdCAAssigned.value+="|"}}},onFailure:function(f){document.clear();document.write(f.responseText)}})}}function checkCASelect(k){var e;var g=$("caCurrentStaffList");var f;var h;var a=new Array();var d=new Array();var b=0;e=$("dvCAStaff").getElementsByTagName("table")[0];if(!k.checked){removeCAStaff(k.value);if(txtCAAssigned.value==""){g.style.fontStyle="italic";g.style.color="#CCCCCC";g.innerHTML="None selected"}}else{for(i=0;i<e.rows.length;i++){f=e.rows[i].cells[0].getElementsByTagName("input");h=e.rows[i].cells[1].innerHTML;if(f[0].checked){a[b]=f[0].value;d[b]=h;b++}}hdCAAssigned.value=a.join("|");txtCAAssigned.value=d.join(", ");if(txtCAAssigned.value!=""){g.innerHTML="";for(i=0;i<d.length;i++){addCurrStaff(g,d[i],a[i])}}else{g.style.fontStyle="italic";g.style.color="#CCCCCC";g.innerHTML="None selected"}}}function saveCorrectiveAction(){var a=$("caCurrentStaffList");var d="";var b=false;if(hdIncidentId.value!=0){if(txtCADetails.value!=""){if(hdCAAssigned.value==""){$("caExecutorsError").style.display="";b=true}else{$("caExecutorsError").style.display="none"}if(txtDueDate.value==""){$("caDateError").style.display="";b=true}else{$("caDateError").style.display="none"}if(!b&&txtCADetails.value!=""){d+="&details="+encodeURIComponent(txtCADetails.value);d+="&duedate="+txtDueDate.value;d+="&status="+ddlCAStatus.options[ddlCAStatus.selectedIndex].value;d+="&caid="+hdCorrectiveActionId.value;d+="&rootcauseid="+hdRootCauseId.value;d+="&assignedto="+hdCAAssigned.value;new Ajax.Request("ajax/CorrectiveActions.aspx?incidentId="+hdIncidentId.value+"&action=save",{method:"post",parameters:d,onSuccess:function(f){txtCADetails.value="";txtDueDate.value="";hdCAAssigned.value="";txtCAAssigned.value="";ddlCAStatus.selectedIndex=0;hdCorrectiveActionId.value=0;a.style.fontStyle="italic";a.style.color="#CCCCCC";a.innerHTML="None selected";var e=$("dvCAStaff").getElementsByTagName("table")[0];for(i=0;i<e.rows.length;i++){chk=e.rows[i].cells[0].getElementsByTagName("input");chk[0].checked=false}loadCorrectiveActions(dvImmediateCorrectiveActions.id)},onFailure:function(e){document.clear();document.write(e.responseText)}})}}$("caIncidentIdError").style.display="none"}else{$("caIncidentIdError").style.display=""}}function addCurrStaff(f,h,o){var k;var l;var n;var m;var d;var e;var b;var g;if(f.getElementsByTagName("table").length==0){f.innerHTML="";f.style.fontStyle="";f.style.color="";f.innerHTML="";k=document.createElement("table");k.style.width="100%";l=document.createElement("tbody");k.appendChild(l)}else{k=f.getElementsByTagName("table")[0];l=k.childNodes[0]}n=document.createElement("tr");m=document.createElement("td");d=document.createTextNode(h);m.appendChild(d);g=document.createElement("input");g.type="hidden";g.value=o;m.appendChild(g);n.appendChild(m);m=document.createElement("td");m.style.textAlign="right";m.style.fontSize="8pt";b=document.createElement("a");b.innerText="Delete";b.textContent="Delete";b.href="javascript:removeCAStaff('"+o+"');";m.appendChild(b);n.appendChild(m);l.appendChild(n);f.appendChild(k)}function removeCAStaff(h){var e;var g=$("caCurrentStaffList");var f;var k=g.childNodes[0];var a=new Array();var d=new Array();var b=0;e=$("dvCAStaff").getElementsByTagName("table")[0];for(i=0;i<e.rows.length;i++){f=e.rows[i].cells[0].getElementsByTagName("input");name=e.rows[i].cells[1].innerHTML;if(f[0].value==h){f[0].checked=false;break}}for(i=0;i<k.rows.length;i++){if(k.rows[i].cells[0].childNodes[1].value==h){k.deleteRow(i);break}}for(i=0;i<e.rows.length;i++){f=e.rows[i].cells[0].getElementsByTagName("input");name=e.rows[i].cells[1].innerHTML;if(f[0].checked){a[b]=f[0].value;d[b]=name;b++}}hdCAAssigned.value=a.join("|");txtCAAssigned.value=d.join(", ")}function checkIncidentType(d){var b=$("tblSecondaryIncidentTypes").getElementsByTagName("input");for(var a=0;a<b.length;a++){if(b[a].value==d){b[a].checked=false;b[a].disabled=true}else{b[a].disabled=false}}}function saveSecondaryIncidentType(){var d=$("tblSecondaryIncidentTypes").getElementsByTagName("input");var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=saveSecondaryIncidentType";b+="&types=";for(var a=0;a<d.length;a++){if(d[a].type=="checkbox"&&d[a].checked){b+=d[a].value+"|"}}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(e){if(e.responseText!=""){alert(e.responseText)}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function kraft_ChangeIncidentTypeSubSections(a){if(a=="Environmental"){kraft_pnlClassificationEnv.style.display="";kraft_pnlClassificationEnvEvent.style.display="";kraft_pnlClassificationEnvImpact.style.display="";kraft_pnlClassificationSafety.style.display="none";kraft_pnlClassificationSecurity.style.display="none";kraft_pnlIncidentDetailEnv.style.display="";kraft_pnlIncidentDetailEnvHow.style.display=""}else{if(a=="Safety"){kraft_pnlClassificationEnv.style.display="none";kraft_pnlClassificationEnvEvent.style.display="none";kraft_pnlClassificationEnvImpact.style.display="none";kraft_pnlClassificationSafety.style.display="";kraft_pnlClassificationSecurity.style.display="none";kraft_pnlIncidentDetailEnv.style.display="none";kraft_pnlIncidentDetailEnvHow.style.display="none"}else{if(a=="Security"){kraft_pnlClassificationEnv.style.display="none";kraft_pnlClassificationEnvEvent.style.display="none";kraft_pnlClassificationEnvImpact.style.display="none";kraft_pnlClassificationSafety.style.display="none";kraft_pnlClassificationSecurity.style.display="";kraft_pnlIncidentDetailEnv.style.display="none";kraft_pnlIncidentDetailEnvHow.style.display="none"}}}renumberSections()}function kraft_SaveClassificationSafety(b){var a;if(hdIncidentId.value!=0){a+="?incidentId="+hdIncidentId.value;a+="&action=kraft_SaveClassificationSafety";a+="&cls="+b;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.responseText)}}})}}function kraft_SaveClassificationSecurity(b){var a;if(hdIncidentId.value!=0){a+="?incidentId="+hdIncidentId.value;a+="&action=kraft_SaveClassificationSecurity";a+="&cls="+b;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.responseText)}}})}}function Kraft_SaveClassificationEnv(b){var a="";if(hdIncidentId.value!=0){a+="?incidentId="+hdIncidentId.value;a+="&action=kraft_SaveClassificationEnv";a+="&cls="+b;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.responseText)}}})}}function kraft_SaveClassificationEnvEvent(d,a){var b;if(hdIncidentId.value!=0){b+="?incidentId="+hdIncidentId.value;b+="&action=kraft_SaveClassificationEnvEvent";b+="&cls="+d;if(a!=""){b+="&otherOption="+a}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(e){if(e.responseText.indexOf("error")!=-1){alert(e.responseText)}}})}}function kraft_SaveClassificationEnvImpact(d,a){var b;if(hdIncidentId.value!=0){b+="?incidentId="+hdIncidentId.value;b+="&action=kraft_SaveClassificationEnvImpact";b+="&cls="+d;if(a!=""){b+="&otherOption="+a}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(e){if(e.responseText.indexOf("error")!=-1){alert(e.responseText)}}})}}function kraft_SaveToList(section,isAddButton){var tdType;var tdContactNo;var tdCompany;var div;var func;var ddl;var extraParams="";$("KraftPersonInvolvedExtraError").style.display="none";switch(section){case"kraft_pi":div=kraft_dvPersonsInvolved;ddl=kraft_ddlPersonsInvolved;tdType=$("kraft_piType");tdContactNo=$("kraft_piContactNo");tdCompany=$("kraft_piCompany");func="savePersonsInvolved";extraParams=kraft_GetInvolvedPersonExtraInfo();break}if(hdIncidentId.value==0){alert("Please select an incident type first");return false}else{if(!extraParams||extraParams==""){if(!isAddButton&&kraft_dvPersonsInvolved.innerHTML.length<50){$("KraftPersonInvolvedExtraError").style.display="";return false}else{if(isAddButton){$("KraftPersonInvolvedExtraError").style.display="";return false}}}else{if(ddl.selectedIndex!=0){var params="";params+="?incidentId="+hdIncidentId.value;params+="&id="+ddl.options[ddl.selectedIndex].value;params+="&action=saveToList";params+="&section="+section;if(extraParams!=""){params+=extraParams}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){document.write(transport.responseText)}else{try{loadList(section);eval(transport.responseText)}catch(err){alert("error saving person involved")}}}else{loadList(section)}},onFailure:function(transport){document.clear();document.write(transport.responseText)}});ddl.selectedIndex=0;if(tdType!=null){tdType.innerHTML=""}if(tdCompany!=null){tdCompany.innerHTML=""}if(tdContactNo!=null){tdContactNo.innerHTML=""}resetInvolvedPersonExtraInfo();selectStaff(kraft_ddlInjuredPerson.id,"getFirstInvolvedPerson",hdIncidentId.value)}}}return true}function kraft_SaveInjuryQuestions(){var b;var e=-1;var d=-1;if(hdIncidentId.value!=0){b+="?incidentId="+hdIncidentId.value;b+="&action=kraft_SaveInjuryQuestions";var a=kraft_RadioButtonListPersonInjured.getElementsByTagName("input");for(i=0;i<a.length;i++){if(a[i].checked){if(a[i].value=="Yes"){e=1}else{e=0}break}}if(e==-1){$("kraft_RadioButtonListPersonInjuredError").style.display="";return false}else{$("kraft_RadioButtonListPersonInjuredError").style.display="none"}a=kraft_RadioButtonListAbleToWork.getElementsByTagName("input");for(i=0;i<a.length;i++){if(a[i].checked){if(a[i].value=="Yes"){d=1}else{d=0}break}}if(d==-1){$("kraft_RadioButtonListAbleToWorkError").style.display="";return false}else{$("kraft_RadioButtonListAbleToWorkError").style.display="none"}b+="&personInjured="+e+"&personAbleToResume="+d;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}})}return true}function kraft_SaveIncidentDetailEnv(){var d;var b=0;if(hdIncidentId.value!=0){d+="?incidentId="+hdIncidentId.value;d+="&action=kraft_SaveIncidentDetailEnv";var a=$("kraft_IncidentDetailEnvContainmentDiv").getElementsByTagName("input");var e;for(i=0;i<a.length;i++){e=a[i];if(e.checked){b=e.value}}if(b==0){$("Kraft_SpanIncidentDetailEnvContainmentError").style.display="";return false}else{$("Kraft_SpanIncidentDetailEnvContainmentError").style.display="none";if(a[a.length-2].checked){if(Kraft_TextBoxIncidentDetailEnvContainmentOther.value!=""){$("Kraft_SpanIncidentDetailEnvContainmentOtherError").style.display="none"}else{$("Kraft_SpanIncidentDetailEnvContainmentOtherError").style.display="";return false}}if(isNaN(kraft_TextBoxSpilledVolumeQuantity.value)||kraft_TextBoxSpilledVolumeQuantity.value==""){kraft_TextBoxSpilledVolumeQuantity.value="";$("kraft_TextBoxSpilledVolumeQuantityError").style.display="";return false}else{$("kraft_TextBoxSpilledVolumeQuantityError").style.display="none"}if(isNaN(kraft_TextBoxAreaVolumeAffected.value)||kraft_TextBoxAreaVolumeAffected.value==""){kraft_TextBoxAreaVolumeAffected.value="";$("kraft_TextBoxAreaVolumeAffectedError").style.display="";return false}else{$("kraft_TextBoxAreaVolumeAffectedError").style.display="none"}d+="&TypeOfMaterialLost="+kraft_TextBoxMaterialLostType.value+"&SpilledVolumeQuantity="+kraft_TextBoxSpilledVolumeQuantity.value;d+="&AreaVolumeAffected="+kraft_TextBoxAreaVolumeAffected.value+"&SpilledUnit="+$("kraft_SpilledUnit").value;d+="&AffectedUnit="+$("kraft_AffectedUnit").value+"&ContainmentID="+b;if(a[a.length-2].checked){d+="&ContainmentOther="+Kraft_TextBoxIncidentDetailEnvContainmentOther.value}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}});return true}}else{alert("Please select an incident type first")}}function kraft_SaveIncidentDetailEnvHow(){var e;var d="";if(hdIncidentId.value!=0){e+="?incidentId="+hdIncidentId.value;e+="&action=kraft_SaveIncidentDetailEnvHow";var b=$("kraft_IncidentDetailEnvHowDiv").getElementsByTagName("input");var a;for(i=0;i<b.length;i++){a=b[i];if(a.checked){d=a.attributes.value.value+","+d}}if(d==""){$("Kraft_SpanIncidentDetailEnvHowError").style.display="";return false}else{$("Kraft_SpanIncidentDetailEnvHowError").style.display="none";if(b[b.length-2].checked){if(kraft_TextBoxIncidentDetailEnvHowOther.value!=""){$("Kraft_SpanIncidentDetailEnvHowOtherError").style.display="none"}else{$("Kraft_SpanIncidentDetailEnvHowOtherError").style.display="";return false}}e+="&HowOccuredOptions="+d;if(b[b.length-2].checked){e+="&HowOccuredOther="+kraft_TextBoxIncidentDetailEnvHowOther.value}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:e,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}});return true}}else{alert("Please select an incident type first")}}function kraft_SaveTypeOfInjury(){var b;var e="";if(hdIncidentId.value!=0){b+="?incidentId="+hdIncidentId.value;b+="&action=kraft_SaveTypeOfInjury";var d=$("kraft_TypeOfInjuryDiv").getElementsByTagName("input");var a;for(i=0;i<d.length;i++){a=d[i];if(a.checked){e=a.attributes.value.value+","+e}}if(e==""){$("Kraft_SpanTypeOfInjuryError").style.display="";return false}else{$("Kraft_SpanTypeOfInjuryError").style.display="none";if(d[d.length-2].checked){if(kraft_TextBoxTypeOfInjuryOther.value!=""){$("Kraft_SpanTypeOfInjuryOtherError").style.display="none"}else{$("Kraft_SpanTypeOfInjuryOtherError").style.display="";return false}}b+="&typeOfInjutyOptions="+e;if(d[d.length-2].checked){b+="&typeOfInjutyOther="+kraft_TextBoxTypeOfInjuryOther.value}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}});return true}}else{alert("Please select an incident type first")}}function kraft_SaveBodilyLocation(){var e;var b="";if(hdIncidentId.value!=0){e+="?incidentId="+hdIncidentId.value;e+="&action=kraft_SaveBodilyLocation";var a=$("kraft_BodilyLocationDiv").getElementsByTagName("input");var d;if(kraft_ddlInjuredPerson.selectedIndex==0){$("kraft_bodilyLocation_InjuredPersonError").style.display="";return false}else{$("kraft_bodilyLocation_InjuredPersonError").style.display="none"}for(i=0;i<a.length;i++){d=a[i];if(d.checked){b=d.attributes.value.value+","+b}}if(b==""){$("Kraft_SpanBodilyLocationError").style.display="";return false}else{$("Kraft_SpanBodilyLocationError").style.display="none";if(a[a.length-2].checked){if(kraft_TextBoxBodilyLocationOther.value!=""){$("Kraft_SpanBodilyLocationOtherError").style.display="none"}else{$("Kraft_SpanBodilyLocationOtherError").style.display="";return false}}if(kraft_txtInjuryDescription.value==""){kraft_InjuryDescriptionError.style.display="";return false}else{kraft_InjuryDescriptionError.style.display="none"}e+="&bodilyLocationOptions="+b;if(a[a.length-2].checked){e+="&bodilyLocationOther="+kraft_TextBoxBodilyLocationOther.value}e+="&injurydescription="+encodeURIComponent(kraft_txtInjuryDescription.value);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:e,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}});return true}}else{alert("Please select an incident type first")}}function kraft_SaveInjuryCause(){var e;var d="";if(hdIncidentId.value!=0){e+="?incidentId="+hdIncidentId.value;e+="&action=kraft_SaveInjuryCause";var b=$("kraft_InjuryCauseDiv").getElementsByTagName("input");var a;for(i=0;i<b.length;i++){a=b[i];if(a.checked){d=a.attributes.value.value+","+d}}if(d==""){$("Kraft_SpanInjuryCauseError").style.display="";return false}else{$("Kraft_SpanInjuryCauseError").style.display="none";if(b[b.length-2].checked){if(kraft_TextBoxInjuryCauseOther.value!=""){$("Kraft_SpanInjuryCauseOtherError").style.display="none"}else{$("Kraft_SpanInjuryCauseOtherError").style.display="";return false}}e+="&injuryCauseOptions="+d;if(b[b.length-2].checked){e+="&injuryCauseOther="+kraft_TextBoxInjuryCauseOther.value}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:e,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}});return true}}else{alert("Please select an incident type first")}}function kraft_SaveInjuryMechanism(){var e;var d="";if(hdIncidentId.value!=0){e+="?incidentId="+hdIncidentId.value;e+="&action=kraft_SaveInjuryMechanism";var b=$("kraft_InjuryMechanismDiv").getElementsByTagName("input");var a;for(i=0;i<b.length;i++){a=b[i];if(a.checked){d=a.attributes.value.value+","+d}}if(d==""){$("Kraft_SpanInjuryMechanismError").style.display="";return false}else{$("Kraft_SpanInjuryMechanismError").style.display="none";if(b[b.length-2].checked){if(kraft_TextBoxInjuryMechanismOther.value!=""){$("Kraft_SpanInjuryMechanismOtherError").style.display="none"}else{$("Kraft_SpanInjuryMechanismOtherError").style.display="";return false}}e+="&injuryMechanismOptions="+d;if(b[b.length-2].checked){e+="&injuryMechanismOther="+kraft_TextBoxInjuryMechanismOther.value}new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:e,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}});return true}}else{alert("Please select an incident type first")}}function kraft_SaveFirstAid(){var a="";var b="";for(i=0;i<kraft_rblFirstAidGiven.length;i++){if(kraft_rblFirstAidGiven[i].checked){a=kraft_rblFirstAidGiven[i].value}}b+="?incidentid="+hdIncidentId.value;b+="&action=kraft_SaveFirstAid";b+="&firstaidgiven="+a;b+="&firstaidgivenby="+kraft_ddlFirstAidGiver.options[kraft_ddlFirstAidGiver.selectedIndex].value;b+="&description="+encodeURIComponent(kraft_txtFirstAidDescription.value);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(d){},onFailure:function(d){document.clear();document.write(d.responseText)}})}function kraft_SaveMedicalTreatment(){var e="";var f="";var a="";var d="";d+="?incidentid="+hdIncidentId.value;d+="&action=kraft_SaveMedicalTreatment";var b=Kraft_RadioButtonListProfessionalMedical.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].checked){e=b[i].value}}b=Kraft_RadioButtonListGoingHospital.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].checked){f=b[i].value}}b=Kraft_RadioButtonListAmbulancedCalled.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].checked){a=b[i].value}}if(e=="Yes"){d+="&ProfessionalMedicalTreatment=1"}else{d+="&ProfessionalMedicalTreatment=0"}if(f=="Yes"){d+="&WentToHospital=1"}else{d+="&WentToHospital=0"}if(a=="Yes"){d+="&WasAmbulanceCalled=1"}else{d+="&WasAmbulanceCalled=0"}if(Kraft_DropDownListMedicalProvider.selectedIndex>0){d+="&medicalProvidedby="+Kraft_DropDownListMedicalProvider.options[Kraft_DropDownListMedicalProvider.selectedIndex].value}if(Kraft_DropDownListHospital.selectedIndex>0){d+="&hospital="+Kraft_DropDownListHospital.options[Kraft_DropDownListHospital.selectedIndex].value}d+="&MedicalTreatmentDetail="+kraft_TextBoxMedicalTreatmentDetail.value;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(g){},onFailure:function(g){document.clear();document.write(g.responseText)}})}function clearRadioListSelection(b,a){if(b.checked){options=a.getElementsByTagName("input");for(i=0;i<options.length-2;i++){options[i].checked=false}}}function clearRadioSelection(a,b,d){if(a.checked){b.checked=false;d.value=""}}function rebindFirstAidGiver(){populateList(ddlFirstAidGiver.id,firstAidStaffOpt)}function bindFirstAidList(){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId,{method:"get",onSuccess:function(transport){eval(transport.responseText);var firstAidStaffOpt="";firstAidStaffOpt=arrayToOptionList(firstAidStaff);if(companyId!=KraftCompanyID){populateList(ddlFirstAidGiver.id,firstAidStaffOpt)}else{populateList(kraft_ddlFirstAidGiver.id,firstAidStaffOpt)}},onFailure:function(transport){alert(transport.responseText)}})}function kraft_BindMedicalProviderList(){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId+"&Kraft_HospitalDoctor=1",{method:"get",onSuccess:function(transport){eval(transport.responseText);var medicalProviderStaffsOpt="";medicalProviderStaffsOpt=arrayToOptionList(medicalProviderStaffs);populateList(Kraft_DropDownListMedicalProvider.id,medicalProviderStaffsOpt)},onFailure:function(transport){alert(transport.responseText)}})}function kraft_BindHospitalList(){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId+"&Kraft_HospitalDoctor=1",{method:"get",onSuccess:function(transport){eval(transport.responseText);var hospitalsOpt="";hospitalsOpt=arrayToOptionList(hospitals);populateList(Kraft_DropDownListHospital.id,hospitalsOpt)},onFailure:function(transport){alert(transport.responseText)}})}function kraft_BindHospitalDoctorLists(selectItem){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId+"&Kraft_HospitalDoctor=1",{method:"get",onSuccess:function(transport){eval(transport.responseText);var medicalProviderStaffsOpt="";medicalProviderStaffsOpt=arrayToOptionList(medicalProviderStaffs);var hospitalsOpt="";hospitalsOpt=arrayToOptionList(hospitals);populateList(Kraft_DropDownListMedicalProvider.id,medicalProviderStaffsOpt);populateList(Kraft_DropDownListHospital.id,hospitalsOpt);if(selectItem){selectStaff(Kraft_DropDownListMedicalProvider.id,"MedicalProvidedBy",hdIncidentId.value);selectStaff(Kraft_DropDownListHospital.id,"Hospital",hdIncidentId.value)}},onFailure:function(transport){alert(transport.responseText)}})}function kraft_saveIncidentCategory(a){var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=kraft_saveIncidentCategory";b+="&categoryid="+a;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.responseText)}},onFailure:function(d){document.clear();document.write(d.responseText)}})}function saveMatrixTextValue(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveMatrixTextValue";a+="&textValue="+encodeURIComponent(txtRiskMatrixSelectedValue.value);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})}function kraft_savePersonalDetails(){var f=kraft_ddlInjuredPerson.options[kraft_ddlInjuredPerson.selectedIndex].value.split("_");var a=$("kraft_piGender");var d="";var b="";var e="";for(i=0;i<a.getElementsByTagName("input").length;i++){if(a.getElementsByTagName("input")[i].checked){d=a.getElementsByTagName("input")[i].value;break}}if(kraft_txtDOB!=null){b=kraft_txtDOB.value}e+="?incidentid="+hdIncidentId.value;e+="&action=savePersonalDetails";e+="&id="+f[1];e+="&tablename="+f[0];e+="&dob="+b;e+="&gender="+d;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:e,onSuccess:function(g){if(g.responseText!=""){alert(g.responseText)}},onFailure:function(g){document.clear();document.write(g.responseText)}})}function kraft_IsValidInjuredPerson(a){var b="";var d=a.split("_");b+="?incidentid="+hdIncidentId.value;b+="&action=kraft_ValidateInjuredPerson";b+="&id="+d[1];b+="&table="+d[0];new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,asynchronous:false,onSuccess:function(e){if(e.responseText!=""){if(e.responseText=="true"){isValidInuredPerson=true}else{isValidInuredPerson=false}}},onFailure:function(e){document.clear();document.write(e.responseText);isValidInuredPerson=false}})}function kraft_ClearInjuryReport(){var a="";a+="?incidentid="+hdIncidentId.value;a+="&action=kraft_ClearInjuryReport";new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})};