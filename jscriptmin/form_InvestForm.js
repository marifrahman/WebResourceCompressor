var caListClickedId="";var txtCAAssignedId="";function doAction(c){var d=$(c);var b=$(c).getElementsByTagName("input");var g="";var a="";var f=false;for(h=0;h<b.length;h++){if(b[h].id=="function"){g=b[h].value;break}}switch(g){case"saveClientSignOff":saveClientSignOff();break;case"saveFindings":saveFindings();break;case"saveExternalNotification":var l=0;if($("tdExtNotifReq").getElementsByTagName("input")[0].checked==true){for(h=0;h<extNotifierList.length;h++){if(extNotifierList[h].type=="checkbox"&&extNotifierList[h].checked){l++;break}}if(l==0){$("externalNotifError").style.display="";f=true}else{$("externalNotifError").style.display="none";if(chkExtOther.checked&&txtExtNotifOther.value==""){$("otherExtNotifError").style.display="";f=true}else{$("otherExtNotifError").style.display="none"}}}if(!f){saveExtNotif()}break;case"saveMatrix":var m=0;var k=0;var e;e=$("tcSeverity").getElementsByTagName("input");for(var h=0;h<e.length;h++){if(e[h].type=="radio"&&e[h].checked){m++;break}}e=$("tcLikelihood").getElementsByTagName("input");for(var h=0;h<e.length;h++){if(e[h].type=="radio"&&e[h].checked){k++;break}}if(m==0||k==0){f=true;$("riskMatrixError").style.display="";f=true}else{$("riskMatrixError").style.display="none"}if(txtRiskMatrixComments!=null){saveMatrixComments()}if(dvRiskMatrixSelectedValue.style.display==""){if(txtRiskMatrixSelectedValue.value==""){f=true;$("txtRiskMatrixSelectedValueError").style.display="inline";f=true}else{$("txtRiskMatrixSelectedValueError").style.display="none";saveMatrixTextValue()}}break;case"saveRootCauses":f=saveRootCauses();break;case"saveCorrectiveActions":f=saveCorrectiveActions();break;case"saveMotorVehicle":f=saveMotorVehicle();break;case"saveOccupationalExposure":f=saveOccupationalExposure();break;case"saveFire":f=saveFire();break;case"saveQuality":f=saveQuality();break;case"saveRail":f=saveRail();break;case"saveSecurity":f=saveSecurity();break;case"saveEnvironmental":f=saveEnvironmental();break;case"saveSCTRail":f=saveSCTRail();break;case"saveRiskAssessmentQuestionnaire":f=saveRiskAssessmentQuestionnaire();break;case"saveImmediateActions":f=saveImmediateActions();break;case"saveCAVerification":f=saveCAVerification();break;case"saveQualityIncident":f=saveQualityIncident();break;case"saveRelatedProcedure":f=saveRelatedProcedure();break;case"nextStep":break;case"kraft_saveSecurityInvestigationDetails":if(!kraft_saveSecurityInvestigationDetails()){f=true}break}if(f){return false}else{return true}}function saveClientSignOff(){var c=$("tblClientSignOff").getElementsByTagName("input");var b="";b+="?incidentId="+hdIncidentId.value;b+="&action=saveClientSignOff";b+="&yesno=";for(var a=0;a<c.length;a++){if(c[a].type=="radio"&&c[a].checked){b+=c[a].value;break}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:b,onSuccess:function(d){if(d.responseText!=""){alert(d.responseText);return true}return false},onFailure:function(d){document.clear();document.write(d.responseText);return true}})}function saveRelatedProcedure(){var a=dvRelatedProceduresItems.getElementsByTagName("input");var c="";c+="?incidentId="+hdIncidentId.value;c+="&action=saveRelatedProcedure";c+="&proc=";for(var b=0;b<a.length;b++){if(a[b].type=="checkbox"){if(a[b].checked){c+=a[b].value+"|"}}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:c,onSuccess:function(d){if(d.responseText!=""){alert(d.responseText);return true}return false},onFailure:function(d){document.clear();document.write(d.responseText);return true}});return false}function selectQualitySystem(b){var e=$("qualitySystemTable");var a=b.id.split("_");var c="";var d=b.parentNode.parentNode.rowIndex;for(i=e.rows.length-1;i>d;i--){e.deleteRow(i)}row=e.insertRow(-1);listCell=row.insertCell(0);listCell=row.insertCell(1);listCell.innerHTML="Please wait...";if(b.selectedIndex!=0){c+="&id="+b.options[b.selectedIndex].value;new Ajax.Request("ajax/getQualitySystemRowXML.ashx",{method:"get",parameters:c,onSuccess:function(q){if(q.responseText.indexOf("error")!=-1){alert(q.responseText)}else{var p=q.responseXML;var g=p.getElementsByTagName("GroupName")[0];var l=p.getElementsByTagName("Locations")[0];var f=e.children.length;var n;var h;var k;var o;var m;if(q.responseText!=""){n=e.insertRow(-1);h=n.insertCell(0);k=n.insertCell(1);k.setAttribute("style","padding-left:6px");n.setAttribute("id","qualitySystem_"+f);o=document.createElement("select");o.id="ddlQualitySystem_"+f;o.className="deco";o.style.width="200px";o.onchange=function(){selectQualitySystem(this)};m=document.createElement("option");m.setAttribute("value","0");m.innerHTML="-- Select one --";o.appendChild(m);for(i=0;i<l.childNodes.length;i++){m=document.createElement("option");m.setAttribute("value",l.childNodes[i].getAttribute("value"));m.innerHTML=l.childNodes[i].childNodes[0].nodeValue;o.appendChild(m)}h.innerHTML=g.childNodes[0].nodeValue;k.appendChild(o)}}}})}e.deleteRow(e.rows.length-1)}function calculateDownTime(){var r=lblQualityIncidentTime.innerHTML.substring(6,10);var p=lblQualityIncidentTime.innerHTML.substring(3,5)-1;var m=lblQualityIncidentTime.innerHTML.substring(0,2);var n=lblQualityIncidentTime.innerHTML.substring(11,13);var o=lblQualityIncidentTime.innerHTML.substring(14,16);var q=new Date(r,p,m,n,o);var c;var d;var b;var a;var f;var g;var h;var k;var t=1000;var s=t*60;var l=s*60;var e=l*24;if(txtCorrectedDate.value!=""){d=txtCorrectedDate.value.substring(6,10);b=txtCorrectedDate.value.substring(3,5)-1;a=txtCorrectedDate.value.substring(0,2);c=new Date(d,b,a,ddlCorrectedHour.options[ddlCorrectedHour.selectedIndex].value,ddlCorrectedMinute.options[ddlCorrectedMinute.selectedIndex].value);f=(c-q);g=Math.floor(f/e);f=f-(g*e);h=Math.floor(f/l);f=f-(h*l);k=Math.floor(f/s);tdTotalDowntime.innerHTML=g+"d "+h+"h "+k+"m"}}function saveCAVerification(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveCAVerification";a+="&comments="+encodeURIComponent(txtCAVerification.value);new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText);return true}return false},onFailure:function(b){document.clear();document.write(b.responseText);return true}})}function saveImmediateActions(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveImmediateActions";a+="&comments="+encodeURIComponent(txtImmediateActionsComments.value);new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText);return true}return false},onFailure:function(b){document.clear();document.write(b.responseText);return true}})}function saveMatrixComments(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveMatrixComments";a+="&comments="+encodeURIComponent(txtRiskMatrixComments.value);new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})}function saveRootCauses(){var k;var h;var e;var f="";var b="";var c;var g;var d=false;var a=0;f+="?incidentId="+hdIncidentId.value;f+="&action=saveRootCause";k=$("tblRootCauses").getElementsByTagName("tr");for(i=0;i<k.length;i++){if(k[i].id.indexOf("rootCauseRow")!=-1){e=k[i].getElementsByTagName("input");if(e.length>0){for(j=0;j<e.length;j++){if(e[j].type=="hidden"){g=e[j].value;f+="&rootcause_"+g+"="}if(e[j].type=="radio"&&e[j].checked){f+=e[j].value;b=e[j].value}}}}if(b=="Yes"){a++}if(k[i].id.indexOf("trContributoryFactors")!=-1){if(b=="Yes"){f+="&cf_"+g+"=";e=k[i].getElementsByTagName("input");if(e.length>0){for(j=0;j<e.length;j++){if(e[j].type=="checkbox"&&e[j].checked){f+=e[j].value+"|"}}}}}if(k[i].id.indexOf("trRootCauseDesc")!=-1){if(b=="Yes"){e=k[i].getElementsByTagName("textarea");if(e.length>0){c=k[i].getElementsByTagName("div");if(e[0].value=="Please enter a root cause"){d=true;c[0].style.display=""}else{c[0].style.display="none";f+="&desc_"+g+"="+encodeURIComponent(e[0].value)}}}}}if(a==0){$("rootCauseError").style.display="";d=true}else{$("rootCauseError").style.display="none"}if(!d){new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:f,onSuccess:function(u){var n=u.responseXML;var r=n.getElementsByTagName("RootCause");var t;var p;var q;var o;var l;var s;var m;t=$("tblCorrectiveActions").getElementsByTagName("tr");for(i=0;i<t.length;i++){if(t[i].id.indexOf("rwCA")!=-1){p=t[i].getElementsByTagName("input");m=t[i].getElementsByTagName("span");for(j=0;j<p.length;j++){if(p[j].id.indexOf("hdRootCauseIdRpt")!=-1){q=p[j].value;break}}for(j=0;j<r.length;j++){if(r[j].getAttribute("RootCauseId")==q){o=r[j].getAttribute("IncidentRootCauseId");l=r[j].getAttribute("Description");s=r[j].getAttribute("Selected")}}if(s=="Yes"){t[i].style.display="";for(j=0;j<p.length;j++){if(p[j].id.indexOf("hdIncidentRootCauseId")!=-1){p[j].value=o;break}}for(j=0;j<m.length;j++){if(m[j].id.indexOf("lblRootCause")!=-1){m[j].innerHTML=l.replace(/\n/gi,"<br />");break}}}else{t[i].style.display="none"}}}},onFailure:function(l){document.clear();document.write(l.responseText)}})}return d}function bindStaffLists(){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId,{method:"get",onSuccess:function(transport){eval(transport.responseText);var listOpt="";listOpt=arrayToOptionList(list);populateList(ddlInterviewees.id,listOpt);populateList(ddlDistributionList.id,listOpt);if(ddlDriver!=null){populateList(ddlDriver.id,listOpt)}if(ddlRailDriver!=null){populateList(ddlRailDriver.id,listOpt)}var caStaffLists=$("tblCorrectiveActions").getElementsByTagName("div");var listCAStuff=[];for(i=0;i<caStaffLists.length;i++){if(caStaffLists[i].id.indexOf("dvCAStaff")!=-1){if(listCAStuff.length===0){listCAStuff=arrayToCAList(list)}populateCAStaffList(caStaffLists[i].id,listCAStuff)}}if(ddlDriver!=null){ddlSelectValue(ddlDriver.id,hdDriver.value)}if(ddlRailDriver!=null){ddlSelectValue(ddlRailDriver.id,hdRailDriver.value)}setTimeout("hideProcess()",1005)},onFailure:function(transport){alert(transport.responseText)}})}function getPersonDetails(a,d){var b;var c=a.split("_");var g;var f;var e;switch(d){case"interview":tdJobTitle=$("tdIntervieweeJobTitle");break}b+="?incidentId="+hdIncidentId.value;b+="&tablename="+c[0];b+="&id="+c[1];new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:b,onSuccess:function(o){if(o.responseText.indexOf("error")!=-1){alert(o.responseText)}else{var l=o.responseXML;var n=l.getElementsByTagName("person")[0];var p=n.getElementsByTagName("EmployeeType")[0];var k=n.getElementsByTagName("ContactNo")[0];var h=n.getElementsByTagName("Company")[0];var m=n.getElementsByTagName("JobTitle")[0];if(m.childNodes.length>0){tdJobTitle.innerHTML=m.childNodes[0].nodeValue}else{tdJobTitle.innerHTML=""}}}})}function initPage(){showProcess("Loading data. Please wait....");var c;var a;var b;bindStaffLists();for(i=0;i<panels.length;i++){c=$(panels[i][0]);if(c.style.display==""){a=c.getElementsByTagName("input");for(j=0;j<a.length;j++){if(a[j].id.indexOf("btnPrev")!=-1){a[j].style.display="none";break}}break}}for(i=panels.length-1;i>=0;i--){c=$(panels[i][0]);if(c.style.display==""){a=c.getElementsByTagName("input");for(j=0;j<a.length;j++){if(a[j].id.indexOf("btnNext")!=-1){if(hdMode.value=="edit"){button[j].value="Save"}else{a[j].value="Finish"}break}}break}}if(pnlPotentialRisk!=null){selectTD()}renumberSections()}function selectSL(d){var a=$(findNodeTree(d,"table").id).getElementsByTagName("td");var b=$("tcLikelihood").getElementsByTagName("input");var e=$("tcSeverity").getElementsByTagName("input");var c;var f;var g;if(hdIncidentId.value!=0){for(i=0;i<a.length;i++){if(a[i].id.indexOf("matrix")!=-1){a[i].style.borderColor=a[i].style.backgroundColor}}d.style.borderColor="#000000";g=d.id.split("_");for(i=0;i<b.length;i++){if(g[g.length-1]==b[i].value){b[i].checked=true;c=b[i].value;break}}for(i=0;i<e.length;i++){if(g[g.length-2]==e[i].value){e[i].checked=true;f=e[i].value;break}}$("riskMatrixIdError").style.display="none";saveMatrix(c,f,hdIncidentId.value)}else{$("riskMatrixIdError").style.display=""}}function saveExtNotif(){var b="";var a;b+="?incidentid="+incidentId;b+="&action=saveExtNotif";b+="&extnotifreq=";for(i=0;i<tdExtNotifReq.length;i++){if(tdExtNotifReq[i].type=="radio"&&tdExtNotifReq[i].checked){b+=tdExtNotifReq[i].value;break}}b+="&extnotif=";for(i=0;i<extNotifierList.length;i++){if(extNotifierList[i].type=="checkbox"&&extNotifierList[i].checked){b+=extNotifierList[i].value+"|"}}if(b.lastIndexOf("|")==b.length-1){b=b.substring(0,b.lastIndexOf("|"))}b+="&extNotifOther="+encodeURIComponent(txtExtNotifOther.value);b+="&compensation=";for(i=0;tdCompensationClaim.length;i++){if(tdCompensationClaim[i].type=="radio"&&tdCompensationClaim[i].checked){b+=tdCompensationClaim[i].value;break}}b+="&rrtwc=";for(i=0;rrtwc.length;i++){if(rrtwc[i].type=="radio"&&rrtwc[i].checked){b+=rrtwc[i].value;break}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:b,onSuccess:function(c){if(c.responseText!=""){alert(c.responseText)}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function saveFindings(){if(txtFindings.value!=""){var a="";a+="?incidentid="+incidentId;a+="&action=saveFindings";a+="&findings="+encodeURIComponent(txtFindings.value);new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText==""){txtFindings.value="";loadFindings()}else{alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})}}function loadFindings(){var a="";a+="?incidentid="+incidentId;a+="&action=loadFindings";new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){dvInvestigationFindings.innerHTML=b.responseText},onFailure:function(b){document.clear();document.write(b.responseText)}})}function removeInterview(a){if(confirm("Are you sure you want to remove this interview? Click OK to delete")){var b="";b+="?incidentId="+hdIncidentId.value;b+="&action=removeInterview";b+="&interviewId="+a;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:b,onSuccess:function(c){loadInterviewList()},onFailure:function(c){document.clear();document.write(c.responseText)}})}}function removeFile(b,a){if(confirm("Are you sure you want to delete this file? Click OK to continue")){var c="";c+="?incidentId="+hdIncidentId.value;c+="&action=removeFile";c+="&fileid="+b;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:c,onSuccess:function(d){if(d.responseText.indexOf("error")!=-1){alert(d.responseText)}else{loadFileList(a)}},onFailure:function(d){document.clear();document.write(d.responseText)}})}}function loadFileList(a){var b="";b+="?incidentId="+hdIncidentId.value;b+="&action=loadFileList";b+="&area="+a;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:b,onSuccess:function(c){if(c.responseText.indexOf("error")!=-1){alert(c.responseText)}else{switch(a.toLowerCase()){case"report":dvIncidentReportFiles.innerHTML=c.responseText;break;case"investigate":dvInvestigationFiles.innerHTML=c.responseText;break;case"interview":dvInterviewRecords.innerHTML=c.responseText;break;case"extdoc":tdDocumentList.innerHTML=c.responseText;loadOutstandingDocuments();case"caverify":dvCAVerificationFiles.innerHTML=c.responseText;break}}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function loadOutstandingDocuments(){var b="";var a;ddlOutstandingDocuments.options.length=0;a=document.createElement("option");a.text="-- Select One --";a.value="0";ddlOutstandingDocuments.options.add(a);b+="?incidentId="+hdIncidentId.value;new Ajax.Request("ajax/getOutstandingDocumentsXML.aspx",{method:"get",parameters:b,onSuccess:function(e){var c=e.responseXML;if(c!=null){var d=c.getElementsByTagName("extDoc");for(i=0;i<d.length;i++){a=document.createElement("option");a.text=d[i].getAttribute("showFileName");a.value=d[i].getAttribute("id");ddlOutstandingDocuments.options.add(a)}}else{tblUploadDocuments.style.display="none";dvAllUploaded.style.display=""}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function saveInterview(){var a="";var b=$("tdRecordAttached").getElementsByTagName("input");if(ddlInterviewees.selectedIndex>0&&txtInterviewDetails.value!=""){a+="?incidentId="+hdIncidentId.value;a+="&action=saveInterview";a+="&person="+ddlInterviewees.options[ddlInterviewees.selectedIndex].value;a+="&details="+encodeURIComponent(txtInterviewDetails.value);for(i=0;i<b.length;i++){if(b[i].checked){a+="&recordattached="+b[i].value;break}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(c){txtInterviewDetails.value="";ddlInterviewees.selectedIndex=0;for(i=0;i<b.length;i++){if(b[i].value=="No"){b[i].checked=true}}loadInterviewList();$("dvNewInterview").style.display="none";$("lnkNewInterview").style.display=""},onFailure:function(c){document.clear();document.write(c.responseText)}})}else{if(ddlInterviewees.selectedIndex==0){$("interviewPersonError").style.display=""}else{$("interviewPersonError").style.display="none"}if(txtInterviewDetails.value==""){$("interviewDetailsError").style.display=""}else{$("interviewDetailsError").style.display="none"}}}function showAddInterview(){$("dvNewInterview").style.display="";$("lnkNewInterview").style.display="none"}function loadInterviewList(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=loadInterviewList";new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText.indexOf("error")!=-1){alert(b.responseText)}else{dvInterviewList.innerHTML=b.responseText}},onFailure:function(b){document.clear();document.write(b.responseText)}})}function saveMatrix(b,d,a){var c="";c+="?incidentid="+a;c+="&action=saveMatrix";c+="&likelihoodId="+b;c+="&severityId="+d;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:c,onSuccess:function(e){if(e.responseText!=""){alert(e.responseText)}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function enableBox(a){if(a.value=="Please enter a root cause"){a.style.color="#000000";a.value=""}}function disableBox(a){if(a.value==""){a.style.color="#FF0000";a.value="Please enter a root cause"}}function loadCA(c,a){var d=$("tblCorrectiveActions").getElementsByTagName("tr");var e;var b;for(i=0;i<d.length;i++){if(d[i].id.indexOf("rwCA")!=-1){b=d[i].getElementsByTagName("input");for(j=0;j<b.length;j++){if(b[j].type=="hidden"){if(b[j].id.indexOf("hdRootCauseIdRpt")!=-1){if(b[j].value==c){d[i].style.display="";e=d[i].id}}}}}}b=$(e).getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].id.indexOf("lblRootCause")!=-1){b[i].innerHTML=a}}}function toggleCALStaffList(a,g){if(caListClickedId!=""){var e=$(caListClickedId);checkParent($(a))?e.style.visibility="hidden":"visible"}caListClickedId=a;txtCAAssignedId=g;if($(a).style.visibility=="hidden"){$(a).style.visibility="visible"}else{$(a).style.visibility="hidden"}var b=$(a).getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="text"){b[c].value="Type to search";b[c].style.color="#CCCCCC";b[c].style.fontStyle="italic";break}}var b=$(a).getElementsByTagName("div");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("dvCAStaff")!=-1){var f=b[c].getElementsByTagName("table")[0];for(var d=0;d<f.rows.length;d++){f.rows[d].style.display=""}break}}}function checkParent(a){while(a.parentNode){if(a==document.getElementById(caListClickedId)||a==document.getElementById(txtCAAssignedId)){return false}a=a.parentNode}return true}function checkCASelect(e){var o=e;var g;var d;var f;var h;var m;var k;var p;var n;var a=new Array();var c=new Array();var b=0;while(o.parentNode){if(o.id.indexOf("caStaffRoot")!=-1){break}o=o.parentNode}h=o.getElementsByTagName("div");m=o.getElementsByTagName("input");for(var l=0;l<h.length;l++){if(h[l].id.indexOf("caCurrentStaffList")!=-1){g=h[l]}if(h[l].id.indexOf("dvCAStaff")!=-1){d=h[l].getElementsByTagName("table")[0]}}for(var l=0;l<m.length;l++){if(m[l].id.indexOf("hdCAAssigned")!=-1){k=m[l]}if(m[l].id.indexOf("txtCAAssigned")!=-1){p=m[l]}}if(!e.checked){removeCAStaff(e.value,o.id);if(p.value==""){g.style.fontStyle="italic";g.style.color="#CCCCCC";g.innerHTML="None selected"}}else{for(l=0;l<d.rows.length;l++){f=d.rows[l].cells[0].getElementsByTagName("input");n=d.rows[l].cells[1].innerHTML;if(f[0].checked){a[b]=f[0].value;c[b]=n;b++}}k.value=a.join("|");p.value=c.join(", ");if(p.value!=""){g.innerHTML="";for(l=0;l<c.length;l++){addCurrStaff(g,c[l],a[l],o)}}else{g.style.fontStyle="italic";g.style.color="#CCCCCC";g.innerHTML="None selected"}}}function addCurrStaff(f,h,o,c){var k;var l;var n;var m;var d;var e;var b;var g;if(f.getElementsByTagName("table").length==0){f.innerHTML="";f.style.fontStyle="";f.style.color="";f.innerHTML="";k=document.createElement("table");k.style.width="100%";l=document.createElement("tbody");k.appendChild(l)}else{k=f.getElementsByTagName("table")[0];l=k.childNodes[0]}n=document.createElement("tr");m=document.createElement("td");d=document.createTextNode(h);m.appendChild(d);g=document.createElement("input");g.type="hidden";g.value=o;m.appendChild(g);n.appendChild(m);m=document.createElement("td");m.style.textAlign="right";m.style.fontSize="8pt";b=document.createElement("a");b.innerText="Delete";b.textContent="Delete";b.href="javascript:removeCAStaff('"+o+"','"+c.id+"');";m.appendChild(b);n.appendChild(m);l.appendChild(n);f.appendChild(k)}function removeCAStaff(m,f){var e=$(f);var d=$("tblCAStaff");var h=$("caCurrentStaffList");var g;var o=h.childNodes[0];var a=new Array();var c=new Array();var b=0;var k;var n;k=e.getElementsByTagName("div");n=e.getElementsByTagName("input");for(var l=0;l<k.length;l++){if(k[l].id.indexOf("caCurrentStaffList")!=-1){h=k[l]}if(k[l].id.indexOf("dvCAStaff")!=-1){d=k[l].getElementsByTagName("table")[0]}}o=h.childNodes[0];for(var l=0;l<n.length;l++){if(n[l].id.indexOf("hdCAAssigned")!=-1){hdCAAssigned=n[l]}if(n[l].id.indexOf("txtCAAssigned")!=-1){txtCAAssigned=n[l]}}for(l=0;l<d.rows.length;l++){g=d.rows[l].cells[0].getElementsByTagName("input");name=d.rows[l].cells[1].innerHTML;if(g[0].value==m){g[0].checked=false;break}}for(l=0;l<o.rows.length;l++){if(o.rows[l].cells[0].childNodes[1].value==m){o.deleteRow(l);break}}for(l=0;l<d.rows.length;l++){g=d.rows[l].cells[0].getElementsByTagName("input");name=d.rows[l].cells[1].innerHTML;if(g[0].checked){a[b]=g[0].value;c[b]=name;b++}}hdCAAssigned.value=a.join("|");txtCAAssigned.value=c.join(", ")}function saveCorrectiveAction(s){var k;var r;var e;var g;var d;var f;var m;var u;var b;var a;var c;var v;var w;var o;var p;var n;var l=false;var t="";var h;while(s.parentNode){if(s.id.indexOf("rwCA")!=-1){break}s=s.parentNode}k=s.getElementsByTagName("div");for(var q=0;q<k.length;q++){if(k[q].id.indexOf("caCurrentStaffList")!=-1){g=k[q]}if(k[q].id.indexOf("dvCAStaff")!=-1){d=k[q].getElementsByTagName("table")[0]}if(k[q].id.indexOf("caExecutorsError")!=-1){c=k[q]}if(k[q].id.indexOf("caDateError")!=-1){a=k[q]}if(k[q].id.indexOf("caDetailsError")!=-1){b=k[q]}}r=s.getElementsByTagName("input");for(var q=0;q<r.length;q++){if(r[q].id.indexOf("hdCAAssigned")!=-1){m=r[q]}if(r[q].id.indexOf("hdCorrectiveActionId")!=-1){n=r[q]}if(r[q].id.indexOf("txtCAAssigned")!=-1){u=r[q]}if(r[q].id.indexOf("txtDueDate")!=-1){w=r[q]}if(r[q].id.indexOf("hdIncidentRootCauseId")!=-1){o=r[q]}if(r[q].id.indexOf("hdRootCauseIdRpt")!=-1){p=r[q]}}e=s.getElementsByTagName("td");for(var q=0;q<e.length;q++){if(e[q].id.indexOf("tdCorrectiveActions")!=-1){f=e[q]}}r=s.getElementsByTagName("textarea");for(var q=0;q<r.length;q++){if(r[q].id.indexOf("txtCADetails")!=-1){v=r[q]}}r=s.getElementsByTagName("select");for(var q=0;q<r.length;q++){if(r[q].id.indexOf("ddlCAStatus")!=-1){h=r[q]}}if(v.value!=""){c.style.display=(m.value=="")?"":"none";a.style.display=(w.value=="")?"":"none";l=(m.value=="")?true:false;l=(w.value=="")?true:false}if(!l&&v.value!=""){t+="&details="+encodeURIComponent(v.value);t+="&duedate="+w.value;t+="&status="+h.options[h.selectedIndex].value;t+="&caid="+n.value;t+="&rootcauseid="+o.value;t+="&assignedto="+m.value;new Ajax.Request("ajax/CorrectiveActions.aspx?incidentId="+hdIncidentId.value+"&action=save",{method:"post",parameters:t,onSuccess:function(x){v.value="";u.value="";w.value="";m.value="";h.selectedIndex=0;n.value=0;g.style.fontStyle="italic";g.style.color="#CCCCCC";g.innerHTML="None selected";for(q=0;q<d.rows.length;q++){chk=d.rows[q].cells[0].getElementsByTagName("input");chk[0].checked=false}loadCorrectiveActions(f.id,o.value)},onFailure:function(x){document.clear();document.write(x.responseText)}})}}function editCA(a,l){var m="";var b=false;var e;var g;var h;var f;var c;var o;var p;var n;var d;while(l.parentNode){if(l.id.indexOf("rwCA")!=-1){break}l=l.parentNode}e=l.getElementsByTagName("input");for(var k=0;k<e.length;k++){if(e[k].id.indexOf("hdCAAssigned")!=-1){f=e[k]}if(e[k].id.indexOf("hdCorrectiveActionId")!=-1){g=e[k]}if(e[k].id.indexOf("txtCAAssigned")!=-1){n=e[k]}if(e[k].id.indexOf("txtDueDate")!=-1){p=e[k]}if(e[k].id.indexOf("hdIncidentRootCauseId")!=-1){h=e[k]}}e=l.getElementsByTagName("textarea");for(var k=0;k<e.length;k++){if(e[k].id.indexOf("txtCADetails")!=-1){o=e[k]}}e=l.getElementsByTagName("div");for(var k=0;k<e.length;k++){if(e[k].id.indexOf("caCurrentStaffList")!=-1){c=e[k]}if(e[k].id.indexOf("dvCAStaff")!=-1){caList=e[k].getElementsByTagName("table")[0]}}e=l.getElementsByTagName("select");for(var k=0;k<e.length;k++){if(e[k].id.indexOf("ddlCAStatus")!=-1){d=e[k]}}m+="&caid="+a;new Ajax.Request("ajax/CorrectiveActions.aspx?action=getDetailsXML",{method:"post",parameters:m,onSuccess:function(t){var s=t.responseXML;var q=s.getElementsByTagName("Executors")[0].childNodes;o.value=s.getElementsByTagName("Details")[0].childNodes[0].nodeValue;p.value=s.getElementsByTagName("CADateBy")[0].childNodes[0].nodeValue;for(var r=0;r<d.options.length;r++){if(d.options[r].value==s.getElementsByTagName("Status")[0].childNodes[0].nodeValue){d.selectedIndex=r;break}}g.value=s.getElementsByTagName("CorrectiveActionsId")[0].childNodes[0].nodeValue;n.value="";f.value="";c.innerHTML="";for(var r=0;r<q.length;r++){n.value+=q[r].getAttribute("name");if(r<q.length-1){n.value+=", "}}for(var r=0;r<q.length;r++){f.value+=q[r].getAttribute("table")+"_"+q[r].getAttribute("id");addCurrStaff(c,q[r].getAttribute("name"),q[r].getAttribute("table")+"_"+q[r].getAttribute("id"),l);if(r<q.length-1){f.value+="|"}}},onFailure:function(q){document.clear();document.write(q.responseText)}})}function saveCorrectiveActions(){var m=$("tblCorrectiveActions");var n;var g=false;var l;var f;var a;var e;var c;var d;var b;for(var h=0;h<m.rows.length;h++){l=m.rows[h];if(l.id.indexOf("rwCA")!=-1&&l.style.display==""){f=l.getElementsByTagName("input");for(var k=0;k<f.length;k++){if(f[k].id.indexOf("btnSaveCA")!=-1){a=f[k]}}f=l.getElementsByTagName("div");for(var k=0;k<f.length;k++){if(f[k].id.indexOf("caRequired")!=-1){e=f[k]}if(f[k].id.indexOf("caExecutorsError")!=-1){d=f[k]}if(f[k].id.indexOf("caDetailsError")!=-1){c=f[k]}if(f[k].id.indexOf("caDateError")!=-1){b=f[k]}}a.click();if(c.style.display==""){g=true}if(d.style.display==""){g=true}if(b.style.display==""){g=true}f=l.getElementsByTagName("td");for(var k=0;k<f.length;k++){if(f[k].id.indexOf("tdCorrectiveActions")!=-1){n=f[k]}}f=n.getElementsByTagName("table");if(f.length>0){if(f[0].rows.length==0){g=true;e.style.display=""}else{e.style.display="none"}}else{g=true;e.style.display=""}}}return g}function removeFromList(a,d){var c="";switch(d){case"invdist":c="This will remove the person from the distribution list. Click OK to continue.";break}if(confirm(c)){var b="";b+="?incidentId="+hdIncidentId.value;b+="&action=removeFromList";b+="&section="+d;b+="&idx="+a;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:b,onSuccess:function(f){if(f.responseText!=""){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}else{try{loadList(d)}catch(e){alert(f.responseText)}}}else{loadList(d)}},onFailure:function(e){document.clear();document.write(e.responseText)}})}}function loadList(d){var a;var c="";var b="";switch(d){case"invdist":a=dvDistributionList.id;break}c+="?incidentId="+hdIncidentId.value;c+="&action=loadList";c+="&section="+d;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:c,onSuccess:function(e){if(e.responseText.indexOf("error")!=-1){alert(e.responseText)}else{$(a).innerHTML=e.responseText}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function loadInvDistributionList(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=loadInvDistributionList";new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){dvDistributionList.innerHTML=b.responseText},onFailure:function(b){document.clear();document.write(b.responseText)}})}function getPersonDetails(a,d){var b="";var c=a.split("_");var g;var f;var e;switch(d){case"pi":g=$("piType");f=$("piContactNo");e=$("piCompany");break;case"w":g=$("wType");f=$("wContactNo");e=$("wCompany");break}b+="?incidentId="+hdIncidentId.value;b+="&tablename="+c[0];b+="&id="+c[1];new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:b,onSuccess:function(p){if(p.responseText.indexOf("error")!=-1){alert(p.responseText)}else{var l=p.responseXML;var o=l.getElementsByTagName("person")[0];var q=o.getElementsByTagName("EmployeeType")[0];var k=o.getElementsByTagName("ContactNo")[0];var h=o.getElementsByTagName("Company")[0];if(d=="dist"){var m=l.getElementsByTagName("JobTitle")[0];var n=l.getElementsByTagName("Location")[0];if(m.childNodes.length>0){txtDistJobTitle.value=m.childNodes[0].nodeValue}else{txtDistJobTitle.value=""}if(n.childNodes.length>0){txtDistLocation.value=n.childNodes[0].nodeValue}else{txtDistLocation.value=""}}}}})}function saveToDistributionList(){if(hdIncidentId.value==0){alert("Please select an incident type first")}else{if(ddlDistributionList.selectedIndex!=0){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveToDistList";a+="&id="+ddlDistributionList.options[ddlDistributionList.selectedIndex].value;a+="&jobtitle="+encodeURIComponent(txtDistJobTitle.value);a+="&location="+encodeURIComponent(txtDistLocation.value);new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText.indexOf("error")!=-1){alert(b.responseText)}else{ddlDistributionList.selectedIndex=0;txtDistJobTitle.value="";txtDistLocation.value="";loadInvDistributionList()}},onFailure:function(b){document.clear();document.write(b.responseText)}})}}}function assignInvestigators(){document.location.href="InvestigationsAssign.asp?m=1&s=25&IncidentID="+hdIncidentId.value}function review(){var e="";var b=false;$("dvProgress").style.display="";new Effect.Opacity("dvProgress",{from:0,to:0.5});var a=0;var d=setInterval(function(){if($(panels[a][0])!=undefined&&$(panels[a][0]).style.display!="none"&&!doAction(panels[a][0])){b=true;openSection(panels[a][0])}a++;if(a>=panels.length){new Effect.Opacity("dvProgress",{from:0.5,to:0});$("dvProgress").style.display="none";clearInterval(d);if(!b){if(hdMode.value=="edit"){alert("Investigation details have been saved and await approval.");document.location="investigationslistAll.asp?m=1&s=24"}else{document.location="InvestFinishEmail.asp?incidentid="+hdIncidentId.value}}else{alert("Please correct the errors in red")}}},1000)}function saveMotorVehicle(){var d="";var e=$("tblMotorVehicleYesNo").getElementsByTagName("input");var a=false;var b;d+="?incidentId="+hdIncidentId.value;d+="&action=saveMotorVehicle";d+="&yesno=";for(var c=0;c<e.length;c++){if(e[c].type=="radio"&&e[c].checked){d+=e[c].value;if(e[c].value=="Yes"){a=true}}}if(a){if(ddlDriver.selectedIndex==0){$("motorVehicleDriverError").style.display="";return true}else{$("motorVehicleDriverError").style.display="none"}d+="&driver="+ddlDriver.options[ddlDriver.selectedIndex].value;d+="&timeofday=";b=$("TimeOfDay").getElementsByTagName("select");d+=b[0].options[b[0].selectedIndex].value;d+="&weatherconditions=";b=$("chkWeatherConditions").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&roadconditions=";b=$("chkRoadConditions").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&roadsurfaceconditions=";b=$("chkRoadSurfaceConditions").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}b=$("tblVehicleDetails").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("txtVehicleType")!=-1){d+="&type="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtVehicleMake")!=-1){d+="&make="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtRegistrationPlate")!=-1){d+="&reg="+encodeURIComponent(b[c].value)}if(b[c].type=="radio"&&b[c].checked){d+="&companyvehicle="+encodeURIComponent(b[c].value)}}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}});return false}function saveOccupationalExposure(){var d="";var e=$("tblOccupationalExposureYesNo").getElementsByTagName("input");var a=false;var b;d+="?incidentId="+hdIncidentId.value;d+="&action=saveOccupationalExposure";d+="&yesno=";for(var c=0;c<e.length;c++){if(e[c].type=="radio"&&e[c].checked){d+=e[c].value;if(e[c].value=="Yes"){a=true}}}if(a){d+="&method=";b=$("chkMethodOfExposure").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&agency=";b=$("chkAgency").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&agencyother=";b=$("agencyOther").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c+1].value);break}}d+="&extreq=";b=$("rbExternalReporting").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="radio"&&b[c].checked){d+=b[c].value;break}}d+="&otherdetails=";b=$("tblOccOther").getElementsByTagName("textarea");d+=encodeURIComponent(b[0].value)}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}});return false}function saveFire(){var d="";var e=$("tblFireYesNo").getElementsByTagName("input");var a=false;var b;d+="?incidentId="+hdIncidentId.value;d+="&action=saveFire";d+="&yesno=";for(var c=0;c<e.length;c++){if(e[c].type=="radio"&&e[c].checked){d+=e[c].value;if(e[c].value=="Yes"){a=true}}}if(a){d+="&description=";d+=encodeURIComponent($("tblFireDetails").getElementsByTagName("textarea")[0].value);b=$("tblFireDetails").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("txtFireMaterials")!=-1){d+="&materials="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtSourceOfFuel")!=-1){d+="&sourceoffuel="+encodeURIComponent(b[c].value)}}d+="&typeoffuel=";b=$("chkTypeOfFuel").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&typeoffuelother=";b=$("typeOfFuelOther").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c+1].value);break}}d+="&sourceofignition=";b=$("chkSourceOfIgnition").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&sourceofignitionother=";b=$("sourceOfIgnitionOther").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c+1].value);break}}d+="&sourceofoxygen=";b=$("chkSourceOfOxygen").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&methodextinguish=";b=$("chkMethodExtinguish").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}});return false}function saveQuality(){var d="";var e=$("tblQuality").getElementsByTagName("input");var a=false;var b;d+="?incidentId="+hdIncidentId.value;d+="&action=saveQuality";d+="&yesno=";for(var c=0;c<e.length;c++){if(e[c].type=="radio"&&e[c].checked){d+=e[c].value;if(e[c].value=="Yes"){a=true}}}if(a){d+="&typeofincident=";b=$("chkTypeOfIncident").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}if($("tblQualityDetails")!=null){b=$("tblQualityDetails").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("txtEquipmentNumber")!=-1){d+="&equipmentno="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtMachineNumber")!=-1){d+="&machineno="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtBreachArea")!=-1){d+="&breacharea="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtWhichProcedure")!=-1){d+="&which="+encodeURIComponent(b[c].value)}}}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}});return false}function saveRail(){var d="";var e=$("tblRailYesNo").getElementsByTagName("input");var a=false;var b;d+="?incidentId="+hdIncidentId.value;d+="&action=saveRail";d+="&yesno=";for(var c=0;c<e.length;c++){if(e[c].type=="radio"&&e[c].checked){d+=e[c].value;if(e[c].value=="Yes"){a=true}}}if(a){if(ddlRailDriver.selectedIndex==0){$("railDriverError").style.display="";return true}else{$("railDriverError").style.display="none"}d+="&driver="+ddlRailDriver.options[ddlRailDriver.selectedIndex].value;d+="&category=";b=$("chkIncidentCategory").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&delaycode=";b=$("chkDelayCode").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}b=$("tblRailDetails").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("txtRailTrainNo")!=-1){d+="&trainno="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtRailLocoNo")!=-1){d+="&locono="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtRailDelayedOther")!=-1){d+="&delayother="+encodeURIComponent(b[c].value)}}d+="&line=";b=$("chkLine").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&conditions=";b=$("chkRailConditions").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}b=$("thSpeed").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("txtRailKmSpecific")!=-1){d+="&kmspecific="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtRailSpeed")!=-1){d+="&speed="+encodeURIComponent(b[c].value)}}d+="&dangerousgoods=";b=$("tdRailDangerousGoodsYesNo").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="radio"&&b[c].checked){d+=encodeURIComponent(b[c].value)}}d+="&dangerousgoodslist="+encodeURIComponent($("thListOfDangerousGoods").getElementsByTagName("textarea")[0].value)}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}});return false}function saveSecurity(){var e="";var f=$("tblSecurityYesNo").getElementsByTagName("input");var a=false;var b;var c=false;e+="?incidentId="+hdIncidentId.value;e+="&action=saveSecurity";e+="&yesno=";for(var d=0;d<f.length;d++){if(f[d].type=="radio"&&f[d].checked){e+=f[d].value;if(f[d].value=="Yes"){a=true}}}if(a){e+="&securitytype=";b=$("chkSecurityType").getElementsByTagName("input");for(var d=0;d<b.length;d++){if(b[d].type=="checkbox"&&b[d].checked){e+=encodeURIComponent(b[d].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}e+="&resolutionoutcome=";b=$("chkResolutionOutcome").getElementsByTagName("input");for(var d=0;d<b.length;d++){if(b[d].type=="checkbox"&&b[d].checked){e+=encodeURIComponent(b[d].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}e+="&resolutionoutcomeother=";b=$("resolutionOutcomeOther").getElementsByTagName("input");for(var d=0;d<b.length;d++){if(b[d].type=="checkbox"&&b[d].checked){e+=encodeURIComponent(b[d+1].value);break}}e+="&resolutionproperty=";b=$("chkResolutionProperty").getElementsByTagName("input");for(var d=0;d<b.length;d++){if(b[d].type=="checkbox"&&b[d].checked){e+=encodeURIComponent(b[d].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}e+="&violence=";b=$("rbViolence").getElementsByTagName("input");for(var d=0;d<b.length;d++){if(b[d].type=="radio"&&b[d].checked){e+=b[d].value}}e+="&cost=";b=$("cost").getElementsByTagName("input");for(var d=0;d<b.length;d++){if(b[d].type=="text"){if(!RegExp(/^\$?[0-9\,]+(\.\d{2})?$/).test(String(b[d].value).replace(/^\s+|\s+$/g,""))){$("costError").style.display="";return true}else{$("costError").style.display="none";e+=encodeURIComponent(b[d].value)}break}}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:e,onSuccess:function(g){if(g.responseText!=""){alert(g.responseText)}},onFailure:function(g){document.clear();document.write(g.responseText)}});return false}function saveEnvironmental(){var d="";var e=$("tblEnvironmentalYesNo").getElementsByTagName("input");var a=false;var b;d+="?incidentId="+hdIncidentId.value;d+="&action=saveEnvironmental";d+="&yesno=";for(var c=0;c<e.length;c++){if(e[c].type=="radio"&&e[c].checked){d+=e[c].value;if(e[c].value=="Yes"){a=true}}}if(a){d+="&typeofimpact=";b=$("chkTypeOfImpact").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c].parentNode.getElementsByTagName("label")[0].firstChild.data)+"|"}}d+="&typeofimpactother=";b=$("typeOfImpactOther").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].type=="checkbox"&&b[c].checked){d+=encodeURIComponent(b[c+1].value);break}}b=$("environmentalDetails").getElementsByTagName("input");for(var c=0;c<b.length;c++){if(b[c].id.indexOf("txtLitresSpilt")!=-1){d+="&litresspilt="+encodeURIComponent(b[c].value)}if(b[c].id.indexOf("txtTypeOfContamination")!=-1){d+="&typeofcontamination="+encodeURIComponent(b[c].value)}if(b[c].type=="radio"&&b[c].checked){d+="&communityimpact="+encodeURIComponent(b[c].value)}}}new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText!=""){alert(f.responseText)}},onFailure:function(f){document.clear();document.write(f.responseText)}});return false}function selectSCTRailCategory(b){var e=$("tblSCTRail");var a=b.id.split("_");var c="";var d=b.parentNode.parentNode.rowIndex;$("sctRailCategoryError").style.display="none";for(i=e.rows.length-1;i>d;i--){e.deleteRow(i)}if(b.selectedIndex!=0){c+="&locId="+b.options[b.selectedIndex].value;new Ajax.Request("ajax/getSCTRailRow.aspx",{method:"get",parameters:c,onSuccess:function(q){var l=q.responseXML;var g=l.getElementsByTagName("GroupName")[0];var m=l.getElementsByTagName("Locations")[0];var f=e.children.length;var o;var h;var k;var p;var n;if(q.responseText!=""){o=e.insertRow(-1);h=o.insertCell(0);k=o.insertCell(1);o.setAttribute("id","category_"+f);p=document.createElement("select");p.id="ddlCategory_"+f;p.className="deco";p.style.width="400px";p.onchange=function(){selectSCTRailCategory(this)};n=document.createElement("option");n.setAttribute("value","0");n.innerHTML="-- Select one --";p.appendChild(n);for(i=0;i<m.childNodes.length;i++){n=document.createElement("option");n.setAttribute("value",m.childNodes[i].getAttribute("value"));n.innerHTML=m.childNodes[i].childNodes[0].nodeValue;p.appendChild(n)}h.innerHTML=g.childNodes[0].nodeValue+" :";k.appendChild(p)}}})}}function saveQualityIncident(){var f="";var l=$("tblQualityIncident").getElementsByTagName("input");var c=false;var a=false;var k=tblQualitySystem.getElementsByTagName("table")[0];f+="?incidentId="+hdIncidentId.value;f+="&action=saveQualityIncident";f+="&yesno=";for(var d=0;d<l.length;d++){if(l[d].type=="radio"&&l[d].checked){f+=l[d].value;if(l[d].value=="Yes"){a=true}}}if(a){var g=$("tdQualityIncidentType").getElementsByTagName("input");var h=false;var e=k.rows[k.rows.length-1].cells[1].getElementsByTagName("select")[0];var b;for(var d=0;d<g.length;d++){if(g[d].type=="radio"&&g[d].checked){f+="&typeid="+g[d].value;h=true;break}}if(!h){$("qualityIncidentTypeError").style.display="";c=true}else{$("qualityIncidentTypeError").style.display="none"}if(txtCorrectedDate.value==""){$("timeCorrectedError").style.display="";c=true}else{$("timeCorrectedError").style.display="none"}if(e.selectedIndex==0){$("qualitySystemError").style.display="";c=true}else{$("qualitySystemError").style.display="none"}if(!c){f+="&correctedDate="+txtCorrectedDate.value;f+="&correctedHour="+ddlCorrectedHour.options[ddlCorrectedHour.selectedIndex].value;f+="&correctedMinute="+ddlCorrectedMinute.options[ddlCorrectedMinute.selectedIndex].value;f+="&systems=";for(var d=0;d<k.rows.length;d++){b=k.rows[d].cells[1].getElementsByTagName("select")[0];f+=b.options[b.selectedIndex].value;if(d<k.rows.length-1){f+="|"}}f+="&customersImpacted="+encodeURIComponent(txtQualityCustomersImpacted.value);f+="&equipmentNo="+encodeURIComponent(txtQualityEquipmentNo.value)}}if(!c){new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:f,onSuccess:function(m){if(m.responseText!=""){alert(m.responseText)}},onFailure:function(m){document.clear();document.write(m.responseText)}})}return c}function saveSCTRail(){var g="";var l=$("tblSCTRailYesNo").getElementsByTagName("input");var f=tblSCTRailCategory.rows[tblSCTRailCategory.rows.length-1].cells[1].getElementsByTagName("select")[0];var a=false;var c;var b;var k="";var d=false;var h=false;g+="?incidentId="+hdIncidentId.value;g+="&action=saveSCTRail";g+="&yesno=";for(var e=0;e<l.length;e++){if(l[e].type=="radio"&&l[e].checked){g+=l[e].value;if(l[e].value=="Yes"){a=true}}}if(a){if(f.selectedIndex==0){$("sctRailCategoryError").style.display="";d=true}else{$("sctRailCategoryError").style.display="none";g+="&category=";for(e=0;e<tblSCTRailCategory.rows.length;e++){b=tblSCTRailCategory.rows[e].cells[1].getElementsByTagName("select")[0];g+=b.options[b.selectedIndex].value;if(e<tblSCTRailCategory.rows.length-1){g+="|"}}}if(txtSCTLineSection.value==""){$("lineSectionError").style.display="";d=true}else{$("lineSectionError").style.display="none"}g+="&linesection="+encodeURIComponent(txtSCTLineSection.value);if(txtSCTKilometrage.value==""){$("kilometrageError").style.display="";d=true}else{$("kilometrageError").style.display="none"}g+="&kilometrage="+encodeURIComponent(txtSCTKilometrage.value);g+="&linetype=";c=$("tdLineType").getElementsByTagName("input");for(var e=0;e<c.length;e++){if(c[e].type=="radio"&&c[e].checked){g+=encodeURIComponent(c[e].value);h=true}}if(!h){$("lineTypeError").style.display="";d=true}else{$("lineTypeError").style.display="none"}h=false;if(txtSCTTrainNumber.value==""){$("trainNumnberError").style.display="";d=true}else{$("trainNumnberError").style.display="none"}g+="&trainno="+encodeURIComponent(txtSCTTrainNumber.value);g+="&traintype=";c=$("tdTrainType").getElementsByTagName("input");for(var e=0;e<c.length;e++){if(c[e].type=="radio"&&c[e].checked){g+=encodeURIComponent(c[e].value);h=true;k=c[e].value}}if(!h){$("trainTypeError").style.display="";d=true}else{$("trainTypeError").style.display="none"}h=false;if(k=="Other"&&txtSCTTrainTypeOther.value==""){$("otherTrainTypeError").style.display="";d=true}else{$("otherTrainTypeError").style.display="none"}g+="&othertraintype="+encodeURIComponent(txtSCTTrainTypeOther.value);g+="&tractiontype=";c=$("tdSCTTractionType").getElementsByTagName("input");for(var e=0;e<c.length;e++){if(c[e].type=="radio"&&c[e].checked){g+=encodeURIComponent(c[e].value);h=true}}if(!h){$("tractionTypeError").style.display="";d=true}else{$("tractionTypeError").style.display="none"}h=false;if(txtSCTRollingStockNo.value==""){$("rollingStockNoError").style.display="";d=true}else{$("rollingStockNoError").style.display="none"}g+="&rollingstockno="+encodeURIComponent(txtSCTRollingStockNo.value);if(txtSCTRollingStockDesc.value==""){$("rollingStockDescError").style.display="";d=true}else{$("rollingStockDescError").style.display="none"}g+="&rollingstockdesc="+encodeURIComponent(txtSCTRollingStockDesc.value);if(txtSCTIncidentRef.value==""){$("incidentRefError").style.display="";d=true}else{$("incidentRefError").style.display="none"}g+="&trainctrlincref="+encodeURIComponent(txtSCTIncidentRef.value);if(txtSCTRailOperatorRef.value==""){$("railOperatorRefError").style.display="";d=true}else{$("railOperatorRefError").style.display="none"}g+="&railoperatorref="+encodeURIComponent(txtSCTRailOperatorRef.value);g+="&notifcat=";c=$("tdSCTNotifCategory").getElementsByTagName("input");for(var e=0;e<c.length;e++){if(c[e].type=="radio"&&c[e].checked){g+=encodeURIComponent(c[e].value);h=true}}if(!h){$("notifCategoryError").style.display="";d=true}else{$("notifCategoryError").style.display="none"}h=false;if(txtSCTOCG1.value==""){$("ogc1Error").style.display="";d=true}else{$("ogc1Error").style.display="none"}g+="&ocg1="+encodeURIComponent(txtSCTOCG1.value);g+="&propertydamage=";c=$("tdSCTPropertyDamageYesNo").getElementsByTagName("input");for(var e=0;e<c.length;e++){if(c[e].type=="radio"&&c[e].checked){g+=encodeURIComponent(c[e].value);k=c[e].value}}if(k=="Yes"&&txtSCTPropertyDamage.value==""){$("propertyDamageError").style.display="";d=true}else{$("propertyDamageError").style.display="none"}g+="&propertydamagedesc="+encodeURIComponent(txtSCTPropertyDamage.value)}if(!d){new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:g,onSuccess:function(m){if(m.responseText!=""){alert(m.responseText)}},onFailure:function(m){document.clear();document.write(m.responseText)}})}return d}function saveRiskAssessmentQuestionnaire(){var m="";var r=$("tblRiskAssessmentQuestionnaire");var h;var b;var e=0;var o="";var c=false;var n=0;var l=0;var o="";var a="No";var d=null;var p=null;m+="?incidentId="+hdIncidentId.value;m+="&action=saveRiskAssessmentQuestionnaire";for(var g=0;g<r.rows.length;g++){h=r.rows[g].getElementsByTagName("input");b=r.rows[g].getElementsByTagName("div");if(r.rows[g].id.indexOf("rwQuestion")!=-1){a="No";l=0;a="";for(var k=0;k<h.length;k++){if(h[k].type=="hidden"&&h[k].id.indexOf("hdQuestionId")!=-1){n=h[k].value}if(h[k].type=="hidden"&&h[k].id.indexOf("hdOptions")!=-1){l=h[k].value}if(h[k].type=="radio"){if(h[k].checked){a=h[k].value}}}m+="&q_"+n+"="+n+"|"+l+"|"+a+"|"}else{if(r.rows[g].id.indexOf("rwReason")!=-1){var q=false;o="";p=null;for(var k=0;k<h.length;k++){if(h[k].type=="text"&&h[k].id.indexOf("txtReason")!=-1){o=h[k].value}}for(var k=0;k<b.length;k++){if(b[k].id.indexOf("reasonError")!=-1){p=b[k]}}if(a=="No"&&(l&1)==1&&o==""){c=true;q=true}if(a=="Yes"&&(l&2)==2&&o==""){c=true;q=true}p.style.display=(q)?"":"none";m+=encodeURIComponent(o)+"|"}else{if(r.rows[g].id.indexOf("rwFile")!=-1){var f=false;e=0;for(var k=0;k<h.length;k++){if(h[k].type=="hidden"&&h[k].id.indexOf("hdFileId")!=-1){e=h[k].value}}for(var k=0;k<b.length;k++){if(b[k].id.indexOf("fileError")!=-1){d=b[k]}}if(a=="No"&&(l&4)==4&&e==0){c=true}if(a=="Yes"&&(l&8)==8&&e==0){c=true}if(a=="No"&&(l&4)==4&&e==0){c=true;f=true}if(a=="Yes"&&(l&8)==8&&e==0){c=true;f=true}d.style.display=(f)?"":"none";m+=e}}}}if(!c){new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:m,onSuccess:function(s){if(s.responseText!=""){alert(s.responseText);return true}},onFailure:function(s){document.clear();document.write(s.responseText);return true}})}return c}function kraft_saveSecurityInvestigationDetails(){var c;var a=-1;var d=-1;var e=-1;if(hdIncidentId.value!=0){c+="?incidentId="+hdIncidentId.value;c+="&action=kraft_saveSecurityInvestigationDetails";var b=kraft_RadioButtonListBreach.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].checked){if(b[i].value=="Yes"){a=1}else{a=0}break}}if(a==-1){alert("Plase answer the question : Breach contained?");return false}b=kraft_RadioButtonListReportedToManager.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].checked){if(b[i].value=="Yes"){d=1}else{d=0}break}}if(d==-1){alert("Plase answer the question : Has property damage been reported to Risk Manager and Insurance?");return false}b=kraft_RadioButtonListReportedToPolice.getElementsByTagName("input");for(i=0;i<b.length;i++){if(b[i].checked){if(b[i].value=="Yes"){e=1}else{e=0}break}}if(e==-1){alert("Plase answer the question : Has violence/assault been reported to police?");return false}c+="&breachContained="+a+"&reportedToManager="+d+"&reportedToPolice="+e;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:c,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}}})}return true}function showProgressNotes(a,b){var d=findNodeTree(b,"table");var c=findNodeTree(b,"tr").rowIndex+1;d.rows[c].style.display=(d.rows[c].style.display=="none")?"":"none"}function saveMatrixTextValue(){var a="";a+="?incidentId="+hdIncidentId.value;a+="&action=saveMatrixTextValue";a+="&textValue="+encodeURIComponent(txtRiskMatrixSelectedValue.value);new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})};