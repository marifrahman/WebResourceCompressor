var tdId;var section;var errorDivs;function removeNonAscii(a){return a.replace(/[^A-Za-z 0-9 \n\.,\?""!@#\$%\^&\*\(\)-_=\+;:<>\/\\\|\}\{\[\]`~]*/g,"")}function deleteFile(a,b){if(confirm("You are about to delete this file. Do you wish to continue?")){new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=delRIFiles&fileId="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){hideObject(b);var e=$(b).parentNode.parentNode;var d=e.rows.length;var g=false;for(i=0;i<d;i++){if(e.rows[i].style.visibility==""){g=true;break}}if(!g){e.style.display="none"}}})}}function prevClick(a){var b="";if(a=="stepDangerousGoodsSub"){if(document.getElementById("stepAlcoholDrugsSub")!=null){b="stepAlcoholDrugsSub"}else{if(document.getElementById("stepInjuryReportTitle").style.display!="none"){if(document.getElementById("step11sub5sub")!=null){b="step11sub5sub"}else{b="step11sub4sub"}}else{b="stepIncidentDetailSub"}}}else{if(a=="stepAlcoholDrugsSub"){if(document.getElementById("stepInjuryReportTitle").style.display!="none"){if(document.getElementById("step11sub5sub")!=null){b="step11sub5sub"}else{b="step11sub4sub"}}else{b="stepIncidentDetailSub"}}else{if(a=="stepImmediateActionSub"||a=="stepImediateCorrectiveActionsSub"){if(document.getElementById("stepDangerousGoodsSub")!=null){b="stepDangerousGoodsSub"}else{if(document.getElementById("stepAlcoholDrugsSub")!=null){b="stepAlcoholDrugsSub"}else{if(document.getElementById("stepInjuryReportTitle").style.display!="none"){if(document.getElementById("step11sub5sub")!=null){b="step11sub5sub"}else{b="step11sub4sub"}}else{b="stepIncidentDetailSub"}}}}}}if(b=="step11sub4sub"||b=="step11sub5sub"){new Effect.BlindDown($("stepInjuryReportSub"),{duration:1.3});$("stepInjuryReportSubIcon").src="newimages/arrow-down.png";$("stepInjuryReportSubIcon").title="close"}moveSection(a,b)}function matrixSelect(d,b){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Please select type of incident");return}new Ajax.Request("ReportIncident.asp?Ajax=1&doaction=saveRiskMatrix&incid="+a+"&severityId="+d+"&likelihoodId="+b+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(e){loadMatrix2()}})}function piTypeChanged(a,b){var d=getDDLSelectedText(a,a.value);if(b!=""){b="_"+b}if(d=="Contractor"||d=="Visitor"){showObject("tcPIContractor"+b);showObject("piContractorDDL"+b);loadContractorDDL(b)}else{hideObject("tcPIContractor"+b)}}function gofurther(b){if(confirm("System will send out incident report email to distribution list for review. A sample of email will now be shown.")){window.open("emailsample.html","_blank","height=760,width=710,status=0,toolbar=no,menubar=no,location=no,scrollbars=yes")}if(confirm("The incident report has been distributed. Do you wish to continue by filling in a detailed version of the incident report?")){try{var d=parseInt(b)-1;Effect.BlindUp("step"+d+"sub",{duration:1})}catch(a){}Effect.BlindDown("advanceForm",{duration:1});Effect.BlindDown("step"+b+"sub",{duration:1})}else{alert("Selected not to continue... system will take you to the incidents list.")}}function toggleBody(){if($("bodyImg").title=="back"){$("bodyImg").src="newimages/body.jpg";$("bodyImg").title="front";$("bodyImg").useMap="#body_front_Map"}else{$("bodyImg").src="newimages/body_back.jpg";$("bodyImg").title="back";$("bodyImg").useMap="#body_back_Map"}loadPosition()}function goNext(b){try{var d=parseInt(b)-1;Effect.BlindUp("step"+d+"sub",{duration:1})}catch(a){}Effect.BlindDown("step"+b+"sub",{duration:1})}function calLevelofRisk(){$("levelOfRisk").innerHTML="<Strong>Potential Severity</strong><br>Risk Score : 22<br>Category : 3<br>Recommended actions : Immediately implement effective interim controls before task commences. Long term control strategies shall be implemented as soon possible"}function saveExternalNotifier(e){var d=document.frmReportIncident.incidentId.value;if(d==""){alert("Must Select a Incident Type");return}var f="&incid="+d;f+="&reqEN="+$RF("externalNotifer");var b=document.getElementsByName("chkExternalNotifer");var a=document.getElementsByName("rdCompensation");var h="";var g="";for(i=0;i<b.length;i++){if(b[i].checked){h+=b[i].value+";"}}for(i=0;i<a.length;i++){if(a[i].checked){g+=a[i].value}}f+="&valEN="+h;f+="&valComp="+g;f+="&enOth="+escape($("specifyDetail").value);new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveEN&pseudoParam="+new Date().getTime(),{method:"POST",parameters:f,onSuccess:function(j){if(e!="noMove"){moveSection("stepExternalSub",j.responseText)}}})}function review(){showProcess("Verifying Data. Please wait...");clearErrorMsg();if($("txtShortDesc")!=null){setTimeout('updateShortDesc("noMove")',100)}setTimeout("savePersonInvolved()",500);setTimeout('saveReportingPerson("noMove")',1000);setTimeout('saveReportingTime("noMove")',1500);setTimeout("saveReportedTo()",2000);setTimeout("saveWitness()",2500);setTimeout('saveLocation("noMove")',3000);setTimeout('saveIncDescription("noMove")',3500);try{setTimeout('saveInjuredPerson("noMove")',4000)}catch(a){}try{setTimeout('saveInjuryDetails("noMove")',4500)}catch(a){}try{setTimeout('saveFirstAid("noMove")',5000)}catch(a){}try{setTimeout('saveMedicalTreatment("noMove")',3400)}catch(a){}try{setTimeout("saveDangerousGoods()",6750)}catch(a){}setTimeout('saveImmediateAction("noMove")',5500);setTimeout("saveDistributionList()",6000);if(document.getElementById("stepExternalTitle")!=null){setTimeout('saveExternalNotifier("noMove")',6500)}setTimeout("checkData()",7000);setTimeout("deleteInjuryReport()",8000)}function checkData(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}new Ajax.Request("ReportIncident.asp?Ajax=1&checkForm=1&incid="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(k){new Effect.Opacity("dvProgress",{from:0.5,to:0});var l=k.responseXML;var b=l.getElementsByTagName("ERROR");var h=false;errorDivs=new Array();var d=false;for(i=0;i<b.length;i++){var g=b[i];errorDivs.push(new Array(g.childNodes[1].childNodes[0].nodeValue,$(g.childNodes[2].childNodes[0].nodeValue).style.display));$(g.childNodes[1].childNodes[0].nodeValue).style.display="";$(g.childNodes[2].childNodes[0].nodeValue).style.display="";$(g.childNodes[2].childNodes[0].nodeValue).innerHTML+=g.childNodes[3].childNodes[0].nodeValue+"<br/>";h=true;if(!d){document.location="#"+g.childNodes[1].childNodes[0].nodeValue;d=true}if(g.childNodes[2].childNodes[0].nodeValue=="errorMsgstep11sub2sub"||g.childNodes[2].childNodes[0].nodeValue=="errorMsgstep11sub4sub"){$("stepInjuryReportSub").style.display="";$("bodyDiv").style.display=""}}hideProcess();if(h){alert("Please fill the sections highlighted in red.")}if(!h){var j=document.getElementById("incidentId").value;try{if($("incidentId").value!=""){ir_delExpandedId($("incidentId").value+"_tabstate","stepDistributionListSub")}}catch(f){}myLightWindow.activateWindow({href:"ReportIncidentReview.asp?incidentId="+j,title:"Review Incident Report",type:"external",width:720,height:760})}},onFailure:function(b){alert("An error occured while trying to check the data. Please click on Review again. \n(If this message continues to appear contact Rapid Induct");hideProcess()}})}function toggleInjuryReport(){if($("injuryReportSkip").checked){Effect.Fade("step11subform",{duration:1});Effect.Appear("review",{duration:1})}else{Effect.Appear("step11subform",{duration:1});Effect.Fade("review",{duration:1})}}function showPersonalDetails(){if($("injuryReportSkip").checked){document.getElementById("step11sub1sub").style.display="none"}else{document.getElementById("step11sub1sub").style.display=""}}function showFirstAid(){if($("injuryReportSkip").checked){document.getElementById("step11sub4sub").style.display="none"}else{document.getElementById("step11sub4sub").style.display=""}}function addEvent(a,b,d,e){e=e||false;if(a.addEventListener){a.addEventListener(b,d,e)}else{if(a.attachEvent){a.attachEvent("on"+b,d)}else{a["on"+b]=d}}}function hideInjury(f){createIncident();var j=document.getElementsByName("incidentTypeR");var g=false;var k=document.getElementById("SeverityOptNo");var d=document.getElementById("DrugAlcoholTest");var h=document.getElementById("ImmediateActionOptNo");var b=document.getElementById("DistributionListOptNo");var e=document.getElementById("ExternalNotifierOptNo");var a=document.getElementById("DangerousGoodsOptNo");for(i=0;i<j.length;i++){if(j[i].checked){if(f=="False"){if($("stepInjuryReportTitle").style.display!="none"){h.innerHTML=parseInt(h.innerHTML)-1;b.innerHTML=parseInt(b.innerHTML)-1;if(k!=null){k.innerHTML=parseInt(k.innerHTML)-1}if(d!=null){d.innerHTML=parseInt(d.innerHTML)-1}if(e!=null){e.innerHTML=parseInt(e.innerHTML)-1}if(a!=null){a.innerHTML=parseInt(a.innerHTML)-1}}g=true;$("stepInjuryReportTitle").style.display="none";$("stepInjuryReportSub").style.display="none"}}}if(!g){if($("stepInjuryReportTitle").style.display!=""){h.innerHTML=parseInt(h.innerHTML)+1;b.innerHTML=parseInt(b.innerHTML)+1;if(k!=null){k.innerHTML=parseInt(k.innerHTML)+1}if(d!=null){d.innerHTML=parseInt(d.innerHTML)+1}if(e!=null){e.innerHTML=parseInt(e.innerHTML)+1}if(a!=null){a.innerHTML=parseInt(a.innerHTML)+1}}$("stepInjuryReportTitle").style.display="";$("stepInjuryReportSub").style.display="none"}}function loadInductee(a){new Ajax.Request("ReportIncident.asp?Ajax=1&"+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$(tdId).innerHTML=b.responseText}})}function addNewPersonInvolved(){$("personInloved").selectedIndex=0;$("piTypeName").innerHTML="";$("txtPIContactNo").innerHTML="";var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddPerson.asp?addAs=PI&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function addNewWitness(){$("Witness").selectedIndex=0;$("wTypeId").selectedIndex=0;$("txtWContactNo").value="";var a=document.frmReportIncident.incidentId.value;myLightWindow.activateWindow({href:"AddPerson.asp?addAs=W&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function addReportedToPerson(){$("reportedTo").selectedIndex=0;var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddPerson.asp?addAs=RT&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function addInjuredPerson(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddPerson.asp?addAs=IRP&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function addNewDistributor(){$("distId").selectedIndex=0;$("distJobTitle").value="";$("distLocation").value="";var a=document.frmReportIncident.incidentId.value;myLightWindow.activateWindow({href:"AddPerson.asp?reqJobLoc=1&addAs=DIST&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function loadInducteeInfo(a,b,d){new Ajax.Request("ReportIncident.asp?Ajax=1&iid="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){if(f.responseText!=""){var e=f.responseXML;if(d.toUpperCase()=="PI"){$("piContractorDDL").innerHTML=e.getElementsByTagName("company")[0].childNodes[0].nodeValue;$("piTypeName").innerHTML=e.getElementsByTagName("iType")[0].childNodes[0].nodeValue;$("txtPIContactNo").innerHTML=e.getElementsByTagName("contactno")[0].childNodes[0].nodeValue;if(e.getElementsByTagName("iType")[0].childNodes[0].nodeValue=="Employee"){hideObject("tcPIContractor")}else{showObject("tcPIContractor")}}else{if(d.toUpperCase()=="W"){$("wTypeId").innerHTML=e.getElementsByTagName("iType")[0].childNodes[0].nodeValue;$("txtWContactNo").innerHTML=e.getElementsByTagName("iType")[0].childNodes[0].nodeValue}}}}})}function loadContractorDDL(a){new Ajax.Request("ReportIncident.asp?Ajax=1&contddl="+tdId+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$("piContractorDDL_"+tdId).innerHTML=b.responseText;hideObject("piContractorTxt_"+tdId)}})}function loadExternalFirstAid(a){new Ajax.Request("ReportIncident.asp?Ajax=1&extFirstAidddl="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$("dvFirstAidBy").innerHTML=b.responseText}})}function showQuestion(a,b){var d=false;if(b=="yes"){if(a.checked){d=true}}else{if(a.checked){d=false}}if(d){$("questiont").style.display=""}else{$("questiont").style.display="none"}}function changePersonInvolved(){var a=document.getElementById("personInvolved").value;if(a=="Contractor"){document.getElementById("personInvolvedContractor").style.display=""}else{document.getElementById("personInvolvedContractor").style.display="none"}}function selectSites(){try{var b=$("sitename").value;$("allDep").style.display="none";$("portMelbourneDep").style.display="none";$("StrathmertonDep").style.display="none";$("portMelbourneDep").style.display="none";$("suttontownDep").style.display="none";if(b=="ALL"){$("allDep").style.display=""}else{if(b=="Port Melbourne"){$("portMelbourneDep").style.display=""}else{if(b=="Strathmerton"){$("StrathmertonDep").style.display=""}else{if(b=="Suttontown"){$("suttontownDep").style.display=""}}}}}catch(a){alert(a)}}function checkFAG(){var a=document.getElementsByName("fag");if(a[0].checked){$("fagSelectName").style.display="";$("fagOutcome").style.display=""}else{$("fagSelectName").style.display="none";$("fagOutcome").style.display="none"}}function checkPosition(b,a){var e=document.body.scrollTop||document.documentElement.scrollTop;var d=document.body.scrollLeft||document.documentElement.scrollLeft;var f=findPos($("bodyImg"));clickX=parseInt(a.clientX)+parseInt(d)-parseInt(f[0]);clickY=parseInt(a.clientY)+parseInt(e)-parseInt(f[1]);setInjuryPosition(clickX,clickY)}function checkValidArea(b,d){var a=true;if(b<75&&d<60){a=false}if(b>130&&d<60){a=false}return a}function resetInjuryPosition(){var a=$("bodyImg").title;var g=document.getElementById("injuredPerson").value;var b="";var d="";if(g!=""){var f=g.split("_");d=f[0];b=f[1]}else{alert("Please select an injured person.")}var e=document.getElementById("incidentId").value;if(e==""){alert("Must Select a Incident Type");return}new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=resetInjury&incidentID="+e+"&bodyPosition="+a+"&inductid="+b+"&inductIdTable="+d+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(j){var h=document.getElementById("bodyDiv").getElementsByTagName("div");for(i=h.length-1;i>=0;i--){if(h[i].id==""){h[i].parentNode.removeChild(h[i])}}h=document.getElementById("bodyDiv").parentNode.parentNode.getElementsByTagName("input");for(i=h.length-1;i>=0;i--){if(h[i].checked){h[i].checked=""}}}})}function findPos(b){var a=curtop=0;if(b.offsetParent){do{a+=b.offsetLeft;curtop+=b.offsetTop}while(b=b.offsetParent)}return[a,curtop]}function changeHeading(){try{window.parent.document.getElementById("divPageHeading").innerHTML="New Incident"}catch(a){}try{$("M6").src="images/newmenu/inductee-on.gif";$("M6").onmouseout="images/newmenu/inductee-on.gif";$("M6").onmouseover="images/newmenu/inductee-on.gif"}catch(a){}}function createIncident(){var a=0;for(i=0;i<document.frmReportIncident.incidentTypeR.length;i++){if(document.frmReportIncident.incidentTypeR[i].checked){a=document.frmReportIncident.incidentTypeR[i].value}}if(a==0){alert("Select an Incident Type.");return false}saveIncident(a,document.frmReportIncident.incidentId.value)}function saveIncident(b,a){var d="IncId="+a+"&TypeId="+b;var e="ReportIncident.asp?Ajax=1&doAction=createIncident&pseudoParam="+new Date().getTime();new Ajax.Request(e,{method:"POST",parameters:d,onSuccess:function(f){if(f.responseText!=""){document.frmReportIncident.incidentId.value=f.responseText;getIncidenTypeInfo()}}})}function removePersonInvolved(b){if(confirm("This will remove the person from the incident. Do you want to continue?")){var a=document.frmReportIncident.incidentId.value;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=removePI&incid="+a+"&rpiid="+b+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(d){loadPersonInlovedList()}})}}function removeReportedTo(d,a){if(confirm("This will remove the person from the incident. Do you want to continue?")){var b=document.frmReportIncident.incidentId.value;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=removeRT&incid="+b+"&rpiid="+d+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(e){hideObject(a);loadReportedToList()}})}}function removeWitness(d,a){if(confirm("This will remove the person as a witness. Do you want to continue?")){var b=document.frmReportIncident.incidentId.value;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=removeW&incid="+b+"&rpiid="+d+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(e){loadWitnessList()}})}}function savePersonInvolved(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}var b="";b="addName=0&personInvolved="+$("personInloved").value;b="incid="+a+"&"+b;var d="ReportIncident.asp?Ajax=1&doAction=savePI&pseudoParam="+new Date().getTime();new Ajax.Request(d,{method:"POST",parameters:b,onSuccess:function(e){loadPersonInlovedList();hideObject("tblPI");showObject("tdPIAdd");$("personInloved").selectedIndex=0;$("piTypeName").innerHTML="";$("txtPIContactNo").innerHTML=""}})}function loadPersonInlovedList(){var a=document.frmReportIncident.incidentId.value;showLoading("dvPersonInvolved");new Ajax.Request("ReportIncident.asp?Ajax=1&loadPI=1&incid="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$("dvPersonInvolved").innerHTML=b.responseText;if(b.responseText==""){showObject("tblPI");hideObject("tdPIAdd")}setInjuredPerson()}})}function setInjuredPerson(){if($("injuredPerson").selectedIndex==0){var a="ReportIncident.asp?Ajax=1&IPINFO=1&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime();new Ajax.Request(a,{method:"get",onSuccess:function(e){if(e.responseText!=""){var d=e.responseXML;var b=$("injuredPerson");setDDLValue(b,d.getElementsByTagName("id")[0].childNodes[0].nodeValue);$("ipDOB").value=d.getElementsByTagName("DateOFBirth")[0].childNodes[0].nodeValue;$("sex_Male").checked=(d.getElementsByTagName("gender")[0].childNodes[0].nodeValue.toUpperCase()=="MALE");$("sex_Female").checked=(d.getElementsByTagName("gender")[0].childNodes[0].nodeValue.toUpperCase()=="FEMALE")}}})}}function loadWitnessList(){showLoading("dvWitnessList");new Ajax.Request("ReportIncident.asp?Ajax=1&loadW=1&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){$("dvWitnessList").innerHTML=a.responseText;if($("dvWitnessList").innerHTML==""){showObject("tblWitness");hideObject("trAddWitness")}}})}function saveReportingPerson(b){if(document.frmReportIncident.incidentId.value==""){alert("Must Select a Incident Type");return}var d="&incid="+document.frmReportIncident.incidentId.value;d+="&addRP=0&rptby="+$("reportedBy").value;var e=$("reportedBy").value.split("_");var a=document.frmReportIncident.incidentId.value;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveReporting"+d+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){if(b!="noMove"){moveSection("stepPersonReportingSub","stepWhoReportedSub")}if(ir_getCookie("personID")==""&&ir_getCookie("personTable")==""){createCookie("personID",e[1],10);createCookie("personTable",e[0],10)}}})}function saveReportedTo(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}var b="addRT=0&irTo="+$("reportedTo").value;b+="&incid="+a;var d="ReportIncident.asp?Ajax=1&doAction=saveRT&pseudoParam="+new Date().getTime();new Ajax.Request(d,{method:"post",parameters:b,onSuccess:function(e){loadReportedToList();hideObject("trReportedTo");showObject("trAddReportedTo")}})}function saveReportingTime(b){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}params="incid="+a;params+="&rtToDate="+$("reportedDate").value+"&rtHour="+$("reportedHour").value+"&rtMinute="+$("reportedMinute").value;var d="ReportIncident.asp?Ajax=1&doAction=saveRTTime&pseudoParam="+new Date().getTime();new Ajax.Request(d,{method:"post",parameters:params,onSuccess:function(e){if(b!="noMove"){moveSection("stepWhoReportedSub","stepWitnessSub")}}})}function saveWitness(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}var b="addW=0&Witness="+$("Witness").value;b+="&wTypeId="+$("wTypeId").value;b+="&wContactNo="+$("txtWContactNo").value;b+="&incid="+a;var d="ReportIncident.asp?Ajax=1&doAction=saveWit&pseudoParam="+new Date().getTime();new Ajax.Request(d,{method:"POST",parameters:b,onSuccess:function(e){loadWitnessList();$("Witness").selectedIndex=0;$("wTypeId").innerHTML="";$("txtWContactNo").innerHTML="";hideObject("tblWitness");showObject("trAddWitNess")}})}function saveFiles(){var a=$("riFilePath").value;if(!checkFileExt(a)){return false}if($("riFileDesc").value==""){alert("File Description Required.");$("riFileDesc").focus();return false}fileUpload(document.frmReportIncident,"riSaveFile.asp?ua=report&incid="+document.frmReportIncident.incidentId.value,"uploadedFile");$("riFileDesc").value="";$("dvRiFilePath").innerHTML='<input type="file" name="riFilePath" id="riFilePath" />'}function saveFilesExt(){var a=$("riFilePathExt").value;if(!checkFileExt(a)){return false}if($("riFileExtDesc").value==""){alert("File Description Required.");$("riFileExtDesc").focus();return false}fileUpload(document.frmReportIncident,"riSaveFile.asp?ua=reportext&incid="+document.frmReportIncident.incidentId.value,"uploadedFileExt");$("riFileExtDesc").value="";$("dvRiFilePathExt").innerHTML='<input type="file" name="riFilePathExt" id="riFilePathExt" />'}function deleteExtFile(a,b){if(confirm("Do you really want to delete this file?")){new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=delFiles&fileId="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){hideObject(b);var e=$(b).parentNode.parentNode;var d=e.rows.length;var g=false;for(i=0;i<d;i++){if(e.rows[i].style.visibility==""){g=true;break}}if(!g){e.style.display="none"}}})}}function saveIncDescription(d){var f=document.getElementById("SeverityOptNo");var a=document.getElementById("DrugAlcoholTest");var b=document.frmReportIncident.incidentId.value;if(b==""){alert("Must Select a Incident Type");return}var e="desct="+escape(removeNonAscii($("txtIncidentDetails").value))+"&incid="+b;var g="ReportIncident.asp?Ajax=1&doAction=saveDesc&pseudoParam="+new Date().getTime();new Ajax.Request(g,{method:"POST",parameters:e,onSuccess:function(h){if(d!="noMove"){if($("showInjuryReport").value=="True"){moveSection("stepIncidentDetailSub","step11sub1sub")}else{if(a!=null){moveSection("stepIncidentDetailSub","stepAlcoholDrugsSub")}else{moveSection("stepIncidentDetailSub","stepImmediateActionSub")}}}}})}function getIncidenTypeInfo(){new Ajax.Request("ReportIncident.asp?Ajax=1&GITI=1&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){var b=a.responseXML;$("showInjuryReport").value=b.getElementsByTagName("showInjuryReport")[0].childNodes[0].nodeValue;$("reqPersonInvolved").value=b.getElementsByTagName("reqPersonInvolved")[0].childNodes[0].nodeValue}})}function saveImmediateAction(b){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}params="incid="+a+"&immAction="+escape(removeNonAscii($("txtImmediateAction").value));var d="ReportIncident.asp?Ajax=1&doAction=saveImmAction&pseudoParam="+new Date().getTime();new Ajax.Request(d,{method:"POST",parameters:params,onSuccess:function(e){if(b!="noMove"){moveSection("stepImmediateActionSub","stepDistributionListSub")}}})}function addReporting(){var a=document.frmReportIncident.incidentId.value;myLightWindow.activateWindow({href:"AddPerson.asp?addAs=RTG&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function loadPersonDDL(b,a,d){new Ajax.Request("ReportIncident.asp?Ajax=1&personSelId="+b+"&selName="+d+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(e){$(a).innerHTML=e.responseText;if(d=="injuredPerson"){loadInjuredPersonInfo(b)}}})}function loadInjuredPersonInfo(a){new Ajax.Request("ReportIncident.asp?Ajax=1&iid="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){if(f.responseText!=""){var d=f.responseXML;try{$("ipDOB").value=d.getElementsByTagName("DateOFBirth")[0].childNodes[0].nodeValue}catch(b){$("ipDOB").value=""}try{$("sex_Male").checked=(d.getElementsByTagName("gender")[0].childNodes[0].nodeValue.toUpperCase()=="MALE");$("sex_Female").checked=(d.getElementsByTagName("gender")[0].childNodes[0].nodeValue.toUpperCase()=="FEMALE")}catch(b){$("sex_Male").checked=false;$("sex_Female").checked=false}}}})}function loadReportedToList(){showLoading("dvReportedToList");new Ajax.Request("ReportIncident.asp?Ajax=1&loadRT=1&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){$("dvReportedToList").innerHTML=a.responseText;if($("dvReportedToList").innerHTML==""){showObject("trReportedTo");hideObject("trAddReportedTo")}}})}function locationList(d,e,a){removeSubLocations(a);var b=parseInt(a)+1;if(d!="0"){new Ajax.Request("ReportIncident.asp?Ajax=1&loadLoc=1&locid="+b+"&pid="+e+"&osid="+d+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(h){var g=document.createElement("div");var f="locationRow_"+b;g.setAttribute("id",f);g.innerHTML=h.responseText;$("locations").appendChild(g)}})}}function removeSubLocations(b){lid=b;while(1){lid=parseInt(lid)+1;if($("locationRow_"+lid)==null){break}else{var a=$("locationRow_"+lid);$("locations").removeChild(a)}}}function updateDistributionList(){var a=document.frmReportIncident.incidentId.value;var b=0;var d="";while(1){if($("location_"+b)!=null){d+="&location_"+b+"="+$("location_"+b).value}else{break}b++}if($("dvDdlExactLocation").style.display!="none"){d+="&eloc="+escape($("ddlExactLocation").value)}else{d+="&eloc="+escape($("txtExactLocation").value)}d+="&incidentDate="+$("incidentDate").value+"&incHour="+$("incidentHour").value+"&incMin="+$("incidentMinute").value;d+="&noResetDist=";d="incid="+a+"&locCount="+b+d;if(a!=""){new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveLoc&pseudoParam="+new Date().getTime(),{method:"post",parameters:d,onSuccess:function(e){setTimeout("loadDistributionList()",500)}})}}function saveLocation(noMove){var incid=document.frmReportIncident.incidentId.value;if(incid==""){alert("Must Select a Incident Type");return}var locCount=0;var params="";while(1){if($("location_"+locCount)!=null){params+="&location_"+locCount+"="+$("location_"+locCount).value}else{break}locCount++}if($("dvDdlExactLocation").style.display!="none"){params+="&eloc="+escape($("ddlExactLocation").value)}else{params+="&eloc="+escape($("txtExactLocation").value)}params+="&incidentDate="+$("incidentDate").value+"&incHour="+$("incidentHour").value+"&incMin="+$("incidentMinute").value;params="incid="+incid+"&locCount="+locCount+params;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveLoc&pseudoParam="+new Date().getTime(),{method:"post",parameters:params,onSuccess:function(transport){eval(transport.responseText);setTimeout("loadDistributionList()",500);if(noMove!="noMove"){moveSection("stepLocationDetailSub","stepIncidentDetailSub")}}})}function saveInjuredPerson(b){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}var d="incid="+a;d+="&irpid="+$("injuredPerson").value;d+="&ipDOB="+$("ipDOB").value;var e="";if($("sex_Male").checked){e="Male"}else{if($("sex_Female").checked){e="Female"}}d+="&sex="+e;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveIPName&pseudoParam="+new Date().getTime(),{method:"post",parameters:d,onSuccess:function(f){if(b!="noMove"){moveSection("step11sub1sub","step11sub2sub")}}})}function saveInjuryDetails(h){var g=document.frmReportIncident.incidentId.value;if(g==""){alert("Must Select a Incident Type");return}var j="incid="+g;j+="&injuredPerson="+$("injuredPerson").value;var d=document.getElementsByName("NatureInjury");var m="";for(i=0;i<d.length;i++){if(d[i].checked){m+=d[i].value+";"}}j+="&ni="+m;var a=document.getElementsByName("BodyLocation");var k="";for(i=0;i<a.length;i++){if(a[i].checked){k+=a[i].value+";"}}j+="&bloc="+k;var b=document.getElementsByName("MechanismInjury");var l="";for(i=0;i<b.length;i++){if(b[i].checked){l+=b[i].value+";"}}j+="&mechI="+l;j+="&nio="+escape($("txtNatureInjuryOther").value);j+="&blo="+escape($("txtBodyLocationOther").value);j+="&mio="+escape($("txtMechanismInjuryOther").value);try{j+="&idesc="+escape($("injuryDescription").value)}catch(f){}if(document.getElementsByName("AggravationExistInjury").length>0){j+="&aggExistInj="+document.getElementsByName("AggravationExistInjury")[0].checked}else{j+="&aggExistInj=false"}new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveInjuryClass&pseudoParam="+new Date().getTime(),{method:"post",parameters:j,onSuccess:function(e){if(h!="noMove"){moveSection("step11sub2sub","step11sub4sub")}}})}function loadDistributionList(){showLoading("distributionList");new Ajax.Request("ReportIncident.asp?Ajax=1&loadDist=1&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){$("distributionList").innerHTML=a.responseText;if($("distributionList").innerHTML==""){showObject("tblDist");hideObject("trAddDist")}}})}function saveDistributionList(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}var b="&incid="+a;b+="&addRP=0&distid="+$("distId").value;b+="&distJobTitle="+escape($("distJobTitle").value);b+="&distRegion="+escape($("distLocation").value);new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveDist"+b+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(d){loadDistributionList();$("distId").selectedIndex=0;$("distJobTitle").value="";$("distLocation").value="";hideObject("tblDist");showObject("trAddDist")}})}function loadDistributorInfo(a){new Ajax.Request("ReportIncident.asp?Ajax=1&iid="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){if(f.responseText!=""){var d=f.responseXML;try{$("distLocation").value=d.getElementsByTagName("location")[0].childNodes[0].nodeValue}catch(b){$("distLocation").value=""}try{$("distJobTitle").value=d.getElementsByTagName("jobTitle")[0].childNodes[0].nodeValue}catch(b){$("distJobTitle").value=""}try{if(d.getElementsByTagName("id")[0].childNodes[0].nodeValue.search("AdminLevels")!=-1){$("distJobTitle").disabled=true;$("distLocation").disabled=true;$("distJobTitle").fontWeight="bold";$("distLocation").fontWeight="bold"}else{$("distJobTitle").disabled=false;$("distLocation").disabled=false;$("distJobTitle").fontWeight="normal";$("distLocation").fontWeight="normal"}}catch(b){}}}})}function checkDistributionList(a){var b=document.frmReportIncident.incidentId.value;var d=a.split("_");new Ajax.Request("ReportIncident.asp?Ajax=1&checkDL=1&staffId="+d[1]+"&incid="+b+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(f){if(f.responseText!=""){var e=f.responseXML;if(e.getElementsByTagName("isFound")[0].childNodes[0].nodeValue=="True"){alert("This person is already included in the distribution list!");$("saveToList").disabled=true}else{$("saveToList").disabled=false}}}})}function saveFirstAid(d,f,a){var b=document.frmReportIncident.incidentId.value;if(b==""){alert("Must Select a Incident Type");return}var e="incid="+b;e+="&injuredPerson="+$("injuredPerson").value;e+="&fag="+$RF("Fag");e+="&fagby="+$("FirstAidBy").value;e+="&fagDesc="+$("txtFirstAidDesc").value;e+="&fagRTW="+(($("chkReturnToWork").checked)?"1":"0");e+="&fagRMT="+(($("chkReferredTreatment").checked)?"1":"0");e+="&fagNA="+(($("chkNotApplicable").checked)?"1":"0");new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveFirstAid&pseudoParam="+new Date().getTime(),{method:"POST",parameters:e,onSuccess:function(g){if(d!="noMove"){moveSection(a,f)}}})}function addFirstAidBy(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddPerson.asp?addAs=FAB&incid="+a,title:"Add New Person",type:"external",width:440,height:550})}function addNewExternal(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddExternalFirstAidPerson.asp?addAs=FAB&incid="+a,title:"Add New External First Aid",type:"external",width:440,height:250})}function removeDistribution(b){if(confirm("This will remove the person from the incident. Do you want to continue?")){var a=document.frmReportIncident.incidentId.value;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=removeDist&incid="+a+"&distid="+b+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(d){loadDistributionList()}})}}function addOptionToInductDDL(b,a){addOption(b,a,"personInloved");addOption(b,a,"reportedBy");addOption(b,a,"reportedTo");addOption(b,a,"Witness");addOption(b,a,"injuredPerson");addOption(b,a,"FirstAidBy");addOption(b,a,"distId")}function clearErrorMsg(){var a=document.getElementsByTagName("DIV");for(i=0;i<a.length;i++){var b=a[i].getAttribute("id");if(b!=null){if(b.indexOf("errorMsg")>-1){$(b).innerHTML="";$(b).style.display=""}}}if(errorDivs!=null){for(i=0;i<errorDivs.length;i++){var d=errorDivs[i];$(d[0]).style.display=d[1]}}}function getIncidentTypeId(){var a=document.getElementsByName("incidentTypeR");for(i=0;i<a.length;i++){if(a[i].checked){return a[i].value}}}function deleteInjuryReport(){var a="";a+="?incidentid="+document.frmReportIncident.incidentId.value;a+="&action=deleteInjuryReport";new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:a,onSuccess:function(b){if(b.responseText!=""){alert(b.responseText)}},onFailure:function(b){document.clear();document.write(b.responseText)}})}function updateShortDesc(b){if($("txtShortDesc")!=null){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}var d="incid="+a;d+="&shortDesc="+escape($("txtShortDesc").value);new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=updateShortDesc&pseudoParam="+new Date().getTime(),{method:"POST",parameters:d,onSuccess:function(e){if(b!="noMove"){moveSection("stepIncidentTypeSub","stepInvolvedSub")}}})}else{moveSection("stepIncidentTypeSub","stepInvolvedSub")}}function removeMSWordChars(e){var d=new Array();var b,a;d[8216]=39;d[8217]=39;d[8220]=34;d[8221]=34;d[8212]=45;for(c=0;c<e.length;c++){var b=e.charCodeAt(c);if(d[b]!=undefined){a=d[b];e=e.substr(0,c)+String.fromCharCode(a)+e.substr(c+1)}}return e}function ShowDoctor(){var a=document.getElementsByName("VisitDoctor");if(a[0].checked){document.getElementById("DoctorDDL").style.visibility="visible";document.getElementById("DoctorDDL").style.display="";document.getElementsByName("VisitHospital")[1].checked=true;document.getElementById("HospitalDDL").style.visibility="hidden";document.getElementById("HospitalDDL").style.display="none"}else{document.getElementById("DoctorDDL").style.visibility="hidden";document.getElementById("DoctorDDL").style.display="none"}}function ShowHospital(){var a=document.getElementsByName("VisitHospital");if(a[0].checked){document.getElementById("HospitalDDL").style.visibility="visible";document.getElementById("HospitalDDL").style.display="";document.getElementsByName("VisitDoctor")[1].checked=true;document.getElementById("DoctorDDL").style.visibility="hidden";document.getElementById("DoctorDDL").style.display="none"}else{document.getElementById("HospitalDDL").style.visibility="hidden";document.getElementById("HospitalDDL").style.display="none"}}function addDoctor(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddDoctorHospital.asp?addAs=FAB&action=Doctor&incid="+a,title:"Add New Doctor",type:"external",width:440,height:550})}function addHospital(){var a=document.frmReportIncident.incidentId.value;if(a==""){alert("Must Select a Incident Type");return}myLightWindow.activateWindow({href:"AddDoctorHospital.asp?addAs=FAB&action=Hospital&incid="+a,title:"Add New Hospital",type:"external",width:440,height:550})}function loadDoctor(a){new Ajax.Request("ReportIncident.asp?Ajax=1&Doctorddl="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$("docDDLName").innerHTML=b.responseText}})}function loadHospital(a){new Ajax.Request("ReportIncident.asp?Ajax=1&Hospitalddl="+a+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$("hosDDLName").innerHTML=b.responseText}})}function loadMatrix(){new Ajax.Request("CreateRiskMatrix.asp?incidentReport=true&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){$("riskMatrix").innerHTML=a.responseText}})}function loadMatrix2(){var a=document.getElementById("riskMatrixContainer");new Ajax.Request("CreateRiskMatrix2.asp?incidentReport=true&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(b){$("riskMatrixContainer").innerHTML=b.responseText}})}function saveLikelihood(b){var a="incid="+document.frmReportIncident.incidentId.value;a+="&llh="+b;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveLikeLihood&pseudoParam="+new Date().getTime(),{method:"POST",parameters:a,onSuccess:function(d){loadMatrix();changeRiskLevel()}})}function saveSeverity(b){var a="incid="+document.frmReportIncident.incidentId.value;a+="&svr="+b;new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveSeverity&pseudoParam="+new Date().getTime(),{method:"POST",parameters:a,onSuccess:function(d){loadMatrix();changeRiskLevel()}})}function changeRiskLevelOnClick(e,a){var b=document.forms["frmReportIncident"]["SeverityId"];var d=document.forms["frmReportIncident"]["LiklihoodId"];for(i=0;i<b.length;i++){if(b[i].value==e){b[i].checked=true;saveSeverity(e)}}for(i=0;i<d.length;i++){if(d[i].value==e){d[i].checked=true;saveLikelihood(a)}}return;changeRiskLevel()}function changeRiskLevel(){new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=getRiskLevel&incid="+document.frmReportIncident.incidentId.value+"&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){if(a.responseText!=""){$("levelOfRisk").innerHTML="Risk Level: "+a.responseText;loadDistributionList()}},onFailure:function(a){document.clear();document.write(a.responseText)}})}function saveMedicalTreatment(f,j,b){if(document.getElementsByName("VisitDoctor").length==0){return true}var d=document.frmReportIncident.incidentId.value;if(d==""){alert("Must Select a Incident Type");return}var g="incid="+d;g+="&injuredPerson="+$("injuredPerson").value;var k=document.getElementsByName("VisitDoctor")[0].checked;var l=document.getElementsByName("VisitHospital")[0].checked;var a=document.getElementsByName("CeasedWork")[0].checked;var h=document.getElementsByName("RehabilitationPlan")[0].checked;var e;if((k||l)&&!document.getElementById("chkReferredTreatment").checked){document.getElementById("chkReferredTreatment").checked=true;document.getElementById("chkReturnToWork").checked=false;document.getElementById("chkNotApplicable").checked=false}if(l){e=$("txtHospitalDetails").value}if(k){e=$("txtDoctorDetails").value}g+="&visitDoctor="+(k==true?"True":"False");g+="&visitHospital="+(l==true?"True":"False");g+="&CeasedWork="+(a==true?"True":"False");g+="&RehabilitationPlan="+(h==true?"True":"False");g+="&MedicalDetails="+e;g+="&Doctor="+$("Doctor").value;g+="&Hospital="+$("Hospital").value;g+="&CeasedWorkDate="+$("CeasedWorkDate").value;g+="&RehabilitationPlanDesc="+escape($("txtRehabilitationPlan").value);new Ajax.Request("ReportIncident.asp?Ajax=1&doAction=saveMedicalTreatment&pseudoParam="+new Date().getTime(),{method:"POST",parameters:g,onSuccess:function(m){if(f!="noMove"){moveSection(b,j)}}})}function ShowCeaseWork(){var a=document.getElementsByName("CeasedWork");if(a[0].checked){document.getElementById("CeaseWorkTr").style.visibility="visible";document.getElementById("CeaseWorkTr").style.display=""}else{document.getElementById("CeaseWorkTr").style.visibility="hidden";document.getElementById("CeaseWorkTr").style.display="none"}}function ShowRehabilitationPlan(){var a=document.getElementsByName("RehabilitationPlan");if(a[0].checked){document.getElementsByName("CeasedWork")[0].checked=true;ShowCeaseWork();document.getElementById("RehabilitationPlanTr").style.visibility="visible";document.getElementById("RehabilitationPlanTr").style.display=""}else{document.getElementById("RehabilitationPlanTr").style.visibility="hidden";document.getElementById("RehabilitationPlanTr").style.display="none"}};