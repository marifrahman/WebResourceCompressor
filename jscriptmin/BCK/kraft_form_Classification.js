function doAction(d,b){var e=$(d);var c=$(d).getElementsByTagName("input");var h="";var a="";var f=false;for(i=0;i<c.length;i++){if(c[i].id=="function"){h=c[i].value;break}}switch(h){case"saveIncidentType":var m=$("rblIncidentType").getElementsByTagName("input");var n=0;var s="";var q;var f=false;for(i=0;i<m.length;i++){q=m[i];if(q.checked){n=q.value}}if(n==0){$("incidentTypeError").style.display="";f=true}else{$("incidentTypeError").style.display="none";saveIncidentType(n)}if($("divShortDesc")!=null&&$("divShortDesc").style.display==""){if(txtShortDesc.value==""){$("shortDescError").style.display="";f=true}else{$("shortDescError").style.display="none";s=txtShortDesc.value;saveShortDesc(s)}}break;case"kraft_saveIncidentCategory":var k=$("rblIncidentCategory").getElementsByTagName("input");var l=0;var q;var f=false;for(i=0;i<k.length;i++){q=k[i];if(q.checked){l=q.value}}if(l==0){$("incidentCategoryError").style.display="";f=true}else{$("incidentCategoryError").style.display="none";kraft_saveIncidentCategory(l)}break;case"saveEscalation":var g="";var o="";$("escalationPersonError").style.display="none";$("classificationReasonError").style.display="none";var p=RadioButtonListEscalation.getElementsByTagName("input");for(i=0;i<p.length;i++){if(p[i].checked){g=p[i].value}}var p=RadioButtonListInjuryRelated.getElementsByTagName("input");for(i=0;i<p.length;i++){if(p[i].checked){o=p[i].value}}if(o==""){$("RadioButtonListInjuryRelatedError").style.display="";f=true}else{$("RadioButtonListInjuryRelatedError").style.display="none"}if(TextBoxClassificationReason.value==""){$("classificationReasonError").style.display="";f=true}else{$("classificationReasonError").style.display="none"}if(g==""){$("RadioButtonListEscalationError").style.display="";f=true}else{$("RadioButtonListEscalationError").style.display="none"}if(ddlEscalationPerson.selectedIndex<=0&&g=="Yes"&&kraft_divScalationPersonList.innerHTML.length<50){$("escalationPersonError").style.display="";f=true}else{$("escalationPersonError").style.display="none"}if(txtEscalationDate.value==""){$("txtEscalationDateError").style.display="";f=true}else{$("txtEscalationDateError").style.display="none"}if(!f){saveEscalationDetails(g,o);if(ddlEscalationPerson.selectedIndex>0&&g=="Yes"){kraft_SaveScalationPersonToList("kraft_sp",false)}}break;case"saveExternalNotification":var r=0;if($("tdExtNotifReq").getElementsByTagName("input")[0].checked==true){if(!saveToList("notification",false)){f=true}}if(!f){saveExtNotif()}break;case"saveInvestigationTeam":sendNotification();break}if(f){return false}else{return true}}function bindStaffLists(){new Ajax.Request("ajax/getStaffList.aspx?companyId="+companyId,{method:"get",onSuccess:function(transport){eval(transport.responseText);var listOpt="";listOpt=arrayToOptionList(list);populateList(ddlEscalationPerson.id,listOpt);setTimeout("hideProcess()",1000)},onFailure:function(transport){alert(transport.responseText)}})}function saveIncidentDetails(a){var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=saveIncidentDetails";b+="&details="+encodeURIComponent(a);new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(c){if(c.responseText!=""){alert(c.responseText)}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function saveIncidentType(b){var a="";a+="?incidentid="+hdIncidentId.value;a+="&action=saveIncidentType";a+="&typeid="+b;new Ajax.Request("ajax/kraft_form_Classification.aspx",{method:"post",parameters:a,onSuccess:function(c){if(c.responseText.indexOf("error")!=-1){alert(c.responseText)}else{hdIncidentId.value=c.responseText;updateActionslist()}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function initPage(){showProcess("");var c;var a;var b;bindStaffLists();for(i=0;i<panels.length;i++){c=$(panels[i][0]);if(c.style.display==""){a=c.getElementsByTagName("input");for(j=0;j<a.length;j++){if(a[j].id.indexOf("btnPrev")!=-1){a[j].style.display="none";break}}break}}for(i=panels.length-1;i>=0;i--){c=$(panels[i][0]);if(c.style.display==""){a=c.getElementsByTagName("input");for(j=0;j<a.length;j++){if(a[j].id.indexOf("btnNext")!=-1){a[j].value="Send Notification";a[j].className="buttonlarge";break}}break}}loadList("notification");updateActionslist()}function selectStaff(a,b,c){var e=$(a);var d="";d+="?incidentId="+c;d+="&action=getStaffSelected";d+="&field="+b;if(c==0){e.selectedIndex=0}else{new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:d,onSuccess:function(f){if(f.responseText.indexOf("error")!=-1){alert(f.responseText)}else{e.selectedIndex=0;for(i=0;i<e.options.length;i++){if(e.options[i].value==f.responseText){e.selectedIndex=i;break}}if(e.selectedIndex==0&&f.responseText!="0"){insertDeletedStaff(a,f.responseText)}}},onFailure:function(f){document.clear();document.write(f.responseText)}})}}function insertDeletedStaff(b,c){var e=c.split("_");var d="";var a=$(b);d+="?incidentId="+hdIncidentId.value;d+="&tablename="+e[0];d+="&id="+e[1];new Ajax.Request("ajax/getPersonDetails.aspx",{method:"get",parameters:d,onSuccess:function(n){var f=n.responseXML;var h=f.getElementsByTagName("person")[0];var m=h.getElementsByTagName("TableName")[0].childNodes[0].nodeValue;var k=h.getElementsByTagName("ID")[0].childNodes[0].nodeValue;var l=h.getElementsByTagName("Firstname")[0].childNodes[0].nodeValue+" "+h.getElementsByTagName("Lastname")[0].childNodes[0].nodeValue;var g=document.createElement("OPTION");g.text=l;g.value=m+"_"+k;for(i=0;i<a.options.length;i++){if(a.options[i].text>g.text){a.options.add(g,i);break}}for(i=0;i<a.options.length;i++){if(a.options[i].value==c){a.selectedIndex=i;break}}},onFailure:function(f){document.clear();document.write(f.responseText)}})}function loadList(d){var a;var c="";var b="";switch(d){case"notification":a=externalNotoficationListDiv.id;break;case"kraft_sp":a=kraft_divScalationPersonList.id;break}c+="?incidentId="+hdIncidentId.value;c+="&action=loadList";c+="&section="+d;new Ajax.Request("ajax/kraft_form_Classification.aspx",{method:"post",parameters:c,onSuccess:function(e){if(e.responseText.indexOf("error")!=-1){alert(e.responseText)}else{$(a).innerHTML=e.responseText}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function saveEscalationDetails(a,c){var b=ddlEscalationPerson.options[ddlEscalationPerson.selectedIndex].value;var d="";d+="?incidentid="+hdIncidentId.value;d+="&action=saveEscalation";d+="&escalationPerson="+b;d+="&classificationReason="+encodeURIComponent(TextBoxClassificationReason.value);if(a=="Yes"){d+="&escalationCompleted=1"}else{d+="&escalationCompleted=0"}if(c=="Yes"){d+="&injuryRelated=1"}else{d+="&injuryRelated=0"}d+="&escalationDate="+txtEscalationDate.value;d+="&escalationHour="+ddlEscalationHour.options[ddlEscalationHour.selectedIndex].value;d+="&escalationMinute="+ddlEscalationMinute.options[ddlEscalationMinute.selectedIndex].value;new Ajax.Request("ajax/kraft_form_Classification.aspx",{method:"post",parameters:d,onSuccess:function(e){if(e.responseText!=""){alert(e.responseText)}},onFailure:function(e){document.clear();document.write(e.responseText)}})}function saveToList(section,isAddButton){var div;var func;var ddl;switch(section){case"notification":div=externalNotoficationListDiv;ddl=DropDownListExternalNotificationList;func="saveNotoficationList";break}if(hdIncidentId.value==0){alert("Please select an incident type first");return false}$("externalNotifError").style.display="none";$("externalNotifListError").style.display="none";if(!isAddButton&&externalNotoficationListDiv.innerHTML.length<50){$("externalNotifListError").style.display="inline";return false}else{if(isAddButton&&ddl.selectedIndex==0){$("externalNotifError").style.display="";return false}else{if(ddl.selectedIndex!=0){var params="";if(txtExtNotifyDate.value==""){$("txtExtNotifyDateError").style.display="";errorExists=true}else{$("txtExtNotifyDateError").style.display="none"}params+="?incidentId="+hdIncidentId.value;params+="&id="+ddl.options[ddl.selectedIndex].value;params+="&action=saveToList";params+="&section="+section;params+="&extNotifyDate="+txtExtNotifyDate.value;params+="&extNotifyHour="+ddlExtNotifyHour.options[ddlExtNotifyHour.selectedIndex].value;params+="&extNotifyMinute="+ddlExtNotifyMinute.options[ddlExtNotifyMinute.selectedIndex].value;new Ajax.Request("ajax/kraft_form_Classification.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){document.write(transport.responseText)}else{try{loadList(section);eval(transport.responseText)}catch(err){alert("error saving person involved")}}}else{loadList(section)}},onFailure:function(transport){document.clear();document.write(transport.responseText)}});ddl.selectedIndex=0}}}return true}function saveExtNotif(){var b="";var a;b+="?incidentid="+hdIncidentId.value;b+="&action=saveExtNotif";b+="&extnotifreq=";for(i=0;i<tdExtNotifReq.length;i++){if(tdExtNotifReq[i].type=="radio"&&tdExtNotifReq[i].checked){b+=tdExtNotifReq[i].value;break}}b+="&note="+TextBoxExternalNotoficationNote.value;new Ajax.Request("ajax/kraft_form_Classification.aspx",{method:"post",parameters:b,onSuccess:function(c){if(c.responseText!=""){alert(c.responseText)}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function AddExternalNotification(a){myLightWindow.activateWindow({href:"ExternalNotification.aspx?incidentid="+hdIncidentId.value+"&listid="+a,title:"",type:"external",width:440,height:100})}function bindExternalNotificationList(a,e,c){var d=$(a);myLightWindow.deactivate();var b=document.createElement("option");b.text=c;b.value=e;b.selected=true;d.options.add(b)}function sendNotification(){if(confirm("Are you sure you want to send notification email to investigators?")){new Ajax.Request("InvestigationsAssignEmail.asp?incidentId="+hdIncidentId.value+"&doAction=kraft_save&pseudoParam="+new Date().getTime(),{method:"get",onSuccess:function(a){alert("Notification email has been sent to the investigation team.");document.location.href="InvestigationsListAll.asp?m=1&s=24"},onFailure:function(a){alert(a.responseText)}})}}function updateActionslist(){new Ajax.Request("ajax/kraft_form_Classification.aspx?action=getActionList&incidentId="+hdIncidentId.value,{method:"get",onSuccess:function(a){$("classificationActions").innerHTML=a.responseText},onFailure:function(a){alert(a.responseText)}})}function kraft_saveIncidentCategory(a){var b="";b+="?incidentid="+hdIncidentId.value;b+="&action=kraft_saveIncidentCategory";b+="&categoryid="+a;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:b,onSuccess:function(c){if(c.responseText.indexOf("error")!=-1){alert(c.responseText)}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function loadFileList(a){var b="";b+="?incidentId="+hdIncidentId.value;b+="&action=loadFileList";b+="&area="+a;new Ajax.Request("ajax/form_InvestForm.aspx",{method:"post",parameters:b,onSuccess:function(c){if(c.responseText.indexOf("error")!=-1){alert(c.responseText)}else{switch(a.toLowerCase()){case"report":dvIncidentReportFiles.innerHTML=c.responseText;break;case"investigate":dvInvestigationFiles.innerHTML=c.responseText;break;case"interview":dvInterviewRecords.innerHTML=c.responseText;break;case"extdoc":tdDocumentList.innerHTML=c.responseText;loadOutstandingDocuments();break}}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function loadOutstandingDocuments(){var b="";var a;ddlOutstandingDocuments.options.length=0;a=document.createElement("option");a.text="-- Select One --";a.value="0";ddlOutstandingDocuments.options.add(a);b+="?incidentId="+hdIncidentId.value;new Ajax.Request("ajax/getOutstandingDocumentsXML.aspx",{method:"get",parameters:b,onSuccess:function(e){var c=e.responseXML;if(c!=null){var d=c.getElementsByTagName("extDoc");if(d.length>1){for(i=0;i<d.length;i++){a=document.createElement("option");a.text=d[i].getAttribute("showFileName");a.value=d[i].getAttribute("id");ddlOutstandingDocuments.options.add(a)}}else{tblUploadDocuments.style.display="none";dvAllUploaded.style.display=""}}else{tblUploadDocuments.style.display="none";dvAllUploaded.style.display=""}},onFailure:function(c){document.clear();document.write(c.responseText)}})}function removeFromList(idx,section){var question="";switch(section){case"notification":question="This will remove the external notification from list. Click OK to continue.";break;case"kraft_sp":question="This will remove the escalation person from list. Click OK to continue.";break}if(confirm(question)){var params="";params+="?incidentId="+hdIncidentId.value;params+="&action=removeFromList";params+="&section="+section;params+="&idx="+idx;new Ajax.Request("ajax/kraft_form_Classification.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){alert(transport.responseText)}else{try{loadList(section);eval(transport.responseText)}catch(err){alert(transport.responseText)}}}else{loadList(section)}},onFailure:function(transport){document.clear();document.write(transport.responseText)}})}}function kraft_SaveScalationPersonToList(section,isAddButton){var div;var ddl;$("escalationPersonError").style.display="none";switch(section){case"kraft_sp":div=kraft_divScalationPersonList;ddl=ddlEscalationPerson;break}if(hdIncidentId.value==0){alert("Please select an incident type first");return false}else{if(ddl.selectedIndex==0){if(!isAddButton&&kraft_divScalationPersonList.innerHTML.length<50){$("escalationPersonError").style.display="";return false}else{if(isAddButton){$("escalationPersonError").style.display="";return false}}}else{if(ddl.selectedIndex!=0){var params="";params+="?incidentId="+hdIncidentId.value;params+="&id="+ddl.options[ddl.selectedIndex].value;params+="&action=saveToList";params+="&section="+section;new Ajax.Request("ajax/form_ReportIncident.aspx",{method:"post",parameters:params,onSuccess:function(transport){if(transport.responseText!=""){if(transport.responseText.indexOf("error")!=-1){document.write(transport.responseText)}else{try{loadList(section);eval(transport.responseText)}catch(err){alert("error saving escalation person")}}}else{loadList(section)}},onFailure:function(transport){document.clear();document.write(transport.responseText)}});ddl.selectedIndex=0}}}return true};