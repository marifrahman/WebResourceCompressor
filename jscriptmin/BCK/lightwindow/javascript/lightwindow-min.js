if(typeof Effect=="undefined"){throw ("lightwindow.js requires including script.aculo.us' effects.js library!")}try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}var lightwindow=Class.create();lightwindow.prototype={element:null,contentToFetch:null,windowActive:false,dataEffects:[],dimensions:{cruft:null,container:null,viewport:{height:null,width:null,offsetTop:null,offsetLeft:null}},pagePosition:{x:0,y:0},pageDimensions:{width:null,height:null},preloadImage:[],preloadedImage:[],galleries:[],resizeTo:{height:null,heightPercent:null,width:null,widthPercent:null,fixedTop:null,fixedLeft:null},scrollbarOffset:18,navigationObservers:{previous:null,next:null},containerChange:{height:0,width:0},activeGallery:false,galleryLocation:{current:0,total:0},initialize:function(b){this.options=Object.extend({resizeSpeed:8,contentOffset:{height:20,width:20},dimensions:{image:{height:250,width:250},page:{height:250,width:250},inline:{height:250,width:250},media:{height:250,width:250},external:{height:250,width:250},titleHeight:25},classNames:{standard:"lightwindow",action:"lightwindow_action"},fileTypes:{page:["asp","aspx","cgi","cfm","htm","html","pl","php4","php3","php","php5","phtml","rhtml","shtml","txt","vbs","rb"],media:["aif","aiff","asf","avi","divx","flv","m1v","m2a","m2v","m3u","mid","midi","mov","moov","movie","mp2","mp3","mpa","mpa","mpe","mpeg","mpg","mpg","mpga","pps","qt","rm","ram","swf","viv","vivo","wav"],image:["bmp","gif","jpg","png","tiff"]},mimeTypes:{avi:"video/avi",aif:"audio/aiff",aiff:"audio/aiff",gif:"image/gif",bmp:"image/bmp",flv:"video/flv",jpeg:"image/jpeg",m1v:"video/mpeg",m2a:"audio/mpeg",m2v:"video/mpeg",m3u:"audio/x-mpequrl",mid:"audio/x-midi",midi:"audio/x-midi",mjpg:"video/x-motion-jpeg",moov:"video/quicktime",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg3",mpa:"audio/mpeg",mpa:"video/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"audio/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",pdf:"application/pdf",png:"image/png",pps:"application/mspowerpoint",qt:"video/quicktime",ram:"audio/x-pn-realaudio-plugin",rm:"application/vnd.rn-realmedia",swf:"application/x-shockwave-flash",tiff:"image/tiff",viv:"video/vivo",vivo:"video/vivo",wav:"audio/wav",wmv:"application/x-mplayer2"},classids:{flv:"clsid 27CDB6E-AE6D-11cf-96B8-444553540000",mov:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",swf:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",wmv:"clsid:6BF52A52-394A-11d3-B153-00C04F79FAA6"},codebases:{flv:"http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0",mov:"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0",swf:"http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0",wmv:"http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=6,4,5,715"},viewportPadding:10,EOLASFix:"swf,wmv,fla,flv",overlay:{opacity:0.7,image:"images/black.png",presetImage:"jscript/lightwindow/images/black-70.png"},skin:{main:'<div id="lightwindow_container" ><div id="lightwindow_title_bar" ><div id="lightwindow_title_bar_inner" ><span id="lightwindow_title_bar_title"></span><a id="lightwindow_title_bar_close_link" ><img src="images/lightwindow_close.png" border="0" valign="baseline" style="margin-bottom:0px;" /></a></div></div><div id="lightwindow_stage" ><div id="lightwindow_contents" ></div><div id="lightwindow_navigation" ><a href="#" id="lightwindow_previous" ><span id="lightwindow_previous_title"></span></a><a href="#" id="lightwindow_next" ><span id="lightwindow_next_title"></span></a><iframe name="lightwindow_navigation_shim" id="lightwindow_navigation_shim" src="javascript:false;" frameBorder="0" scrolling="no"></iframe></div><div id="lightwindow_galleries"><div id="lightwindow_galleries_tab_container" ><a href="#" id="lightwindow_galleries_tab" ><span id="lightwindow_galleries_tab_span" class="up" >Galleries</span></a></div><div id="lightwindow_galleries_list" ></div></div></div><div id="lightwindow_data_slide" ><div id="lightwindow_data_slide_inner" style="width:auto;" ><div id="lightwindow_data_details" ><div id="lightwindow_data_gallery_container" ><span id="lightwindow_data_gallery_current"></span> of <span id="lightwindow_data_gallery_total"></span></div><div id="lightwindow_data_author_container" >by <span id="lightwindow_data_author"></span></div></div><div id="lightwindow_data_caption" ></div></div></div></div>',loading:'<div id="lightwindow_loading" ><img src="jscript/lightwindow/images/ajax-loading.gif" alt="loading" /><span>Loading or <a href="javascript: myLightWindow.deactivate();">Cancel</a></span><iframe name="lightwindow_loading_shim" id="lightwindow_loading_shim" src="javascript:false;" frameBorder="0" scrolling="no"></iframe></div>',iframe:'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><body>{body_replace}</body></html>',gallery:{top:'<div class="lightwindow_galleries_list"><h1>{gallery_title_replace}</h1><ul>',middle:"<li>{gallery_link_replace}</li>",bottom:"</ul></div>"}},formMethod:"get",hideFlash:false,hideGalleryTab:false,showTitleBar:true,animationHandler:false,navigationHandler:false,transitionHandler:false,finalAnimationHandler:false,formHandler:false,galleryAnimationHandler:false,showGalleryCount:true},b||{});this.duration=((11-this.options.resizeSpeed)*0.15);this._setupLinks();this._getScroll();this._getPageDimensions();this._browserDimensions();this._addLightWindowMarkup(false);this._setupDimensions();this.buildGalleryList()},activate:function(d,c){this._clearWindowContents(true);this._addLoadingWindowMarkup();this._setupWindowElements(c);this._getScroll();this._browserDimensions();this._setupDimensions();this._getPageDimensions();document.getElementById("lightwindow_overlay").setStyle({height:this.pageDimensions.height+"px"});this._toggleTroubleElements("hidden",false);this._displayLightWindow("block","hidden");this._setStatus(true);this._monitorKeyboard(true);this._prepareIE(true);this._loadWindow()},deactivate:function(){this.windowActive=false;this.activeGallery=false;if(!this.options.hideGalleryTab){this._handleGalleryAnimation(false)}this.animating=false;this.element=null;this._displayLightWindow("none","visible");this._clearWindowContents(false);var b=Effect.Queues.get("lightwindowAnimation").each(function(a){a.cancel()});this._prepareIE(false);this._setupDimensions();this._toggleTroubleElements("visible",false);this._monitorKeyboard(false)},createWindow:function(d,c){this._processLink($(d))},activateWindow:function(b){this.element=Object.extend({href:null,title:null,author:null,caption:null,rel:null,top:null,left:null,type:null,showImages:null,height:null,width:null,loadingAnimation:null,iframeEmbed:null,form:null},b||{});this.contentToFetch=this.element.href;this.windowType=this.element.type?this.element.type:this._fileType(this.element.href);this._clearWindowContents(true);this._addLoadingWindowMarkup();this._getScroll();this._browserDimensions();this._setupDimensions();this._getPageDimensions();document.getElementById("lightwindow_overlay").setStyle({height:this.pageDimensions.height+"px"});this._toggleTroubleElements("hidden",false);this._displayLightWindow("block","hidden");this._setStatus(true);this._monitorKeyboard(true);this._prepareIE(true);this._loadWindow()},submitForm:function(b){if(this.options.formHandler){this.options.formHandler(b)}else{this._defaultFormHandler(b)}},openWindow:function(b){var b=$(b);this.windowActive=true;this._clearWindowContents(true);this._addLoadingWindowMarkup();this._setupWindowElements(b);this._setStatus(true);this._handleTransition()},navigateWindow:function(b){this._handleNavigation(false);if(b=="previous"){this.openWindow(this.navigationObservers.previous)}else{if(b=="next"){this.openWindow(this.navigationObservers.next)}}},buildGalleryList:function(){var c="";var d;for(i in this.galleries){if(typeof this.galleries[i]=="object"){c+=(this.options.skin.gallery.top).replace("{gallery_title_replace}",unescape(i));for(j in this.galleries[i]){if(typeof this.galleries[i][j]=="object"){d='<a href="#" id="lightwindow_gallery_'+i+"_"+j+'" >'+unescape(j)+"</a>";c+=(this.options.skin.gallery.middle).replace("{gallery_link_replace}",d)}}c+=this.options.skin.gallery.bottom}}new Insertion.Top("lightwindow_galleries_list",c);for(i in this.galleries){if(typeof this.galleries[i]=="object"){for(j in this.galleries[i]){if(typeof this.galleries[i][j]=="object"){Event.observe($("lightwindow_gallery_"+i+"_"+j),"click",this.openWindow.bind(this,this.galleries[i][j][0]),false);$("lightwindow_gallery_"+i+"_"+j).onclick=function(){return false}}}}}},_setupLinks:function(){var b=$$("."+this.options.classNames.standard);b.each(function(a){this._processLink(a)}.bind(this))},_processLink:function(g){if((this._fileType(g.getAttribute("href"))=="image"||this._fileType(g.getAttribute("href"))=="media")){if(gallery=this._getGalleryInfo(g.rel)){if(!this.galleries[gallery[0]]){this.galleries[gallery[0]]=new Array()}if(!this.galleries[gallery[0]][gallery[1]]){this.galleries[gallery[0]][gallery[1]]=new Array()}this.galleries[gallery[0]][gallery[1]].push(g)}}var f=g.getAttribute("href");if(f.indexOf("?")>-1){f=f.substring(0,f.indexOf("?"))}var d=f.substring(f.indexOf("#")+1);if($(d)){$(d).setStyle({display:"none"})}Event.observe(g,"click",this.activate.bindAsEventListener(this,g),false);g.onclick=function(){return false}},_setupActions:function(){var b=$$("#lightwindow_container ."+this.options.classNames.action);b.each(function(a){Event.observe(a,"click",this[a.getAttribute("rel")].bindAsEventListener(this,a),false);a.onclick=function(){return false}}.bind(this))},_addLightWindowMarkup:function(g){var h=Element.extend(document.createElement("div"));h.setAttribute("id","lightwindow_overlay");if(Prototype.Browser.Gecko){h.setStyle({backgroundImage:"url("+this.options.overlay.presetImage+")",backgroundRepeat:"repeat",height:this.pageDimensions.height+"px"})}else{h.setStyle({opacity:this.options.overlay.opacity,backgroundImage:"url("+this.options.overlay.image+")",backgroundRepeat:"repeat",height:this.pageDimensions.height+"px"})}var k=document.createElement("div");k.setAttribute("id","lightwindow");k.innerHTML=this.options.skin.main;var f=document.getElementsByTagName("body")[0];f.appendChild(h);f.appendChild(k);if($("lightwindow_title_bar_close_link")){Event.observe("lightwindow_title_bar_close_link","click",this.deactivate.bindAsEventListener(this));$("lightwindow_title_bar_close_link").onclick=function(){return false}}Event.observe($("lightwindow_previous"),"click",this.navigateWindow.bind(this,"previous"),false);$("lightwindow_previous").onclick=function(){return false};Event.observe($("lightwindow_next"),"click",this.navigateWindow.bind(this,"next"),false);$("lightwindow_next").onclick=function(){return false};if(!this.options.hideGalleryTab){Event.observe($("lightwindow_galleries_tab"),"click",this._handleGalleryAnimation.bind(this,true),false);$("lightwindow_galleries_tab").onclick=function(){return false}}if(Prototype.Browser.IE){Event.observe(document,"mousewheel",this._stopScrolling.bindAsEventListener(this),false)}else{Event.observe(window,"DOMMouseScroll",this._stopScrolling.bindAsEventListener(this),false)}Event.observe(h,"click",this.deactivate.bindAsEventListener(this),false);h.onclick=function(){return false}},_addLoadingWindowMarkup:function(){$("lightwindow_contents").innerHTML+=this.options.skin.loading},_setupWindowElements:function(b){this.element=b;this.element.title=null?"":b.getAttribute("title");this.element.author=null?"":b.getAttribute("author");this.element.caption=null?"":b.getAttribute("caption");this.element.rel=null?"":b.getAttribute("rel");this.element.params=null?"":b.getAttribute("params");this.contentToFetch=this.element.href;this.windowType=this._getParameter("lightwindow_type")?this._getParameter("lightwindow_type"):this._fileType(this.contentToFetch)},_clearWindowContents:function(c){if($("lightwindow_iframe")){Element.remove($("lightwindow_iframe"))}if($("lightwindow_media_primary")){try{$("lightwindow_media_primary").Stop()}catch(d){}Element.remove($("lightwindow_media_primary"))}if($("lightwindow_media_secondary")){try{$("lightwindow_media_secondary").Stop()}catch(d){}Element.remove($("lightwindow_media_secondary"))}this.activeGallery=false;this._handleNavigation(this.activeGallery);if(c){$("lightwindow_contents").innerHTML="";$("lightwindow_contents").setStyle({overflow:"hidden"});if(!this.windowActive){$("lightwindow_data_slide_inner").setStyle({display:"none"});$("lightwindow_title_bar_title").innerHTML=""}$("lightwindow_data_slide").setStyle({height:"auto"})}this.resizeTo.height=null;this.resizeTo.width=null},_setStatus:function(b){this.animating=b;if(b){Element.show("lightwindow_loading")}if(!(/MSIE 6./i.test(navigator.userAgent))){this._fixedWindow(b)}},_fixedWindow:function(b){if(b){if(this.windowActive){this._getScroll();$("lightwindow").setStyle({position:"absolute",top:parseFloat($("lightwindow").getStyle("top"))+this.pagePosition.y+"px",left:parseFloat($("lightwindow").getStyle("left"))+this.pagePosition.x+"px"})}else{$("lightwindow").setStyle({position:"absolute"})}}else{if(this.windowActive){this._getScroll();$("lightwindow").setStyle({position:"fixed",top:parseFloat($("lightwindow").getStyle("top"))-this.pagePosition.y+"px",left:parseFloat($("lightwindow").getStyle("left"))-this.pagePosition.x+"px"})}else{if($("lightwindow_iframe")){this._browserDimensions()}$("lightwindow").setStyle({position:"fixed",top:(parseFloat(this._getParameter("lightwindow_top"))?parseFloat(this._getParameter("lightwindow_top"))+"px":this.dimensions.viewport.height/2+"px"),left:(parseFloat(this._getParameter("lightwindow_left"))?parseFloat(this._getParameter("lightwindow_left"))+"px":this.dimensions.viewport.width/2+"px")})}}},_prepareIE:function(l){if(Prototype.Browser.IE){var k,n,m;if(l){var k="100%"}else{var k="auto"}var h=document.getElementsByTagName("body")[0];var o=document.getElementsByTagName("html")[0];o.style.height=h.style.height=k}},_stopScrolling:function(b){if(this.animating){if(b.preventDefault){b.preventDefault()}b.returnValue=false}},_getScroll:function(){if(typeof(window.pageYOffset)=="number"){this.pagePosition.x=window.pageXOffset;this.pagePosition.y=window.pageYOffset}else{if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){this.pagePosition.x=document.body.scrollLeft;this.pagePosition.y=document.body.scrollTop}else{if(document.documentElement){this.pagePosition.x=document.documentElement.scrollLeft;this.pagePosition.y=document.documentElement.scrollTop}}}},_setScroll:function(c,d){document.documentElement.scrollLeft=c;document.documentElement.scrollTop=d},_toggleTroubleElements:function(k,n){if(n){var m=$("lightwindow_contents").getElementsByTagName("select")}else{var m=document.getElementsByTagName("select")}for(var l=0;l<m.length;l++){m[l].style.visibility=k}if(!n){if(this.options.hideFlash){var p=document.getElementsByTagName("object");for(l=0;l!=p.length;l++){p[l].style.visibility=k}var o=document.getElementsByTagName("embed");for(l=0;l!=o.length;l++){o[l].style.visibility=k}}var q=document.getElementsByTagName("iframe");for(l=0;l!=q.length;l++){q[l].style.visibility=k}}},_getPageDimensions:function(){var h,f;if(window.innerHeight&&window.scrollMaxY){h=document.body.scrollWidth;f=window.innerHeight+window.scrollMaxY}else{if(document.body.scrollHeight>document.body.offsetHeight){h=document.body.scrollWidth;f=document.body.scrollHeight}else{h=document.body.offsetWidth;f=document.body.offsetHeight}}var g,k;if(self.innerHeight){g=self.innerWidth;k=self.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){g=document.documentElement.clientWidth;k=document.documentElement.clientHeight}else{if(document.body){g=document.body.clientWidth;k=document.body.clientHeight}}}if(f<k){this.pageDimensions.height=k}else{this.pageDimensions.height=f}if(h<g){this.pageDimensions.width=g}else{this.pageDimensions.width=h}},_displayLightWindow:function(d,c){$("lightwindow_overlay").style.display=$("lightwindow").style.display=$("lightwindow_container").style.display=d;$("lightwindow_overlay").style.visibility=$("lightwindow").style.visibility=$("lightwindow_container").style.visibility=c},_setupDimensions:function(){var h,k;switch(this.windowType){case"page":h=this.options.dimensions.page.height;k=this.options.dimensions.page.width;break;case"image":h=this.options.dimensions.image.height;k=this.options.dimensions.image.width;break;case"media":h=this.options.dimensions.media.height;k=this.options.dimensions.media.width;break;case"external":h=this.options.dimensions.external.height;k=this.options.dimensions.external.width;break;case"inline":h=this.options.dimensions.inline.height;k=this.options.dimensions.inline.width;break;default:h=this.options.dimensions.page.height;k=this.options.dimensions.page.width;break}var f=this._getParameter("lightwindow_top")?parseFloat(this._getParameter("lightwindow_top"))+this.pagePosition.y:this.dimensions.viewport.height/2+this.pagePosition.y;var g=this._getParameter("lightwindow_left")?parseFloat(this._getParameter("lightwindow_left"))+this.pagePosition.x:this.dimensions.viewport.width/2+this.pagePosition.x;$("lightwindow").setStyle({top:f+"px",left:g+"px"});$("lightwindow_container").setStyle({height:h+"px",width:k+"px",left:-(k/2)+"px",top:-(h/2)+"px"});$("lightwindow_contents").setStyle({height:h+"px",width:k+"px"})},_fileType:function(g){var m=new RegExp("[^.].("+this.options.fileTypes.image.join("|")+")s*$","i");if(m.test(g)){return"image"}if(g.indexOf("#")>-1&&(document.domain==this._getDomain(g))){return"inline"}if(g.indexOf("?")>-1){g=g.substring(0,g.indexOf("?"))}var h="unknown";var k=new RegExp("[^.].("+this.options.fileTypes.page.join("|")+")s*$","i");var l=new RegExp("[^.].("+this.options.fileTypes.media.join("|")+")s*$","i");if(document.domain!=this._getDomain(g)){h="external"}if(l.test(g)){h="media"}if(h=="external"||h=="media"){return h}if(k.test(g)||g.substr((g.length-1),g.length)=="/"){h="page"}return h},_fileExtension:function(g){if(g.indexOf("?")>-1){g=g.substring(0,g.indexOf("?"))}var f="";for(var d=(g.length-1);d>-1;d--){if(g.charAt(d)=="."){return f}f=g.charAt(d)+f}},_monitorKeyboard:function(b){if(b){document.onkeydown=this._eventKeypress.bind(this)}else{document.onkeydown=""}},_eventKeypress:function(d){if(d==null){var c=event.keyCode}else{var c=d.which}switch(c){case 27:this.deactivate();break;case 13:return;default:break}if(this.animating){return false}switch(String.fromCharCode(c).toLowerCase()){case"p":if(this.navigationObservers.previous){this.navigateWindow("previous")}break;case"n":if(this.navigationObservers.next){this.navigateWindow("next")}break;default:break}},_getGalleryInfo:function(b){if(!b){return false}if(b.indexOf("[")>-1){return new Array(escape(b.substring(0,b.indexOf("["))),escape(b.substring(b.indexOf("[")+1,b.indexOf("]"))))}else{return false}},_getDomain:function(o){var q=o.indexOf("//");var l=q+2;var n=o.substring(l,o.length);var k=n.indexOf("/");var p=n.substring(0,k);if(p.indexOf(":")>-1){var m=p.indexOf(":");p=p.substring(0,m)}return p},_getParameter:function(s,o){if(!this.element){return false}if(s=="lightwindow_top"&&this.element.top){return unescape(this.element.top)}else{if(s=="lightwindow_left"&&this.element.left){return unescape(this.element.left)}else{if(s=="lightwindow_type"&&this.element.type){return unescape(this.element.type)}else{if(s=="lightwindow_show_images"&&this.element.showImages){return unescape(this.element.showImages)}else{if(s=="lightwindow_height"&&this.element.height){return unescape(this.element.height)}else{if(s=="lightwindow_width"&&this.element.width){return unescape(this.element.width)}else{if(s=="lightwindow_loading_animation"&&this.element.loadingAnimation){return unescape(this.element.loadingAnimation)}else{if(s=="lightwindow_iframe_embed"&&this.element.iframeEmbed){return unescape(this.element.iframeEmbed)}else{if(s=="lightwindow_form"&&this.element.form){return unescape(this.element.form)}else{if(!o){if(this.element.params){o=this.element.params}else{return}}var q;var p=o.split(",");var n=s+"=";var r=n.length;for(var m=0;m<p.length;m++){if(p[m].substr(0,r)==n){var l=p[m].split("=");q=l[1];break}}if(!q){return false}else{return unescape(q)}}}}}}}}}}},_browserDimensions:function(){if(Prototype.Browser.IE){this.dimensions.viewport.height=document.documentElement.clientHeight;this.dimensions.viewport.width=document.documentElement.clientWidth}else{this.dimensions.viewport.height=window.innerHeight;this.dimensions.viewport.width=document.width||document.body.offsetWidth}},_getScrollerWidth:function(){var m=Element.extend(document.createElement("div"));m.setAttribute("id","lightwindow_scroll_div");m.setStyle({position:"absolute",top:"-10000px",left:"-10000px",width:"100px",height:"100px",overflow:"hidden"});var k=Element.extend(document.createElement("div"));k.setAttribute("id","lightwindow_content_scroll_div");k.setStyle({width:"100%",height:"200px"});m.appendChild(k);var h=document.getElementsByTagName("body")[0];h.appendChild(m);var l=$("lightwindow_content_scroll_div").offsetWidth;m.style.overflow="auto";var g=$("lightwindow_content_scroll_div").offsetWidth;Element.remove($("lightwindow_scroll_div"));this.scrollbarOffset=l-g},_addParamToObject:function(h,k,g,m){var l=document.createElement("param");l.setAttribute("value",k);l.setAttribute("name",h);if(m){l.setAttribute("id",m)}g.appendChild(l);return g},_outerHTML:function(d){if(Prototype.Browser.IE){return d.outerHTML}else{var g=d.cloneNode(true);var f=document.createElement("div");f.appendChild(g);return f.innerHTML}},_convertToMarkup:function(h,g){var f=this._outerHTML(h).replace("</"+g+">","");if(Prototype.Browser.IE){for(var k=0;k<h.childNodes.length;k++){f+=this._outerHTML(h.childNodes[k])}f+="</"+g+">"}return f},_appendObject:function(k,h,g){if(Prototype.Browser.IE){g.innerHTML+=this._convertToMarkup(k,h);if(this.options.EOLASFix.indexOf(this._fileType(this.element.href))>-1){var m=document.getElementsByTagName("object");for(var l=0;l<m.length;l++){if(m[l].getAttribute("data")){m[l].removeAttribute("data")}m[l].outerHTML=m[l].outerHTML;m[l].style.visibility="visible"}}}else{g.appendChild(k)}},_appendIframe:function(c){var d=document.createElement("iframe");d.setAttribute("id","lightwindow_iframe");d.setAttribute("name","lightwindow_iframe");d.setAttribute("src","about:blank");d.setAttribute("height","100%");d.setAttribute("width","100%");d.setAttribute("frameborder","0");d.setAttribute("marginwidth","0");d.setAttribute("marginheight","0");d.setAttribute("scrolling",c);this._appendObject(d,"iframe",$("lightwindow_contents"))},_writeToIframe:function(d){var c=this.options.skin.iframe;c=c.replace("{body_replace}",d);if($("lightwindow_iframe").contentWindow){$("lightwindow_iframe").contentWindow.document.open();$("lightwindow_iframe").contentWindow.document.write(c);$("lightwindow_iframe").contentWindow.document.close()}else{$("lightwindow_iframe").contentDocument.open();$("lightwindow_iframe").contentDocument.write(c);$("lightwindow_iframe").contentDocument.close()}},_loadWindow:function(){switch(this.windowType){case"image":var m=0;var g=[];this.checkImage=[];this.resizeTo.height=this.resizeTo.width=0;this.imageCount=this._getParameter("lightwindow_show_images")?parseInt(this._getParameter("lightwindow_show_images")):1;if(gallery=this._getGalleryInfo(this.element.rel)){for(m=0;m<this.galleries[gallery[0]][gallery[1]].length;m++){if(this.contentToFetch.indexOf(this.galleries[gallery[0]][gallery[1]][m].href)>-1){break}}if(this.galleries[gallery[0]][gallery[1]][m-this.imageCount]){this.navigationObservers.previous=this.galleries[gallery[0]][gallery[1]][m-this.imageCount]}else{this.navigationObservers.previous=false}if(this.galleries[gallery[0]][gallery[1]][m+this.imageCount]){this.navigationObservers.next=this.galleries[gallery[0]][gallery[1]][m+this.imageCount]}else{this.navigationObservers.next=false}this.activeGallery=true}else{this.navigationObservers.previous=false;this.navigationObservers.next=false;this.activeGallery=false}for(var k=m;k<(m+this.imageCount);k++){if(gallery&&this.galleries[gallery[0]][gallery[1]][k]){this.contentToFetch=this.galleries[gallery[0]][gallery[1]][k].href;this.galleryLocation={current:(k+1)/this.imageCount,total:(this.galleries[gallery[0]][gallery[1]].length)/this.imageCount};if(!this.galleries[gallery[0]][gallery[1]][k+this.imageCount]){$("lightwindow_next").setStyle({display:"none"})}else{$("lightwindow_next").setStyle({display:"block"});$("lightwindow_next_title").innerHTML=this.galleries[gallery[0]][gallery[1]][k+this.imageCount].name}if(!this.galleries[gallery[0]][gallery[1]][k-this.imageCount]){$("lightwindow_previous").setStyle({display:"none"})}else{$("lightwindow_previous").setStyle({display:"block"});$("lightwindow_previous_title").innerHTML=this.galleries[gallery[0]][gallery[1]][k-this.imageCount].name}}g[k]=document.createElement("img");g[k].setAttribute("id","lightwindow_image_"+k);g[k].setAttribute("border","0");g[k].setAttribute("src",this.contentToFetch);$("lightwindow_contents").appendChild(g[k]);var n=(document.all)?1:0;this.checkImage[k]=new PeriodicalExecuter(function(a){if(n){imgLoaded=$("lightwindow_image_"+a).complete}else{imgLoaded=(!(typeof $("lightwindow_image_"+a).naturalWidth!="undefined"&&$("lightwindow_image_"+a).naturalWidth==0))}if(imgLoaded){this.checkImage[a].stop();var b=$("lightwindow_image_"+a).getHeight();if(b>this.resizeTo.height){this.resizeTo.height=b}this.resizeTo.width+=$("lightwindow_image_"+a).getWidth();this.imageCount--;$("lightwindow_image_"+a).setStyle({height:"100%",width:"100%"});if(this.imageCount==0){this._processWindow()}}}.bind(this,k),1)}break;case"media":var m=0;this.resizeTo.height=this.resizeTo.width=0;if(gallery=this._getGalleryInfo(this.element.rel)){for(m=0;m<this.galleries[gallery[0]][gallery[1]].length;m++){if(this.contentToFetch.indexOf(this.galleries[gallery[0]][gallery[1]][m].href)>-1){break}}if(this.galleries[gallery[0]][gallery[1]][m-1]){this.navigationObservers.previous=this.galleries[gallery[0]][gallery[1]][m-1]}else{this.navigationObservers.previous=false}if(this.galleries[gallery[0]][gallery[1]][m+1]){this.navigationObservers.next=this.galleries[gallery[0]][gallery[1]][m+1]}else{this.navigationObservers.next=false}this.activeGallery=true}else{this.navigationObservers.previous=false;this.navigationObservers.next=false;this.activeGallery=false}if(gallery&&this.galleries[gallery[0]][gallery[1]][m]){this.contentToFetch=this.galleries[gallery[0]][gallery[1]][m].href;this.galleryLocation={current:m+1,total:this.galleries[gallery[0]][gallery[1]].length};if(!this.galleries[gallery[0]][gallery[1]][m+1]){$("lightwindow_next").setStyle({display:"none"})}else{$("lightwindow_next").setStyle({display:"block"});$("lightwindow_next_title").innerHTML=this.galleries[gallery[0]][gallery[1]][m+1].name}if(!this.galleries[gallery[0]][gallery[1]][m-1]){$("lightwindow_previous").setStyle({display:"none"})}else{$("lightwindow_previous").setStyle({display:"block"});$("lightwindow_previous_title").innerHTML=this.galleries[gallery[0]][gallery[1]][m-1].name}}if(this._getParameter("lightwindow_iframe_embed")){this.resizeTo.height=this.dimensions.viewport.height;this.resizeTo.width=this.dimensions.viewport.width}else{this.resizeTo.height=this._getParameter("lightwindow_height");this.resizeTo.width=this._getParameter("lightwindow_width")}this._processWindow();break;case"external":this._appendIframe("auto");this.resizeTo.height=this.dimensions.viewport.height;this.resizeTo.width=this.dimensions.viewport.width;this._processWindow();break;case"page":var h=new Ajax.Request(this.contentToFetch,{method:"get",parameters:"",onComplete:function(a){$("lightwindow_contents").innerHTML+=a.responseText;this.resizeTo.height=$("lightwindow_contents").scrollHeight+(this.options.contentOffset.height);this.resizeTo.width=$("lightwindow_contents").scrollWidth+(this.options.contentOffset.width);this._processWindow()}.bind(this)});break;case"inline":var l=this.contentToFetch;if(l.indexOf("?")>-1){l=l.substring(0,l.indexOf("?"))}l=l.substring(l.indexOf("#")+1);new Insertion.Top($("lightwindow_contents"),$(l).innerHTML);this.resizeTo.height=$("lightwindow_contents").scrollHeight+(this.options.contentOffset.height);this.resizeTo.width=$("lightwindow_contents").scrollWidth+(this.options.contentOffset.width);this._toggleTroubleElements("hidden",true);this._processWindow();break;default:throw ("Page Type could not be determined, please amend this lightwindow URL "+this.contentToFetch);break}},_resizeWindowToFit:function(){if(this.resizeTo.height+this.dimensions.cruft.height>this.dimensions.viewport.height){var c=this.resizeTo.height/this.resizeTo.width;this.resizeTo.height=this.dimensions.viewport.height-this.dimensions.cruft.height-(2*this.options.viewportPadding);if(this.windowType=="image"||(this.windowType=="media"&&!this._getParameter("lightwindow_iframe_embed"))){this.resizeTo.width=this.resizeTo.height/c;$("lightwindow_data_slide_inner").setStyle({width:"auto"})}}if(this.resizeTo.width+this.dimensions.cruft.width>this.dimensions.viewport.width){var d=this.resizeTo.width/this.resizeTo.height;this.resizeTo.width=this.dimensions.viewport.width-2*this.dimensions.cruft.width-(2*this.options.viewportPadding);if(this.windowType=="image"||(this.windowType=="media"&&!this._getParameter("lightwindow_iframe_embed"))){this.resizeTo.height=this.resizeTo.width/d;$("lightwindow_data_slide_inner").setStyle({height:this.resizeTo.height+"px"})}}},_presetWindowSize:function(){if(this._getParameter("lightwindow_height")){this.resizeTo.height=parseFloat(this._getParameter("lightwindow_height"))}if(this._getParameter("lightwindow_width")){this.resizeTo.width=parseFloat(this._getParameter("lightwindow_width"))}},_processWindow:function(){this.dimensions.dataEffects=[];if(this.element.caption||this.element.author||(this.activeGallery&&this.options.showGalleryCount)){if(this.element.caption){$("lightwindow_data_caption").innerHTML=this.element.caption;$("lightwindow_data_caption").setStyle({display:"block"})}else{$("lightwindow_data_caption").setStyle({display:"none"})}if(this.element.author){$("lightwindow_data_author").innerHTML=this.element.author;$("lightwindow_data_author_container").setStyle({display:"block"})}else{$("lightwindow_data_author_container").setStyle({display:"none"})}if(this.activeGallery&&this.options.showGalleryCount){$("lightwindow_data_gallery_current").innerHTML=this.galleryLocation.current;$("lightwindow_data_gallery_total").innerHTML=this.galleryLocation.total;$("lightwindow_data_gallery_container").setStyle({display:"block"})}else{$("lightwindow_data_gallery_container").setStyle({display:"none"})}$("lightwindow_data_slide_inner").setStyle({width:"auto",height:"auto",visibility:"visible",display:"block"});$("lightwindow_data_slide").setStyle({height:$("lightwindow_data_slide").getHeight()+"px",width:"1px",overflow:"hidden",display:"block"})}else{$("lightwindow_data_slide").setStyle({display:"none",width:"auto"});$("lightwindow_data_slide_inner").setStyle({display:"none",visibility:"hidden",width:this.resizeTo.width+"px",height:"0px"})}if(this.element.title!="null"){$("lightwindow_title_bar_title").innerHTML=this.element.title}else{$("lightwindow_title_bar_title").innerHTML=""}var d={height:$("lightwindow_container").getHeight(),width:$("lightwindow_container").getWidth()};$("lightwindow_container").setStyle({height:"auto",width:$("lightwindow_container").getWidth()+this.options.contentOffset.width-(this.windowActive?this.options.contentOffset.width:0)+"px"});var c={height:$("lightwindow_container").getHeight(),width:$("lightwindow_container").getWidth()};this.containerChange={height:d.height-c.height,width:d.width-c.width};this.dimensions.container={height:$("lightwindow_container").getHeight(),width:$("lightwindow_container").getWidth()};this.dimensions.cruft={height:this.dimensions.container.height-$("lightwindow_contents").getHeight()+this.options.contentOffset.height,width:this.dimensions.container.width-$("lightwindow_contents").getWidth()+this.options.contentOffset.width};this._presetWindowSize();this._resizeWindowToFit();if(!this.windowActive){$("lightwindow_container").setStyle({left:-(this.dimensions.container.width/2)+"px",top:-(this.dimensions.container.height/2)+"px"})}$("lightwindow_container").setStyle({height:this.dimensions.container.height+"px",width:this.dimensions.container.width+"px"});this._displayLightWindow("block","visible");this._animateLightWindow()},_animateLightWindow:function(){if(this.options.animationHandler){this.options.animationHandler().bind(this)}else{this._defaultAnimationHandler()}},_handleNavigation:function(b){if(this.options.navigationHandler){this.options.navigationHandler().bind(this,b)}else{this._defaultDisplayNavigation(b)}},_handleTransition:function(){if(this.options.transitionHandler){this.options.transitionHandler().bind(this)}else{this._defaultTransitionHandler()}},_handleFinalWindowAnimation:function(b){if(this.options.finalAnimationHandler){this.options.finalAnimationHandler().bind(this,b)}else{this._defaultfinalWindowAnimationHandler(b)}},_handleGalleryAnimation:function(b){if(this.options.galleryAnimationHandler){this.options.galleryAnimationHandler().bind(this,b)}else{this._defaultGalleryAnimationHandler(b)}},_defaultDisplayNavigation:function(b){if(b){$("lightwindow_navigation").setStyle({display:"block",height:$("lightwindow_contents").getHeight()+"px",width:"100%",marginTop:this.options.dimensions.titleHeight+"px"})}else{$("lightwindow_navigation").setStyle({display:"none",height:"auto",width:"auto"})}},_defaultAnimationHandler:function(){if(this.element.caption||this.element.author||(this.activeGallery&&this.options.showGalleryCount)){$("lightwindow_data_slide").setStyle({display:"none",width:"auto"});this.dimensions.dataEffects.push(new Effect.SlideDown("lightwindow_data_slide",{sync:true}),new Effect.Appear("lightwindow_data_slide",{sync:true,from:0,to:1}))}$("lightwindow_title_bar_inner").setStyle({height:"0px",marginTop:this.options.dimensions.titleHeight+"px"});this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_title_bar_inner",{sync:true,style:{height:this.options.dimensions.titleHeight+"px",marginTop:"0px"}}),new Effect.Appear("lightwindow_title_bar_inner",{sync:true,from:0,to:1}));if(!this.options.hideGalleryTab){this._handleGalleryAnimation(false);if($("lightwindow_galleries_tab_container").getHeight()==0){this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_galleries_tab_container",{sync:true,style:{height:"20px",marginTop:"0px"}}));$("lightwindow_galleries").setStyle({width:"0px"})}}var c=false;var d=this.dimensions.container.width-$("lightwindow_contents").getWidth()+this.resizeTo.width+this.options.contentOffset.width;if(d!=$("lightwindow_container").getWidth()){new Effect.Parallel([new Effect.Scale("lightwindow_contents",100*(this.resizeTo.width/$("lightwindow_contents").getWidth()),{scaleFrom:100*($("lightwindow_contents").getWidth()/($("lightwindow_contents").getWidth()+(this.options.contentOffset.width))),sync:true,scaleY:false,scaleContent:false}),new Effect.Scale("lightwindow_container",100*(d/(this.dimensions.container.width)),{sync:true,scaleY:false,scaleFromCenter:true,scaleContent:false})],{duration:this.duration,delay:0.25,queue:{position:"end",scope:"lightwindowAnimation"}})}d=this.dimensions.container.height-$("lightwindow_contents").getHeight()+this.resizeTo.height+this.options.contentOffset.height;if(d!=$("lightwindow_container").getHeight()){new Effect.Parallel([new Effect.Scale("lightwindow_contents",100*(this.resizeTo.height/$("lightwindow_contents").getHeight()),{scaleFrom:100*($("lightwindow_contents").getHeight()/($("lightwindow_contents").getHeight()+(this.options.contentOffset.height))),sync:true,scaleX:false,scaleContent:false}),new Effect.Scale("lightwindow_container",100*(d/(this.dimensions.container.height)),{sync:true,scaleX:false,scaleFromCenter:true,scaleContent:false})],{duration:this.duration,afterFinish:function(){if(this.dimensions.dataEffects.length>0){if(!this.options.hideGalleryTab){$("lightwindow_galleries").setStyle({width:this.resizeTo.width+"px"})}new Effect.Parallel(this.dimensions.dataEffects,{duration:this.duration,afterFinish:function(){this._finishWindow()}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})}}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}});c=true}if(!c&&this.dimensions.dataEffects.length>0){new Effect.Parallel(this.dimensions.dataEffects,{duration:this.duration,beforeStart:function(){if(!this.options.hideGalleryTab){$("lightwindow_galleries").setStyle({width:this.resizeTo.width+"px"})}if(this.containerChange.height!=0||this.containerChange.width!=0){new Effect.MoveBy("lightwindow_container",this.containerChange.height,this.containerChange.width,{transition:Effect.Transitions.sinoidal})}}.bind(this),afterFinish:function(){this._finishWindow()}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})}},_defaultfinalWindowAnimationHandler:function(b){if(this.windowType=="media"||this._getParameter("lightwindow_loading_animation")){Element.hide("lightwindow_loading");this._handleNavigation(this.activeGallery);this._setStatus(false)}else{Effect.Fade("lightwindow_loading",{duration:0.75,delay:1,afterFinish:function(){if(this.windowType!="image"&&this.windowType!="media"&&this.windowType!="external"){$("lightwindow_contents").setStyle({overflow:"auto"})}this._handleNavigation(this.activeGallery);this._defaultGalleryAnimationHandler();this._setStatus(false)}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})}},_defaultGalleryAnimationHandler:function(d){if(this.activeGallery){$("lightwindow_galleries").setStyle({display:"block",marginBottom:$("lightwindow_data_slide").getHeight()+this.options.contentOffset.height/2+"px"});$("lightwindow_navigation").setStyle({height:$("lightwindow_contents").getHeight()-20+"px"})}else{$("lightwindow_galleries").setStyle({display:"none"});$("lightwindow_galleries_tab_container").setStyle({height:"0px",marginTop:"20px"});$("lightwindow_galleries_list").setStyle({height:"0px"});return false}if(d){if($("lightwindow_galleries_list").getHeight()==0){var c=$("lightwindow_contents").getHeight()*0.8;$("lightwindow_galleries_tab_span").className="down"}else{var c=0;$("lightwindow_galleries_tab_span").className="up"}new Effect.Morph("lightwindow_galleries_list",{duration:this.duration,transition:Effect.Transitions.sinoidal,style:{height:c+"px"},beforeStart:function(){$("lightwindow_galleries_list").setStyle({overflow:"hidden"})},afterFinish:function(){$("lightwindow_galleries_list").setStyle({overflow:"auto"})},queue:{position:"end",scope:"lightwindowAnimation"}})}},_defaultTransitionHandler:function(){this.dimensions.dataEffects=[];if($("lightwindow_data_slide").getStyle("display")!="none"){this.dimensions.dataEffects.push(new Effect.SlideUp("lightwindow_data_slide",{sync:true}),new Effect.Fade("lightwindow_data_slide",{sync:true,from:1,to:0}))}if(!this.options.hideGalleryTab){if($("lightwindow_galleries").getHeight()!=0&&!this.options.hideGalleryTab){this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_galleries_tab_container",{sync:true,style:{height:"0px",marginTop:"20px"}}))}if($("lightwindow_galleries_list").getHeight()!=0){$("lightwindow_galleries_tab_span").className="up";this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_galleries_list",{sync:true,style:{height:"0px"},transition:Effect.Transitions.sinoidal,beforeStart:function(){$("lightwindow_galleries_list").setStyle({overflow:"hidden"})},afterFinish:function(){$("lightwindow_galleries_list").setStyle({overflow:"auto"})}}))}}this.dimensions.dataEffects.push(new Effect.Morph("lightwindow_title_bar_inner",{sync:true,style:{height:"0px",marginTop:this.options.dimensions.titleHeight+"px"}}),new Effect.Fade("lightwindow_title_bar_inner",{sync:true,from:1,to:0}));new Effect.Parallel(this.dimensions.dataEffects,{duration:this.duration,afterFinish:function(){this._loadWindow()}.bind(this),queue:{position:"end",scope:"lightwindowAnimation"}})},_defaultFormHandler:function(k){var g=Event.element(k).parentNode;var h=Form.serialize(this._getParameter("lightwindow_form",g.getAttribute("params")));if(this.options.formMethod=="post"){var f=new Ajax.Request(g.href,{method:"post",postBody:h,onComplete:this.openWindow.bind(this,g)})}else{if(this.options.formMethod=="get"){var f=new Ajax.Request(g.href,{method:"get",parameters:h,onComplete:this.openWindow.bind(this,g)})}}},_finishWindow:function(){if(this.windowType=="external"){$("lightwindow_iframe").setAttribute("src",this.element.href);this._handleFinalWindowAnimation(1)}else{if(this.windowType=="media"){var d=document.createElement("object");d.setAttribute("classid",this.options.classids[this._fileExtension(this.contentToFetch)]);d.setAttribute("codebase",this.options.codebases[this._fileExtension(this.contentToFetch)]);d.setAttribute("id","lightwindow_media_primary");d.setAttribute("name","lightwindow_media_primary");d.setAttribute("width",this.resizeTo.width);d.setAttribute("height",this.resizeTo.height);d=this._addParamToObject("movie",this.contentToFetch,d);d=this._addParamToObject("src",this.contentToFetch,d);d=this._addParamToObject("controller","true",d);d=this._addParamToObject("wmode","transparent",d);d=this._addParamToObject("cache","false",d);d=this._addParamToObject("quality","high",d);if(!Prototype.Browser.IE){var c=document.createElement("object");c.setAttribute("type",this.options.mimeTypes[this._fileExtension(this.contentToFetch)]);c.setAttribute("data",this.contentToFetch);c.setAttribute("id","lightwindow_media_secondary");c.setAttribute("name","lightwindow_media_secondary");c.setAttribute("width",this.resizeTo.width);c.setAttribute("height",this.resizeTo.height);c=this._addParamToObject("controller","true",c);c=this._addParamToObject("wmode","transparent",c);c=this._addParamToObject("cache","false",c);c=this._addParamToObject("quality","high",c);d.appendChild(c)}if(this._getParameter("lightwindow_iframe_embed")){this._appendIframe("no");this._writeToIframe(this._convertToMarkup(d,"object"))}else{this._appendObject(d,"object",$("lightwindow_contents"))}this._handleFinalWindowAnimation(0)}else{this._handleFinalWindowAnimation(0)}}this._setupActions()}};Event.observe(window,"load",lightwindowInit,false);var myLightWindow=null;function lightwindowInit(){myLightWindow=new lightwindow()};